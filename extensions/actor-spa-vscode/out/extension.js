(()=>{var e,t={139:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.tokenizeForMachine=a,t.formatWithMachine=function(e,t,n){const s=a(e),r=[];let o=0,i=0,c=!1,D=null;for(let e=0;e<s.length;e++){const t=s[e],a=s[e+1];switch(t.type){case"TEMPLATE_TAG":D=t.tag,c=!0;break;case"BACKTICK":if(c&&D){if(a&&"EOF"!==a.type){const e=new u.Position(o,i+1),t=n.insertSpaces?" ".repeat(1*n.tabSize):"\t".repeat(1),s=new u.Range(e,e);r.push({range:s,newText:`\n${t}`})}c=!c}break;case"NEWLINE":if(o++,i=0,c&&D){const e=new u.Position(o,0),t=n.insertSpaces?" ".repeat(1*n.tabSize):"\t".repeat(1),s=new u.Range(e,e);r.push({range:s,newText:t})}break;case"DOLLAR_LBRACE":case"LBRACE":case"RBRACE":case"EOF":break;case"CHAR":i++}}return{edits:r}};const u=i(n(1398));function a(e){const t=[];let n=0;for(;n<e.length;){const s=e[n];"html`"===e.slice(n,n+5)?(t.push({type:"TEMPLATE_TAG",tag:"html"}),n+=4):"css`"===e.slice(n,n+4)?(t.push({type:"TEMPLATE_TAG",tag:"css"}),n+=3):"`"===s?t.push({type:"BACKTICK"}):"$"===s&&"{"===e[n+1]?(t.push({type:"DOLLAR_LBRACE"}),n++):"{"===s?t.push({type:"LBRACE"}):"}"===s?t.push({type:"RBRACE"}):"\n"===s?t.push({type:"NEWLINE"}):t.push({type:"CHAR",char:s}),n++}return t.push({type:"EOF"}),t}},181:e=>{"use strict";e.exports=require("buffer")},843:(e,t)=>{"use strict";var n,s,r;Object.defineProperty(t,"__esModule",{value:!0}),t.isCodeReviewResponse=t.isCodeReviewRequest=t.CommunicationChannel=t.MessagePriority=t.MessageType=void 0,function(e){e.CODE_REVIEW_REQUEST="CODE_REVIEW_REQUEST",e.CODE_REVIEW_RESPONSE="CODE_REVIEW_RESPONSE",e.REFACTOR_SUGGESTION="REFACTOR_SUGGESTION",e.REFACTOR_ACCEPTED="REFACTOR_ACCEPTED",e.REFACTOR_REJECTED="REFACTOR_REJECTED",e.ARCHITECTURE_PROPOSAL="ARCHITECTURE_PROPOSAL",e.ARCHITECTURE_FEEDBACK="ARCHITECTURE_FEEDBACK",e.TASK_ASSIGNMENT="TASK_ASSIGNMENT",e.TASK_STATUS_UPDATE="TASK_STATUS_UPDATE",e.TASK_COMPLETED="TASK_COMPLETED",e.PAIR_PROGRAMMING_REQUEST="PAIR_PROGRAMMING_REQUEST",e.PAIR_PROGRAMMING_RESPONSE="PAIR_PROGRAMMING_RESPONSE",e.KNOWLEDGE_QUERY="KNOWLEDGE_QUERY",e.KNOWLEDGE_RESPONSE="KNOWLEDGE_RESPONSE",e.HANDSHAKE="HANDSHAKE",e.HEARTBEAT="HEARTBEAT",e.ACKNOWLEDGMENT="ACKNOWLEDGMENT",e.ERROR="ERROR",e.CUSTOM="CUSTOM"}(n||(t.MessageType=n={})),function(e){e[e.LOW=0]="LOW",e[e.NORMAL=1]="NORMAL",e[e.HIGH=2]="HIGH",e[e.CRITICAL=3]="CRITICAL"}(s||(t.MessagePriority=s={})),function(e){e.CODE_REVIEW="code_review",e.REFACTORING="refactoring",e.ARCHITECTURE="architecture",e.TASK_COORDINATION="task_coordination",e.KNOWLEDGE_SHARING="knowledge_sharing",e.SYSTEM="system",e.GENERAL="general"}(r||(t.CommunicationChannel=r={})),t.isCodeReviewRequest=e=>e.type===n.CODE_REVIEW_REQUEST,t.isCodeReviewResponse=e=>e.type===n.CODE_REVIEW_RESPONSE},932:e=>{"use strict";e.exports=require("process")},1398:e=>{"use strict";e.exports=require("vscode")},1421:e=>{"use strict";e.exports=require("node:child_process")},1455:e=>{"use strict";e.exports=require("node:fs/promises")},1493:e=>{"use strict";e.exports=require("v8")},1591:e=>{"use strict";const t=Symbol("kDone"),n=Symbol("kRun");e.exports=class{constructor(e){this[t]=()=>{this.pending--,this[n]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[n]()}[n](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[t])}}}},1943:e=>{"use strict";e.exports=require("fs/promises")},1961:e=>{e.exports=function(){var e=function(){"use strict";var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,r={};((t,n)=>{for(var s in n)e(t,s,{get:n[s],enumerable:!0})})(r,{builders:()=>he,printer:()=>pe,utils:()=>fe});var o="string",i="array",u="cursor",a="indent",c="align",D="trim",l="group",d="fill",h="if-break",p="indent-if-break",f="line-suffix",g="line-suffix-boundary",F="line",m="label",E="break-parent",C=new Set([u,a,c,D,l,d,h,p,f,g,F,m,E]),y=(e,t,n)=>{if(!e||null!=t)return Array.isArray(t)||"string"==typeof t?t[n<0?t.length+n:n]:t.at(n)};var v=function(e){if("string"==typeof e)return o;if(Array.isArray(e))return i;if(!e)return;const{type:t}=e;return C.has(t)?t:void 0};function _(e){const t=null===e?"null":typeof e;if("string"!==t&&"object"!==t)return`Unexpected doc '${t}', \nExpected it to be 'string' or 'object'.`;if(v(e))throw new Error("doc is valid.");const n=Object.prototype.toString.call(e);if("[object Object]"!==n)return`Unexpected doc '${n}'.`;const s=(r=[...C].map(e=>`'${e}'`),new Intl.ListFormat("en-US",{type:"disjunction"}).format(r));var r;return`Unexpected doc.type '${e.type}'.\nExpected it to be ${s}.`}var b=class extends Error{name="InvalidDocError";constructor(e){super(_(e)),this.doc=e}},S={};var w=function(e,t,n,s){const r=[e];for(;r.length>0;){const e=r.pop();if(e===S){n(r.pop());continue}n&&r.push(e,S);const C=v(e);if(!C)throw new b(e);if(!1!==(null==t?void 0:t(e)))switch(C){case i:case d:{const t=C===i?e:e.parts;for(let e=t.length-1;e>=0;--e)r.push(t[e]);break}case h:r.push(e.flatContents,e.breakContents);break;case l:if(s&&e.expandedStates)for(let t=e.expandedStates.length-1;t>=0;--t)r.push(e.expandedStates[t]);else r.push(e.contents);break;case c:case a:case p:case m:case f:r.push(e.contents);break;case o:case u:case D:case g:case F:case E:break;default:throw new b(e)}}};function B(e,t){if("string"==typeof e)return t(e);const n=new Map;return s(e);function s(e){if(n.has(e))return n.get(e);const r=function(e){switch(v(e)){case i:return t(e.map(s));case d:return t({...e,parts:e.parts.map(s)});case h:return t({...e,breakContents:s(e.breakContents),flatContents:s(e.flatContents)});case l:{let{expandedStates:n,contents:r}=e;return n?(n=n.map(s),r=n[0]):r=s(r),t({...e,contents:r,expandedStates:n})}case c:case a:case p:case m:case f:return t({...e,contents:s(e.contents)});case o:case u:case D:case g:case F:case E:return t(e);default:throw new b(e)}}(e);return n.set(e,r),r}}function x(e,t,n){let s=n,r=!1;return w(e,function(e){if(r)return!1;const n=t(e);void 0!==n&&(r=!0,s=n)}),s}function A(e){return!(e.type!==l||!e.break)||!(e.type!==F||!e.hard)||e.type===E||void 0}function O(e){if(e.length>0){const t=y(!1,e,-1);t.expandedStates||t.break||(t.break="propagated")}return null}function T(e){return e.type!==F||e.hard?e.type===h?e.flatContents:e:e.soft?"":" "}function k(e){for(e=[...e];e.length>=2&&y(!1,e,-2).type===F&&y(!1,e,-1).type===E;)e.length-=2;if(e.length>0){const t=N(y(!1,e,-1));e[e.length-1]=t}return e}function N(e){switch(v(e)){case a:case p:case l:case f:case m:{const t=N(e.contents);return{...e,contents:t}}case h:return{...e,breakContents:N(e.breakContents),flatContents:N(e.flatContents)};case d:return{...e,parts:k(e.parts)};case i:return k(e);case o:return function(e){let t=e.length;for(;t>0&&("\r"===e[t-1]||"\n"===e[t-1]);)t--;return t<e.length?e.slice(0,t):e}(e);case c:case u:case D:case g:case F:case E:break;default:throw new b(e)}return e}function P(e){if(e.type===F)return!0}var I=()=>{},R=I,M=I,L=I;function $(e){return R(e),{type:a,contents:e}}function j(e,t){return R(t),{type:c,contents:t,n:e}}function U(e,t={}){return R(e),M(t.expandedStates,!0),{type:l,id:t.id,contents:e,break:Boolean(t.shouldBreak),expandedStates:t.expandedStates}}var W={type:g},G={type:E},z={type:D},V={type:F,hard:!0},H={type:F,hard:!0,literal:!0},q={type:F},J={type:F,soft:!0},X=[V,G],Q=[H,G],K={type:u};function Y(e,t){R(e),M(t);const n=[];for(let s=0;s<t.length;s++)0!==s&&n.push(e),n.push(t[s]);return n}var Z=(e,t,n,s)=>{if(!e||null!=t)return t.replaceAll?t.replaceAll(n,s):n.global?t.replace(n,s):t.split(n).join(s)};var ee=e=>{return!(12288===(t=e)||t>=65281&&t<=65376||t>=65504&&t<=65510||function(e){return e>=4352&&e<=4447||8986===e||8987===e||9001===e||9002===e||e>=9193&&e<=9196||9200===e||9203===e||9725===e||9726===e||9748===e||9749===e||e>=9776&&e<=9783||e>=9800&&e<=9811||9855===e||e>=9866&&e<=9871||9875===e||9889===e||9898===e||9899===e||9917===e||9918===e||9924===e||9925===e||9934===e||9940===e||9962===e||9970===e||9971===e||9973===e||9978===e||9981===e||9989===e||9994===e||9995===e||10024===e||10060===e||10062===e||e>=10067&&e<=10069||10071===e||e>=10133&&e<=10135||10160===e||10175===e||11035===e||11036===e||11088===e||11093===e||e>=11904&&e<=11929||e>=11931&&e<=12019||e>=12032&&e<=12245||e>=12272&&e<=12287||e>=12289&&e<=12350||e>=12353&&e<=12438||e>=12441&&e<=12543||e>=12549&&e<=12591||e>=12593&&e<=12686||e>=12688&&e<=12773||e>=12783&&e<=12830||e>=12832&&e<=12871||e>=12880&&e<=42124||e>=42128&&e<=42182||e>=43360&&e<=43388||e>=44032&&e<=55203||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65106||e>=65108&&e<=65126||e>=65128&&e<=65131||e>=94176&&e<=94180||94192===e||94193===e||e>=94208&&e<=100343||e>=100352&&e<=101589||e>=101631&&e<=101640||e>=110576&&e<=110579||e>=110581&&e<=110587||110589===e||110590===e||e>=110592&&e<=110882||110898===e||e>=110928&&e<=110930||110933===e||e>=110948&&e<=110951||e>=110960&&e<=111355||e>=119552&&e<=119638||e>=119648&&e<=119670||126980===e||127183===e||127374===e||e>=127377&&e<=127386||e>=127488&&e<=127490||e>=127504&&e<=127547||e>=127552&&e<=127560||127568===e||127569===e||e>=127584&&e<=127589||e>=127744&&e<=127776||e>=127789&&e<=127797||e>=127799&&e<=127868||e>=127870&&e<=127891||e>=127904&&e<=127946||e>=127951&&e<=127955||e>=127968&&e<=127984||127988===e||e>=127992&&e<=128062||128064===e||e>=128066&&e<=128252||e>=128255&&e<=128317||e>=128331&&e<=128334||e>=128336&&e<=128359||128378===e||128405===e||128406===e||128420===e||e>=128507&&e<=128591||e>=128640&&e<=128709||128716===e||e>=128720&&e<=128722||e>=128725&&e<=128727||e>=128732&&e<=128735||128747===e||128748===e||e>=128756&&e<=128764||e>=128992&&e<=129003||129008===e||e>=129292&&e<=129338||e>=129340&&e<=129349||e>=129351&&e<=129535||e>=129648&&e<=129660||e>=129664&&e<=129673||e>=129679&&e<=129734||e>=129742&&e<=129756||e>=129759&&e<=129769||e>=129776&&e<=129784||e>=131072&&e<=196605||e>=196608&&e<=262141}(e));var t},te=/[^\x20-\x7F]/u;var ne=function(e){if(!e)return 0;if(!te.test(e))return e.length;e=e.replace(/[#*0-9]\uFE0F?\u20E3|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26AA\u26B0\u26B1\u26BD\u26BE\u26C4\u26C8\u26CF\u26D1\u26E9\u26F0-\u26F5\u26F7\u26F8\u26FA\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B55\u3030\u303D\u3297\u3299]\uFE0F?|[\u261D\u270C\u270D](?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?|[\u270A\u270B](?:\uD83C[\uDFFB-\uDFFF])?|[\u23E9-\u23EC\u23F0\u23F3\u25FD\u2693\u26A1\u26AB\u26C5\u26CE\u26D4\u26EA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2795-\u2797\u27B0\u27BF\u2B50]|\u26D3\uFE0F?(?:\u200D\uD83D\uDCA5)?|\u26F9(?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?(?:\u200D[\u2640\u2642]\uFE0F?)?|\u2764\uFE0F?(?:\u200D(?:\uD83D\uDD25|\uD83E\uDE79))?|\uD83C(?:[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37\uDF21\uDF24-\uDF2C\uDF36\uDF7D\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFCD\uDFCE\uDFD4-\uDFDF\uDFF5\uDFF7]\uFE0F?|[\uDF85\uDFC2\uDFC7](?:\uD83C[\uDFFB-\uDFFF])?|[\uDFC4\uDFCA](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDFCB\uDFCC](?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDCCF\uDD8E\uDD91-\uDD9A\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF43\uDF45-\uDF4A\uDF4C-\uDF7C\uDF7E-\uDF84\uDF86-\uDF93\uDFA0-\uDFC1\uDFC5\uDFC6\uDFC8\uDFC9\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF8-\uDFFF]|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|\uDF44(?:\u200D\uD83D\uDFEB)?|\uDF4B(?:\u200D\uD83D\uDFE9)?|\uDFC3(?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D(?:[\u2640\u2642]\uFE0F?(?:\u200D\u27A1\uFE0F?)?|\u27A1\uFE0F?))?|\uDFF3\uFE0F?(?:\u200D(?:\u26A7\uFE0F?|\uD83C\uDF08))?|\uDFF4(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDC73\uDB40\uDC63\uDB40\uDC74|\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F)?)|\uD83D(?:[\uDC3F\uDCFD\uDD49\uDD4A\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3]\uFE0F?|[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4\uDEB5](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD74\uDD90](?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?|[\uDC00-\uDC07\uDC09-\uDC14\uDC16-\uDC25\uDC27-\uDC3A\uDC3C-\uDC3E\uDC40\uDC44\uDC45\uDC51-\uDC65\uDC6A\uDC79-\uDC7B\uDC7D-\uDC80\uDC84\uDC88-\uDC8E\uDC90\uDC92-\uDCA9\uDCAB-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDDA4\uDDFB-\uDE2D\uDE2F-\uDE34\uDE37-\uDE41\uDE43\uDE44\uDE48-\uDE4A\uDE80-\uDEA2\uDEA4-\uDEB3\uDEB7-\uDEBF\uDEC1-\uDEC5\uDED0-\uDED2\uDED5-\uDED7\uDEDC-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uDC08(?:\u200D\u2B1B)?|\uDC15(?:\u200D\uD83E\uDDBA)?|\uDC26(?:\u200D(?:\u2B1B|\uD83D\uDD25))?|\uDC3B(?:\u200D\u2744\uFE0F?)?|\uDC41\uFE0F?(?:\u200D\uD83D\uDDE8\uFE0F?)?|\uDC68(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDC68\uDC69]\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE])))?))?|\uDC69(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?[\uDC68\uDC69]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?))|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFE])))?))?|\uDC6F(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDD75(?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDE2E(?:\u200D\uD83D\uDCA8)?|\uDE35(?:\u200D\uD83D\uDCAB)?|\uDE36(?:\u200D\uD83C\uDF2B\uFE0F?)?|\uDE42(?:\u200D[\u2194\u2195]\uFE0F?)?|\uDEB6(?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D(?:[\u2640\u2642]\uFE0F?(?:\u200D\u27A1\uFE0F?)?|\u27A1\uFE0F?))?)|\uD83E(?:[\uDD0C\uDD0F\uDD18-\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2\uDDD3\uDDD5\uDEC3-\uDEC5\uDEF0\uDEF2-\uDEF8](?:\uD83C[\uDFFB-\uDFFF])?|[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD\uDDCF\uDDD4\uDDD6-\uDDDD](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDDDE\uDDDF](?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD0D\uDD0E\uDD10-\uDD17\uDD20-\uDD25\uDD27-\uDD2F\uDD3A\uDD3F-\uDD45\uDD47-\uDD76\uDD78-\uDDB4\uDDB7\uDDBA\uDDBC-\uDDCC\uDDD0\uDDE0-\uDDFF\uDE70-\uDE7C\uDE80-\uDE89\uDE8F-\uDEC2\uDEC6\uDECE-\uDEDC\uDEDF-\uDEE9]|\uDD3C(?:\u200D[\u2640\u2642]\uFE0F?|\uD83C[\uDFFB-\uDFFF])?|\uDDCE(?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D(?:[\u2640\u2642]\uFE0F?(?:\u200D\u27A1\uFE0F?)?|\u27A1\uFE0F?))?|\uDDD1(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1|\uDDD1\u200D\uD83E\uDDD2(?:\u200D\uD83E\uDDD2)?|\uDDD2(?:\u200D\uD83E\uDDD2)?))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFC-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFD-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFD\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFE]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?))?|\uDEF1(?:\uD83C(?:\uDFFB(?:\u200D\uD83E\uDEF2\uD83C[\uDFFC-\uDFFF])?|\uDFFC(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFD-\uDFFF])?|\uDFFD(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])?|\uDFFE(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFD\uDFFF])?|\uDFFF(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFE])?))?)/g,"  ");let t=0;for(const n of e){const e=n.codePointAt(0);e<=31||e>=127&&e<=159||e>=768&&e<=879||(t+=ee(e)?1:2)}return t},se=Symbol("MODE_BREAK"),re=Symbol("MODE_FLAT"),oe=Symbol("cursor"),ie=Symbol("DOC_FILL_PRINTED_LENGTH");function ue(e,t){return ce(e,{type:"indent"},t)}function ae(e,t,n){return t===Number.NEGATIVE_INFINITY?e.root||{value:"",length:0,queue:[]}:t<0?ce(e,{type:"dedent"},n):t?"root"===t.type?{...e,root:e}:ce(e,{type:"string"==typeof t?"stringAlign":"numberAlign",n:t},n):e}function ce(e,t,n){const s="dedent"===t.type?e.queue.slice(0,-1):[...e.queue,t];let r="",o=0,i=0,u=0;for(const e of s)switch(e.type){case"indent":D(),n.useTabs?a(1):c(n.tabWidth);break;case"stringAlign":D(),r+=e.n,o+=e.n.length;break;case"numberAlign":i+=1,u+=e.n;break;default:throw new Error(`Unexpected type '${e.type}'`)}return l(),{...e,value:r,length:o,queue:s};function a(e){r+="\t".repeat(e),o+=n.tabWidth*e}function c(e){r+=" ".repeat(e),o+=e}function D(){n.useTabs?(i>0&&a(i),d()):l()}function l(){u>0&&c(u),d()}function d(){i=0,u=0}}function De(e){let t=0,n=0,s=e.length;e:for(;s--;){const r=e[s];if(r!==oe)for(let n=r.length-1;n>=0;n--){const o=r[n];if(" "!==o&&"\t"!==o){e[s]=r.slice(0,n+1);break e}t++}else n++}if(t>0||n>0)for(e.length=s+1;n-- >0;)e.push(oe);return t}function le(e,t,n,s,r,u){if(n===Number.POSITIVE_INFINITY)return!0;let E=t.length;const C=[e],_=[];for(;n>=0;){if(0===C.length){if(0===E)return!0;C.push(t[--E]);continue}const{mode:e,doc:b}=C.pop(),S=v(b);switch(S){case o:_.push(b),n-=ne(b);break;case i:case d:{const t=S===i?b:b.parts,n=b[ie]??0;for(let s=t.length-1;s>=n;s--)C.push({mode:e,doc:t[s]});break}case a:case c:case p:case m:C.push({mode:e,doc:b.contents});break;case D:n+=De(_);break;case l:{if(u&&b.break)return!1;const t=b.break?se:e,n=b.expandedStates&&t===se?y(!1,b.expandedStates,-1):b.contents;C.push({mode:t,doc:n});break}case h:{const t=(b.groupId?r[b.groupId]||re:e)===se?b.breakContents:b.flatContents;t&&C.push({mode:e,doc:t});break}case F:if(e===se||b.hard)return!0;b.soft||(_.push(" "),n--);break;case f:s=!0;break;case g:if(s)return!1}}return!1}var de,he={join:Y,line:q,softline:J,hardline:X,literalline:Q,group:U,conditionalGroup:function(e,t){return U(e[0],{...t,expandedStates:e})},fill:function(e){return L(e),{type:d,parts:e}},lineSuffix:function(e){return R(e),{type:f,contents:e}},lineSuffixBoundary:W,cursor:K,breakParent:G,ifBreak:function(e,t="",n={}){return R(e),""!==t&&R(t),{type:h,breakContents:e,flatContents:t,groupId:n.groupId}},trim:z,indent:$,indentIfBreak:function(e,t){return R(e),{type:p,contents:e,groupId:t.groupId,negate:t.negate}},align:j,addAlignmentToDoc:function(e,t,n){R(e);let s=e;if(t>0){for(let e=0;e<Math.floor(t/n);++e)s=$(s);s=j(t%n,s),s=j(Number.NEGATIVE_INFINITY,s)}return s},markAsRoot:function(e){return j({type:"root"},e)},dedentToRoot:function(e){return j(Number.NEGATIVE_INFINITY,e)},dedent:function(e){return j(-1,e)},hardlineWithoutBreakParent:V,literallineWithoutBreakParent:H,label:function(e,t){return R(t),e?{type:m,label:e,contents:t}:t},concat:e=>e},pe={printDocToString:function(e,t){const n={},s=t.printWidth,r=function(e){switch(e){case"cr":return"\r";case"crlf":return"\r\n";default:return"\n"}}(t.endOfLine);let C=0;const _=[{ind:{value:"",length:0,queue:[]},mode:se,doc:e}],S=[];let B=!1;const x=[];let A=0;for(function(e){const t=new Set,n=[];w(e,function(e){if(e.type===E&&O(n),e.type===l){if(n.push(e),t.has(e))return!1;t.add(e)}},function(e){e.type===l&&n.pop().break&&O(n)},!0)}(e);_.length>0;){const{ind:e,mode:w,doc:O}=_.pop();switch(v(O)){case o:{const e="\n"!==r?Z(!1,O,"\n",r):O;S.push(e),_.length>0&&(C+=ne(e));break}case i:for(let t=O.length-1;t>=0;t--)_.push({ind:e,mode:w,doc:O[t]});break;case u:if(A>=2)throw new Error("There are too many 'cursor' in doc.");S.push(oe),A++;break;case a:_.push({ind:ue(e,t),mode:w,doc:O.contents});break;case c:_.push({ind:ae(e,O.n,t),mode:w,doc:O.contents});break;case D:C-=De(S);break;case l:switch(w){case re:if(!B){_.push({ind:e,mode:O.break?se:re,doc:O.contents});break}case se:{B=!1;const t={ind:e,mode:re,doc:O.contents},r=s-C,o=x.length>0;if(!O.break&&le(t,_,r,o,n))_.push(t);else if(O.expandedStates){const t=y(!1,O.expandedStates,-1);if(O.break){_.push({ind:e,mode:se,doc:t});break}for(let s=1;s<O.expandedStates.length+1;s++){if(s>=O.expandedStates.length){_.push({ind:e,mode:se,doc:t});break}{const t=O.expandedStates[s],i={ind:e,mode:re,doc:t};if(le(i,_,r,o,n)){_.push(i);break}}}}else _.push({ind:e,mode:se,doc:O.contents});break}}O.id&&(n[O.id]=y(!1,_,-1).mode);break;case d:{const t=s-C,r=O[ie]??0,{parts:o}=O,i=o.length-r;if(0===i)break;const u=o[r+0],a=o[r+1],c={ind:e,mode:re,doc:u},D={ind:e,mode:se,doc:u},l=le(c,[],t,x.length>0,n,!0);if(1===i){l?_.push(c):_.push(D);break}const d={ind:e,mode:re,doc:a},h={ind:e,mode:se,doc:a};if(2===i){l?_.push(d,c):_.push(h,D);break}const p=o[r+2],f={ind:e,mode:w,doc:{...O,[ie]:r+2}};le({ind:e,mode:re,doc:[u,a,p]},[],t,x.length>0,n,!0)?_.push(f,d,c):l?_.push(f,h,c):_.push(f,h,D);break}case h:case p:{const t=O.groupId?n[O.groupId]:w;if(t===se){const t=O.type===h?O.breakContents:O.negate?O.contents:$(O.contents);t&&_.push({ind:e,mode:w,doc:t})}if(t===re){const t=O.type===h?O.flatContents:O.negate?$(O.contents):O.contents;t&&_.push({ind:e,mode:w,doc:t})}break}case f:x.push({ind:e,mode:w,doc:O.contents});break;case g:x.length>0&&_.push({ind:e,mode:w,doc:V});break;case F:switch(w){case re:if(!O.hard){O.soft||(S.push(" "),C+=1);break}B=!0;case se:if(x.length>0){_.push({ind:e,mode:w,doc:O},...x.reverse()),x.length=0;break}O.literal?e.root?(S.push(r,e.root.value),C=e.root.length):(S.push(r),C=0):(C-=De(S),S.push(r+e.value),C=e.length)}break;case m:_.push({ind:e,mode:w,doc:O.contents});break;case E:break;default:throw new b(O)}0===_.length&&x.length>0&&(_.push(...x.reverse()),x.length=0)}const T=S.indexOf(oe);if(-1!==T){const e=S.indexOf(oe,T+1);if(-1===e)return{formatted:S.filter(e=>e!==oe).join("")};const t=S.slice(0,T).join(""),n=S.slice(T+1,e).join("");return{formatted:t+n+S.slice(e+1).join(""),cursorNodeStart:t.length,cursorNodeText:n}}return{formatted:S.join("")}}},fe={willBreak:function(e){return x(e,A,!1)},traverseDoc:w,findInDoc:x,mapDoc:B,removeLines:function(e){return B(e,T)},stripTrailingHardline:function(e){return N(function(e){return B(e,e=>function(e){switch(v(e)){case d:if(e.parts.every(e=>""===e))return"";break;case l:if(!(e.contents||e.id||e.break||e.expandedStates))return"";if(e.contents.type===l&&e.contents.id===e.id&&e.contents.break===e.break&&e.contents.expandedStates===e.expandedStates)return e.contents;break;case c:case a:case p:case f:if(!e.contents)return"";break;case h:if(!e.flatContents&&!e.breakContents)return"";break;case i:{const t=[];for(const n of e){if(!n)continue;const[e,...s]=Array.isArray(n)?n:[n];"string"==typeof e&&"string"==typeof y(!1,t,-1)?t[t.length-1]+=e:t.push(e),t.push(...s)}return 0===t.length?"":1===t.length?t[0]:t}case o:case u:case D:case g:case F:case m:case E:break;default:throw new b(e)}return e}(e))}(e))},replaceEndOfLine:function(e,t=Q){return B(e,e=>"string"==typeof e?Y(t,e.split("\n")):e)},canBreak:function(e){return x(e,P,!1)}};return de=r,((r,o,i,u)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let a of n(o))s.call(r,a)||a===i||e(r,a,{get:()=>o[a],enumerable:!(u=t(o,a))||u.enumerable});return r})(e({},"__esModule",{value:!0}),de)}();return e.default||e}()},1999:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ReactiveLintProvider=void 0;const u=n(1421),a=i(n(6760)),c=i(n(1398));class D{constructor(e){this.outputChannel=e,this.diagnosticCollection=c.languages.createDiagnosticCollection(D.DIAGNOSTIC_COLLECTION_NAME)}async analyzeFile(e){if(this.shouldAnalyze(e))try{const t=await this.runReactiveLint(e.uri.fsPath);this.updateDiagnostics(e,t)}catch(e){this.outputChannel.appendLine(`Reactive-lint error: ${e}`)}}shouldAnalyze(e){if(!c.workspace.getConfiguration("actor-spa").get("enableDiagnostics",!0))return!1;const t="typescript"===e.languageId||"typescriptreact"===e.languageId,n=e.uri.fsPath.includes(".test.")||e.uri.fsPath.includes(".spec."),s=e.uri.fsPath.includes("node_modules");return t&&!n&&!s}async runReactiveLint(e){return new Promise((t,s)=>{const r=c.workspace.getWorkspaceFolder(c.Uri.file(e)),o=r?.uri.fsPath||a.dirname(e),i=a.join(o,"node_modules",".bin","reactive-lint"),D=a.join(o,"extensions","reactive-lint","dist","cli.js"),l=[n(3024).existsSync(D)?D:i,e,"--format","json"],d=(0,u.spawn)("node",l,{cwd:o});let h="",p="";d.stdout.on("data",e=>{h+=e.toString()}),d.stderr.on("data",e=>{p+=e.toString()}),d.on("close",n=>{if(0===n||1===n)try{const n=this.parseReactiveLintOutput(h,e);t(n)}catch(n){const s=this.parsePlainTextOutput(h,e);t(s)}else s(new Error(`Reactive-lint failed with code ${n}: ${p}`))}),d.on("error",e=>{s(e)})})}parseReactiveLintOutput(e,t){if(!e.trim())return[];const n=[];try{const s=JSON.parse(e);if(s.violations)for(const e of s.violations)n.push({file:t,line:e.line-1,column:e.column-1,rule:e.rule,message:e.message,severity:"error"===e.severity?"error":"warning",fix:e.fix})}catch(n){return this.parsePlainTextOutput(e,t)}return n}parsePlainTextOutput(e,t){const n=[],s=e.split("\n");for(const e of s){const s=e.match(/âŒ ERROR\s+.*:(\d+):(\d+)\s+(.+?)\s+\(([^)]+)\)/);if(s){n.push({file:t,line:Number.parseInt(s[1])-1,column:Number.parseInt(s[2])-1,rule:s[4],message:s[3],severity:"error"});continue}const r=e.match(/â— WARN\s+.*:(\d+):(\d+)\s+(.+?)\s+\(([^)]+)\)/);r&&n.push({file:t,line:Number.parseInt(r[1])-1,column:Number.parseInt(r[2])-1,rule:r[4],message:r[3],severity:"warning"})}return n}updateDiagnostics(e,t){const n=[];for(const e of t){const t=new c.Range(e.line,e.column,e.line,e.column+10),s=new c.Diagnostic(t,`[${e.rule}] ${e.message}`,"error"===e.severity?c.DiagnosticSeverity.Error:c.DiagnosticSeverity.Warning);s.source="reactive-lint",s.code=e.rule,n.push(s)}this.diagnosticCollection.set(e.uri,n)}provideCodeActions(e,t,n,s){const r=[],o=n.diagnostics.filter(e=>"reactive-lint"===e.source);for(const t of o){const n=t.code,s=this.createQuickFix(e,t,n);s&&r.push(s);const o=new c.CodeAction(`Learn more about ${n}`,c.CodeActionKind.QuickFix);o.command={title:"Learn more",command:"actor-spa.showReactivePatternDocs",arguments:[n]},r.push(o)}return r}createQuickFix(e,t,n){const s=e.lineAt(t.range.start.line).text;switch(n){case"no-context-booleans":return this.createBooleanToStateQuickFix(e,t,s);case"no-dom-query":return this.createDomQueryQuickFix(e,t,s);case"no-timers":return this.createTimerQuickFix(e,t,s);case"no-event-listeners":return this.createEventListenerQuickFix(e,t,s);default:return}}createBooleanToStateQuickFix(e,t,n){const s=new c.CodeAction("Replace boolean with machine state",c.CodeActionKind.QuickFix);s.diagnostics=[t],s.edit=new c.WorkspaceEdit;const r=n.replace(/isVisible/g,"state.matches('visible')"),o=new c.Range(t.range.start.line,0,t.range.start.line,n.length);return s.edit.replace(e.uri,o,r),s}createDomQueryQuickFix(e,t,n){const s=new c.CodeAction("Replace DOM query with event communication",c.CodeActionKind.QuickFix);s.diagnostics=[t],s.edit=new c.WorkspaceEdit;const r=n.replace(/document\.querySelector\(['"]([^'"]+)['"]\)/g,"// TODO: Replace with event communication - see docs/REACTIVE_PATTERNS.md"),o=new c.Range(t.range.start.line,0,t.range.start.line,n.length);return s.edit.replace(e.uri,o,r),s}createTimerQuickFix(e,t,n){const s=new c.CodeAction("Replace timer with XState delayed transition",c.CodeActionKind.QuickFix);s.diagnostics=[t],s.edit=new c.WorkspaceEdit;const r=n.replace(/setTimeout\(/g,"// TODO: Replace with XState delayed transition - see docs/REACTIVE_PATTERNS.md"),o=new c.Range(t.range.start.line,0,t.range.start.line,n.length);return s.edit.replace(e.uri,o,r),s}createEventListenerQuickFix(e,t,n){const s=new c.CodeAction("Replace addEventListener with declarative event handling",c.CodeActionKind.QuickFix);s.diagnostics=[t],s.edit=new c.WorkspaceEdit;const r=n.replace(/addEventListener\(/g,"// TODO: Replace with declarative event handling - see docs/REACTIVE_PATTERNS.md"),o=new c.Range(t.range.start.line,0,t.range.start.line,n.length);return s.edit.replace(e.uri,o,r),s}dispose(){this.diagnosticCollection.dispose()}}t.ReactiveLintProvider=D,D.DIAGNOSTIC_COLLECTION_NAME="reactive-lint"},2203:e=>{"use strict";e.exports=require("stream")},2455:(e,t,n)=>{"use strict";n(3540);const{Duplex:s}=n(2203);function r(e){e.emit("close")}function o(){!this.destroyed&&this._writableState.finished&&this.destroy()}function i(e){this.removeListener("error",i),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let n=!0;const u=new s({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,n){const s=!n&&u._readableState.objectMode?t.toString():t;u.push(s)||e.pause()}),e.once("error",function(e){u.destroyed||(n=!1,u.destroy(e))}),e.once("close",function(){u.destroyed||u.push(null)}),u._destroy=function(t,s){if(e.readyState===e.CLOSED)return s(t),void process.nextTick(r,u);let o=!1;e.once("error",function(e){o=!0,s(e)}),e.once("close",function(){o||s(t),process.nextTick(r,u)}),n&&e.terminate()},u._final=function(t){e.readyState!==e.CONNECTING?null!==e._socket&&(e._socket._writableState.finished?(t(),u._readableState.endEmitted&&u.destroy()):(e._socket.once("finish",function(){t()}),e.close())):e.once("open",function(){u._final(t)})},u._read=function(){e.isPaused&&e.resume()},u._write=function(t,n,s){e.readyState!==e.CONNECTING?e.send(t,s):e.once("open",function(){u._write(t,n,s)})},u.on("end",o),u.on("error",i),u}},2459:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.coordinatorMachine=void 0;const u=i(n(1398)),a=n(3922),c=n(7071),D=(0,a.fromPromise)(async({input:e})=>{const{document:t}=e,n=(0,a.createActor)(c.discoveryMachine);return n.start(),new Promise((e,s)=>{const r=n.subscribe({next:t=>{t.matches("completed")?(n.stop(),e(t.context.templates)):t.matches("error")&&(n.stop(),s(new Error(t.context.errors.join(", "))))},error:e=>{n.stop(),s(e)}});n.send({type:"DISCOVER",document:t}),setTimeout(()=>{r.unsubscribe(),n.stop(),s(new Error("Discovery timeout"))},3e4)})}),l=(0,a.fromPromise)(async({input:e})=>{const{templates:t,options:s,config:r}=e,o=t.map((e,t)=>({id:`job-${t}`,template:e,status:"pending",startTime:Date.now()})),a=[],c=r.enableParallelProcessing?r.maxParallelJobs:1;for(let e=0;e<o.length;e+=c){const t=o.slice(e,e+c),D=t.map(async e=>{try{e.status="formatting";const{ActorSpaFormattingProvider:t}=await Promise.resolve().then(()=>i(n(9438))),o=u.window.createOutputChannel("Actor-SPA Coordinator Debug"),a=new t(o);o.appendLine(`ðŸ”§ Formatting job ${e.id}: ${e.template.language} template`),o.appendLine(`ðŸ“ Original content (${e.template.content.length} chars): ${e.template.content.substring(0,200)}${e.template.content.length>200?"...":""}`),o.show();const c={getText:()=>e.template.content,fileName:u.Uri.parse(`untitled:template-${Date.now()}.${e.template.language}`).fsPath,languageId:"html"===e.template.language?"html":"css",lineCount:e.template.lineCount,positionAt:e=>new u.Position(0,e),offsetAt:e=>e.character},D=a.provideDocumentFormattingEdits(c,s,(new u.CancellationTokenSource).token).then(t=>t.length>0?t[0].newText:e.template.content),l=await Promise.race([D,new Promise((e,t)=>{setTimeout(()=>{t(new Error("Formatting timeout"))},r.timeout)})]);return e.status="completed",e.result=l,e.endTime=Date.now(),e}catch(t){return e.status="error",e.error=t instanceof Error?t.message:String(t),e.endTime=Date.now(),e}});(await Promise.allSettled(D)).forEach((e,n)=>{if("fulfilled"===e.status)a.push(e.value);else{const s=t[n];s.status="error",s.error=e.reason instanceof Error?e.reason.message:String(e.reason),s.endTime=Date.now(),a.push(s)}})}return a});function d(){const e=u.workspace.getConfiguration("actor-spa.formatting");return{maxParallelJobs:e.get("maxParallelJobs",4),timeout:e.get("timeout",1e4),preferredFormatter:e.get("preferredFormatter","biome"),enableParallelProcessing:e.get("enableParallelProcessing",!0)}}function h(e){const t=[];for(const n of e)"completed"===n.status&&n.result&&n.result!==n.template.content&&t.push(u.TextEdit.replace(n.template.range,n.result));return t}t.coordinatorMachine=(0,a.setup)({types:{context:{},events:{}},actors:{runDiscovery:D,parallelFormatting:l},actions:{initializeFormatting:(0,a.assign)({document:({event:e})=>"FORMAT"===e.type?e.document:null,options:({event:e})=>"FORMAT"===e.type?e.options:{tabSize:2,insertSpaces:!0},config:()=>d(),stats:()=>({totalTemplates:0,successfulJobs:0,failedJobs:0,processingTimeMs:0,startTime:Date.now()}),templates:[],jobs:[],completedJobs:[],errors:[],edits:[]}),setDiscoveryResults:(0,a.assign)({templates:({event:e})=>"DISCOVERY_COMPLETE"===e.type?e.templates:[],stats:({context:e,event:t})=>"DISCOVERY_COMPLETE"===t.type?{...e.stats,totalTemplates:t.templates.length}:e.stats}),setFormattingResults:(0,a.assign)({completedJobs:({event:e})=>(e.type,[]),edits:({context:e})=>h(e.completedJobs),stats:({context:e})=>{const t=Date.now(),n=e.completedJobs.filter(e=>"completed"===e.status).length,s=e.completedJobs.filter(e=>"error"===e.status).length;return{...e.stats,successfulJobs:n,failedJobs:s,processingTimeMs:t-e.stats.startTime,endTime:t}}}),addError:(0,a.assign)({errors:({context:e,event:t})=>"ERROR"===t.type?[...e.errors,t.error]:e.errors}),resetState:(0,a.assign)({document:null,options:{tabSize:2,insertSpaces:!0},templates:[],jobs:[],completedJobs:[],errors:[],edits:[],stats:{totalTemplates:0,successfulJobs:0,failedJobs:0,processingTimeMs:0,startTime:Date.now()},config:()=>d()})}}).createMachine({id:"coordinator",initial:"idle",context:{document:null,options:{tabSize:2,insertSpaces:!0},templates:[],jobs:[],completedJobs:[],errors:[],edits:[],stats:{totalTemplates:0,successfulJobs:0,failedJobs:0,processingTimeMs:0,startTime:Date.now()},config:{maxParallelJobs:4,timeout:1e4,preferredFormatter:"biome",enableParallelProcessing:!0}},states:{idle:{on:{FORMAT:{target:"discovering",actions:"initializeFormatting"}}},discovering:{invoke:{id:"runDiscovery",src:"runDiscovery",input:({context:e})=>{if(!e.document)throw new Error("No document provided for discovery");return{document:e.document}},onDone:{target:"coordinating",actions:(0,a.assign)({templates:({event:e})=>e.output,stats:({context:e,event:t})=>({...e.stats,totalTemplates:t.output.length})})},onError:{target:"error",actions:(0,a.assign)({errors:({context:e,event:t})=>[...e.errors,`Discovery error: ${String(t.error)}`]})}}},coordinating:{always:[{target:"completing",guard:({context:e})=>0===e.templates.length},{target:"parallelProcessing"}]},parallelProcessing:{invoke:{id:"parallelFormatting",src:"parallelFormatting",input:({context:e})=>({templates:e.templates,options:e.options,config:e.config}),onDone:{target:"aggregating",actions:(0,a.assign)({completedJobs:({event:e})=>e.output})},onError:{target:"error",actions:(0,a.assign)({errors:({context:e,event:t})=>[...e.errors,`Parallel processing error: ${String(t.error)}`]})}}},aggregating:{entry:(0,a.assign)({edits:({context:e})=>h(e.completedJobs),stats:({context:e})=>{const t=Date.now(),n=e.completedJobs.filter(e=>"completed"===e.status).length,s=e.completedJobs.filter(e=>"error"===e.status).length;return{...e.stats,successfulJobs:n,failedJobs:s,processingTimeMs:t-e.stats.startTime,endTime:t}}}),always:{target:"completing"}},completing:{type:"final"},error:{on:{RETRY:{target:"discovering"},RESET:{target:"idle",actions:"resetState"}}}}})},2613:e=>{"use strict";e.exports=require("assert")},2902:(e,t,n)=>{"use strict";const{tokenChars:s}=n(7672);function r(e,t,n){void 0===e[t]?e[t]=[n]:e[t].push(n)}e.exports={format:function(e){return Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>[t].concat(Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){const t=Object.create(null);let n,o,i=Object.create(null),u=!1,a=!1,c=!1,D=-1,l=-1,d=-1,h=0;for(;h<e.length;h++)if(l=e.charCodeAt(h),void 0===n)if(-1===d&&1===s[l])-1===D&&(D=h);else if(0===h||32!==l&&9!==l){if(59!==l&&44!==l)throw new SyntaxError(`Unexpected character at index ${h}`);{if(-1===D)throw new SyntaxError(`Unexpected character at index ${h}`);-1===d&&(d=h);const s=e.slice(D,d);44===l?(r(t,s,i),i=Object.create(null)):n=s,D=d=-1}}else-1===d&&-1!==D&&(d=h);else if(void 0===o)if(-1===d&&1===s[l])-1===D&&(D=h);else if(32===l||9===l)-1===d&&-1!==D&&(d=h);else if(59===l||44===l){if(-1===D)throw new SyntaxError(`Unexpected character at index ${h}`);-1===d&&(d=h),r(i,e.slice(D,d),!0),44===l&&(r(t,n,i),i=Object.create(null),n=void 0),D=d=-1}else{if(61!==l||-1===D||-1!==d)throw new SyntaxError(`Unexpected character at index ${h}`);o=e.slice(D,h),D=d=-1}else if(a){if(1!==s[l])throw new SyntaxError(`Unexpected character at index ${h}`);-1===D?D=h:u||(u=!0),a=!1}else if(c)if(1===s[l])-1===D&&(D=h);else if(34===l&&-1!==D)c=!1,d=h;else{if(92!==l)throw new SyntaxError(`Unexpected character at index ${h}`);a=!0}else if(34===l&&61===e.charCodeAt(h-1))c=!0;else if(-1===d&&1===s[l])-1===D&&(D=h);else if(-1===D||32!==l&&9!==l){if(59!==l&&44!==l)throw new SyntaxError(`Unexpected character at index ${h}`);{if(-1===D)throw new SyntaxError(`Unexpected character at index ${h}`);-1===d&&(d=h);let s=e.slice(D,d);u&&(s=s.replace(/\\/g,""),u=!1),r(i,o,s),44===l&&(r(t,n,i),i=Object.create(null),n=void 0),o=void 0,D=d=-1}}else-1===d&&(d=h);if(-1===D||c||32===l||9===l)throw new SyntaxError("Unexpected end of input");-1===d&&(d=h);const p=e.slice(D,d);return void 0===n?r(t,p,i):(void 0===o?r(i,p,!0):r(i,o,u?p.replace(/\\/g,""):p),r(t,n,i)),t}}},3024:e=>{"use strict";e.exports=require("node:fs")},3106:e=>{"use strict";e.exports=require("zlib")},3339:e=>{"use strict";e.exports=require("module")},3384:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.initializeAICommunication=async function(e,t){p=(0,D.createDebugLogger)(t);const n=u.workspace.getConfiguration("actor-spa.aiCommunication");if(!n.get("enabled",!1))return void p.info(D.COMPONENTS.EXTENSION,"AI Communication is disabled");p.info(D.COMPONENTS.EXTENSION,"ðŸš€ Initializing AI Communication system"),d=(0,a.createAICommunicationBridge)(p),d.start();const s=n.get("config.communicationMethod","file");if("websocket"===s){const e={port:n.get("config.websocketPort",8765),host:n.get("config.websocketHost","localhost")};h=(0,c.createWebSocketServer)(e,p),h.start(),h.send({type:"START"})}f=(0,a.createAIAgent)("claude","Claude Assistant"),d.send({type:"CONNECT",agent:f}),"file"===s&&function(e){const t=u.workspace.workspaceFolders?.[0];if(!t)return;const n=new u.RelativePattern(t,".ai-messages/*.json"),s=u.workspace.createFileSystemWatcher(n);s.onDidCreate(async e=>{try{const t=await u.workspace.fs.readFile(e),n=JSON.parse(Buffer.from(t).toString());n.source.id!==f?.id&&d?.send({type:"MESSAGE_RECEIVED",message:n})}catch(t){p?.error(D.COMPONENTS.EXTENSION,"Failed to process incoming message",{uri:e.toString()},t)}}),e.subscriptions.push(s)}(e),p.info(D.COMPONENTS.EXTENSION,"âœ… AI Communication system initialized",{method:s,agentId:f.id})},t.registerAICommunicationCommands=function(e){const t=u.commands.registerCommand("actor-spa.ai.sendMessage",async()=>{if(!d||!f)return void u.window.showErrorMessage("AI Communication not initialized");const e=Object.values(l.MessageType),t=await u.window.showQuickPick(e,{placeHolder:"Select message type"});if(!t)return;const n=await u.window.showQuickPick(["broadcast","specific-agent"],{placeHolder:"Select target"});if(!n)return;let s="broadcast";if("specific-agent"===n){const e=await u.window.showInputBox({prompt:"Enter target agent ID",placeHolder:"agent-id"});if(!e)return;s=(0,a.createAIAgent)("cursor","Cursor Assistant"),s.id=e}const r=await async function(e){switch(e){case l.MessageType.CODE_REVIEW_REQUEST:return{file:await u.window.showInputBox({prompt:"Enter file path",placeHolder:"src/components/Button.tsx"})||"",context:await u.window.showInputBox({prompt:"Enter review context",placeHolder:"Please review for performance"})};case l.MessageType.KNOWLEDGE_QUERY:return{question:await u.window.showInputBox({prompt:"Enter your question",placeHolder:"How do I implement..."})||""};case l.MessageType.TASK_ASSIGNMENT:{const e=await u.window.showInputBox({prompt:"Enter task title"}),t=await u.window.showInputBox({prompt:"Enter task description"});return{taskId:`task-${Date.now()}`,title:e||"",description:t||"",priority:"medium"}}default:return{}}}(t);if(!r)return;const o=(0,a.createMessage)(f,s,t,r,{priority:l.MessagePriority.NORMAL,channel:(i=t,i.includes("CODE_REVIEW")?l.CommunicationChannel.CODE_REVIEW:i.includes("REFACTOR")?l.CommunicationChannel.REFACTORING:i.includes("ARCHITECTURE")?l.CommunicationChannel.ARCHITECTURE:i.includes("TASK")?l.CommunicationChannel.TASK_COORDINATION:i.includes("KNOWLEDGE")?l.CommunicationChannel.KNOWLEDGE_SHARING:l.CommunicationChannel.GENERAL)});var i;d.send({type:"SEND_MESSAGE",message:o}),u.window.showInformationMessage(`Message sent: ${t}`)}),n=u.commands.registerCommand("actor-spa.ai.getMessageHistory",async()=>{if(!d)return void u.window.showErrorMessage("AI Communication not initialized");const e=d.getSnapshot().context.messageHistory;0!==e.length?u.window.createWebviewPanel("aiMessageHistory","AI Message History",u.ViewColumn.One,{enableScripts:!0}).webview.html=`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <style>\n        body { font-family: sans-serif; padding: 20px; }\n        .message { border: 1px solid #ddd; margin: 10px 0; padding: 10px; }\n        .header { display: flex; justify-content: space-between; margin-bottom: 10px; }\n        .source { font-weight: bold; }\n        .type { color: #666; }\n        .time { color: #999; font-size: 0.9em; }\n        pre { background: #f5f5f5; padding: 10px; overflow: auto; }\n      </style>\n    </head>\n    <body>\n      <h1>AI Message History</h1>\n      ${e.map(e=>`\n    <div class="message">\n      <div class="header">\n        <span class="source">${e.source.name}</span>\n        <span class="type">${e.type}</span>\n        <span class="time">${new Date(e.timestamp).toLocaleString()}</span>\n      </div>\n      <div class="payload">\n        <pre>${JSON.stringify(e.payload,null,2)}</pre>\n      </div>\n    </div>\n  `).join("")}\n    </body>\n    </html>\n  `:u.window.showInformationMessage("No messages in history")}),s=u.commands.registerCommand("actor-spa.ai.subscribeToChannel",async()=>{if(!d)return void u.window.showErrorMessage("AI Communication not initialized");const e=Object.values(l.CommunicationChannel),t=await u.window.showQuickPick(e,{placeHolder:"Select channel to subscribe"});t&&(d.send({type:"SUBSCRIBE",channel:t,callback:e=>{u.window.showInformationMessage(`${e.source.name}: ${e.type}`,"View").then(t=>{"View"===t&&(u.window.createWebviewPanel("aiMessage","AI Message",u.ViewColumn.Two,{}).webview.html=function(e){return`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <style>\n        body { font-family: sans-serif; padding: 20px; }\n        h2 { color: #333; }\n        .field { margin: 10px 0; }\n        .label { font-weight: bold; }\n        pre { background: #f5f5f5; padding: 10px; overflow: auto; }\n      </style>\n    </head>\n    <body>\n      <h1>AI Message Detail</h1>\n      <div class="field">\n        <span class="label">From:</span> ${e.source.name} (${e.source.type})\n      </div>\n      <div class="field">\n        <span class="label">Type:</span> ${e.type}\n      </div>\n      <div class="field">\n        <span class="label">Time:</span> ${new Date(e.timestamp).toLocaleString()}\n      </div>\n      <div class="field">\n        <span class="label">Channel:</span> ${e.metadata.channel}\n      </div>\n      <div class="field">\n        <span class="label">Priority:</span> ${e.metadata.priority}\n      </div>\n      <h2>Payload</h2>\n      <pre>${JSON.stringify(e.payload,null,2)}</pre>\n      <h2>Full Message</h2>\n      <pre>${JSON.stringify(e,null,2)}</pre>\n    </body>\n    </html>\n  `}(e))})}}),u.window.showInformationMessage(`Subscribed to ${t} channel`))}),r=u.commands.registerCommand("actor-spa.ai.getStats",()=>{if(!d)return void u.window.showErrorMessage("AI Communication not initialized");const e=d.getSnapshot().context.stats;u.window.showInformationMessage(`AI Communication Stats:\n        Messages Sent: ${e.messagesSent}\n        Messages Received: ${e.messagesReceived}\n        Active Connections: ${e.activeConnections}\n        Average Latency: ${Math.round(e.averageLatency)}ms`)}),o=u.commands.registerCommand("actor-spa.ai.startWebSocketServer",()=>{if(!h){const e=u.workspace.getConfiguration("actor-spa.aiCommunication");if(!p)return void u.window.showErrorMessage("Debug logger not initialized");h=(0,c.createWebSocketServer)({port:e.get("config.websocketPort",8765)},p),h.start()}h.send({type:"START"}),u.window.showInformationMessage("WebSocket server started")}),i=u.commands.registerCommand("actor-spa.ai.stopWebSocketServer",()=>{h&&(h.send({type:"STOP"}),u.window.showInformationMessage("WebSocket server stopped"))});e.subscriptions.push(t,n,s,r,o,i)},t.cleanupAICommunication=function(){d&&(d.stop(),d=null),h&&(h.send({type:"STOP"}),h.stop(),h=null),p?.info(D.COMPONENTS.EXTENSION,"ðŸ‘‹ AI Communication system cleaned up")};const u=i(n(1398)),a=n(9157),c=n(9153),D=n(9600),l=n(843);let d=null,h=null,p=null,f=null},3540:(e,t,n)=>{"use strict";const s=n(4434),r=n(5692),o=n(8611),i=n(9278),u=n(4756),{randomBytes:a,createHash:c}=n(6982),{Duplex:D,Readable:l}=n(2203),{URL:d}=n(7016),h=n(9147),p=n(4910),f=n(7730),{isBlob:g}=n(7672),{BINARY_TYPES:F,EMPTY_BUFFER:m,GUID:E,kForOnEventAttribute:C,kListener:y,kStatusCode:v,kWebSocket:_,NOOP:b}=n(6614),{EventTarget:{addEventListener:S,removeEventListener:w}}=n(8165),{format:B,parse:x}=n(2902),{toBuffer:A}=n(6890),O=Symbol("kAborted"),T=[8,13],k=["CONNECTING","OPEN","CLOSING","CLOSED"],N=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class P extends s{constructor(e,t,n){super(),this._binaryType=F[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=m,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=P.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(n=t,t=[]):t=[t]),I(this,e,t,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){F.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,n){const s=new p({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),r=new f(e,this._extensions,n.generateMask);this._receiver=s,this._sender=r,this._socket=e,s[_]=this,r[_]=this,e[_]=this,s.on("conclude",U),s.on("drain",W),s.on("error",G),s.on("message",V),s.on("ping",H),s.on("pong",q),r.onerror=X,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",K),e.on("data",Y),e.on("end",Z),e.on("error",ee),this._readyState=P.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=P.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[h.extensionName]&&this._extensions[h.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=P.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==P.CLOSED){if(this.readyState===P.CONNECTING){const e="WebSocket was closed before the connection was established";return void $(this,this._req,e)}this.readyState!==P.CLOSING?(this._readyState=P.CLOSING,this._sender.close(e,t,!this._isServer,e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),Q(this)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end()}}pause(){this.readyState!==P.CONNECTING&&this.readyState!==P.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,n){if(this.readyState===P.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===P.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||m,t,n)):j(this,e,n)}pong(e,t,n){if(this.readyState===P.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===P.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||m,t,n)):j(this,e,n)}resume(){this.readyState!==P.CONNECTING&&this.readyState!==P.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,n){if(this.readyState===P.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(n=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==P.OPEN)return void j(this,e,n);const s={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[h.extensionName]||(s.compress=!1),this._sender.send(e||m,s,n)}terminate(){if(this.readyState!==P.CLOSED){if(this.readyState===P.CONNECTING){const e="WebSocket was closed before the connection was established";return void $(this,this._req,e)}this._socket&&(this._readyState=P.CLOSING,this._socket.destroy())}}}function I(e,t,n,s){const i={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:T[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(e._autoPong=i.autoPong,!T.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${T.join(", ")})`);let u;if(t instanceof d)u=t;else try{u=new d(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}"http:"===u.protocol?u.protocol="ws:":"https:"===u.protocol&&(u.protocol="wss:"),e._url=u.href;const D="wss:"===u.protocol,l="ws+unix:"===u.protocol;let p;if("ws:"===u.protocol||D||l?l&&!u.pathname?p="The URL's pathname is empty":u.hash&&(p="The URL contains a fragment identifier"):p='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',p){const t=new SyntaxError(p);if(0===e._redirects)throw t;return void R(e,t)}const f=D?443:80,g=a(16).toString("base64"),F=D?r.request:o.request,m=new Set;let C,y;if(i.createConnection=i.createConnection||(D?L:M),i.defaultPort=i.defaultPort||f,i.port=u.port||f,i.host=u.hostname.startsWith("[")?u.hostname.slice(1,-1):u.hostname,i.headers={...i.headers,"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":g,Connection:"Upgrade",Upgrade:"websocket"},i.path=u.pathname+u.search,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(C=new h(!0!==i.perMessageDeflate?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=B({[h.extensionName]:C.offer()})),n.length){for(const e of n){if("string"!=typeof e||!N.test(e)||m.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");m.add(e)}i.headers["Sec-WebSocket-Protocol"]=n.join(",")}if(i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),(u.username||u.password)&&(i.auth=`${u.username}:${u.password}`),l){const e=i.path.split(":");i.socketPath=e[0],i.path=e[1]}if(i.followRedirects){if(0===e._redirects){e._originalIpc=l,e._originalSecure=D,e._originalHostOrSocketPath=l?i.socketPath:u.host;const t=s&&s.headers;if(s={...s,headers:{}},t)for(const[e,n]of Object.entries(t))s.headers[e.toLowerCase()]=n}else if(0===e.listenerCount("redirect")){const t=l?!!e._originalIpc&&i.socketPath===e._originalHostOrSocketPath:!e._originalIpc&&u.host===e._originalHostOrSocketPath;(!t||e._originalSecure&&!D)&&(delete i.headers.authorization,delete i.headers.cookie,t||delete i.headers.host,i.auth=void 0)}i.auth&&!s.headers.authorization&&(s.headers.authorization="Basic "+Buffer.from(i.auth).toString("base64")),y=e._req=F(i),e._redirects&&e.emit("redirect",e.url,y)}else y=e._req=F(i);i.timeout&&y.on("timeout",()=>{$(e,y,"Opening handshake has timed out")}),y.on("error",t=>{null===y||y[O]||(y=e._req=null,R(e,t))}),y.on("response",r=>{const o=r.headers.location,u=r.statusCode;if(o&&i.followRedirects&&u>=300&&u<400){if(++e._redirects>i.maxRedirects)return void $(e,y,"Maximum redirects exceeded");let r;y.abort();try{r=new d(o,t)}catch(t){const n=new SyntaxError(`Invalid URL: ${o}`);return void R(e,n)}I(e,r,n,s)}else e.emit("unexpected-response",y,r)||$(e,y,`Unexpected server response: ${r.statusCode}`)}),y.on("upgrade",(t,n,s)=>{if(e.emit("upgrade",t),e.readyState!==P.CONNECTING)return;y=e._req=null;const r=t.headers.upgrade;if(void 0===r||"websocket"!==r.toLowerCase())return void $(e,n,"Invalid Upgrade header");const o=c("sha1").update(g+E).digest("base64");if(t.headers["sec-websocket-accept"]!==o)return void $(e,n,"Invalid Sec-WebSocket-Accept header");const u=t.headers["sec-websocket-protocol"];let a;if(void 0!==u?m.size?m.has(u)||(a="Server sent an invalid subprotocol"):a="Server sent a subprotocol but none was requested":m.size&&(a="Server sent no subprotocol"),a)return void $(e,n,a);u&&(e._protocol=u);const D=t.headers["sec-websocket-extensions"];if(void 0!==D){if(!C)return void $(e,n,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");let t;try{t=x(D)}catch(t){return void $(e,n,"Invalid Sec-WebSocket-Extensions header")}const s=Object.keys(t);if(1!==s.length||s[0]!==h.extensionName)return void $(e,n,"Server indicated an extension that was not requested");try{C.accept(t[h.extensionName])}catch(t){return void $(e,n,"Invalid Sec-WebSocket-Extensions header")}e._extensions[h.extensionName]=C}e.setSocket(n,s,{allowSynchronousEvents:i.allowSynchronousEvents,generateMask:i.generateMask,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation})}),i.finishRequest?i.finishRequest(y,e):y.end()}function R(e,t){e._readyState=P.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function M(e){return e.path=e.socketPath,i.connect(e)}function L(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=i.isIP(e.host)?"":e.host),u.connect(e)}function $(e,t,n){e._readyState=P.CLOSING;const s=new Error(n);Error.captureStackTrace(s,$),t.setHeader?(t[O]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(R,e,s)):(t.destroy(s),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function j(e,t,n){if(t){const n=g(t)?t.size:A(t).length;e._socket?e._sender._bufferedBytes+=n:e._bufferedAmount+=n}if(n){const t=new Error(`WebSocket is not open: readyState ${e.readyState} (${k[e.readyState]})`);process.nextTick(n,t)}}function U(e,t){const n=this[_];n._closeFrameReceived=!0,n._closeMessage=t,n._closeCode=e,void 0!==n._socket[_]&&(n._socket.removeListener("data",Y),process.nextTick(J,n._socket),1005===e?n.close():n.close(e,t))}function W(){const e=this[_];e.isPaused||e._socket.resume()}function G(e){const t=this[_];void 0!==t._socket[_]&&(t._socket.removeListener("data",Y),process.nextTick(J,t._socket),t.close(e[v])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function z(){this[_].emitClose()}function V(e,t){this[_].emit("message",e,t)}function H(e){const t=this[_];t._autoPong&&t.pong(e,!this._isServer,b),t.emit("ping",e)}function q(e){this[_].emit("pong",e)}function J(e){e.resume()}function X(e){const t=this[_];t.readyState!==P.CLOSED&&(t.readyState===P.OPEN&&(t._readyState=P.CLOSING,Q(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function Q(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),3e4)}function K(){const e=this[_];let t;this.removeListener("close",K),this.removeListener("data",Y),this.removeListener("end",Z),e._readyState=P.CLOSING,this._readableState.endEmitted||e._closeFrameReceived||e._receiver._writableState.errorEmitted||null===(t=e._socket.read())||e._receiver.write(t),e._receiver.end(),this[_]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",z),e._receiver.on("finish",z))}function Y(e){this[_]._receiver.write(e)||this.pause()}function Z(){const e=this[_];e._readyState=P.CLOSING,e._receiver.end(),this.end()}function ee(){const e=this[_];this.removeListener("error",ee),this.on("error",b),e&&(e._readyState=P.CLOSING,this.destroy())}Object.defineProperty(P,"CONNECTING",{enumerable:!0,value:k.indexOf("CONNECTING")}),Object.defineProperty(P.prototype,"CONNECTING",{enumerable:!0,value:k.indexOf("CONNECTING")}),Object.defineProperty(P,"OPEN",{enumerable:!0,value:k.indexOf("OPEN")}),Object.defineProperty(P.prototype,"OPEN",{enumerable:!0,value:k.indexOf("OPEN")}),Object.defineProperty(P,"CLOSING",{enumerable:!0,value:k.indexOf("CLOSING")}),Object.defineProperty(P.prototype,"CLOSING",{enumerable:!0,value:k.indexOf("CLOSING")}),Object.defineProperty(P,"CLOSED",{enumerable:!0,value:k.indexOf("CLOSED")}),Object.defineProperty(P.prototype,"CLOSED",{enumerable:!0,value:k.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(P.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(P.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[C])return t[y];return null},set(t){for(const t of this.listeners(e))if(t[C]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[C]:!0})}})}),P.prototype.addEventListener=S,P.prototype.removeEventListener=w,e.exports=P},3747:(e,t,n)=>{"use strict";const s=n(3540);s.createWebSocketStream=n(2455),s.Server=n(8410),s.Receiver=n(4910),s.Sender=n(7730),s.WebSocket=s,s.WebSocketServer=s.Server,e.exports=s},3917:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ActorRangeFormattingProvider=t.ActorFormattingProvider=void 0,t.createFormattingProvider=function(e,t){if(u.workspace.getConfiguration("actor-spa").get("useActorFormatter",!0))return{documentProvider:new l(e,t),rangeProvider:new d(e,t)};const{XStateFormattingProvider:s,XStateRangeFormattingProvider:r}=n(7679);return{documentProvider:new s(e),rangeProvider:new r(e)}};const u=i(n(1398)),a=n(3922),c=n(9600),D=n(2459);class l{constructor(e,t){this.debugLogger=t;const n=u.extensions.getExtension("actor-spa.actor-spa-framework");this.version=n?.packageJSON?.version||"unknown",this.log(`ðŸš€ Actor-based formatting provider v${this.version} initialized`)}log(e,t){this.debugLogger&&this.debugLogger.debug(c.COMPONENTS.ACTOR_FORMATTER,e,t)}async provideDocumentFormattingEdits(e,t,n){this.log(`ðŸŽ¬ Starting actor-based formatting for ${e.fileName}`,{languageId:e.languageId,lineCount:e.lineCount,tabSize:t.tabSize,insertSpaces:t.insertSpaces});try{if(!u.workspace.getConfiguration("actor-spa.formatting").get("enabled",!0))return this.log("âŒ Formatting disabled in configuration"),[];const s=(0,a.createActor)(D.coordinatorMachine);return this.log("ðŸŽ­ Created coordinator actor, starting machine"),s.start(),new Promise(r=>{let o=!1;const i=n.onCancellationRequested(()=>{o||(o=!0,this.log("âš ï¸ Formatting cancelled by user"),s.stop(),r([]))}),u=s.subscribe({next:e=>{if(this.log(`ðŸ“Š Actor state: ${JSON.stringify(e.value)}`,{context:{templatesFound:e.context.templates.length,jobsCompleted:e.context.completedJobs.length,errors:e.context.errors.length,edits:e.context.edits.length}}),e.matches("completing")&&!o){o=!0;const t=e.context.stats;this.log("âœ… Formatting completed successfully",{totalTemplates:t.totalTemplates,successfulJobs:t.successfulJobs,failedJobs:t.failedJobs,processingTimeMs:t.processingTimeMs,editsGenerated:e.context.edits.length}),u.unsubscribe(),i.dispose(),s.stop(),r(e.context.edits)}else if(e.matches("error")&&!o){o=!0;const t=e.context.errors;this.log("âŒ Formatting failed with errors",{errors:t,errorCount:t.length}),u.unsubscribe(),i.dispose(),s.stop(),r([])}},error:e=>{o||(o=!0,this.log("ðŸ’¥ Actor subscription error",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),u.unsubscribe(),i.dispose(),s.stop(),r([]))}});this.log("ðŸš€ Sending FORMAT event to coordinator"),s.send({type:"FORMAT",document:e,options:t,token:n}),setTimeout(()=>{o||(o=!0,this.log("â° Formatting timeout - operation took too long"),u.unsubscribe(),i.dispose(),s.stop(),r([]))},6e4)})}catch(e){return this.log("ðŸ’¥ Unexpected formatting error",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),[]}}}t.ActorFormattingProvider=l;class d{constructor(e,t){this.formattingProvider=new l(e,t)}async provideDocumentRangeFormattingEdits(e,t,n,s){return this.formattingProvider.provideDocumentFormattingEdits(e,n,s)}}t.ActorRangeFormattingProvider=d},3922:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Actor:()=>N,SimulatedClock:()=>Ut,SpecialTargets:()=>_t,StateMachine:()=>Et,StateNode:()=>mt,__unsafe_getAllOwnEventDescriptors:()=>B,and:()=>K,assertEvent:()=>It,assign:()=>ht,cancel:()=>L,createActor:()=>P,createEmptyActor:()=>Dt,createMachine:()=>Rt,emit:()=>vt,enqueueActions:()=>Tt,forwardTo:()=>At,fromCallback:()=>Ze,fromEventObservable:()=>rt,fromObservable:()=>st,fromPromise:()=>at,fromTransition:()=>Ke,getInitialSnapshot:()=>Lt,getNextSnapshot:()=>$t,getStateNodes:()=>Fe,initialTransition:()=>zt,interpret:()=>I,isMachineSnapshot:()=>Le,log:()=>Pt,matchesState:()=>h,not:()=>X,or:()=>Z,pathToStateValue:()=>g,raise:()=>Qe,sendParent:()=>xt,sendTo:()=>Bt,setup:()=>jt,spawnChild:()=>U,stateIn:()=>q,stop:()=>V,stopChild:()=>z,toObserver:()=>b,toPromise:()=>Wt,transition:()=>Gt,waitFor:()=>Ht});const s=e=>{if("undefined"==typeof window)return;const t=function(){const e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0;if(e.__xstate__)return e.__xstate__}();t&&t.register(e)};class r{constructor(e){this._process=e,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(e){const t={value:e,next:null};if(this._current)return this._last.next=t,void(this._last=t);this._current=t,this._last=t,this._active&&this.flush()}flush(){for(;this._current;){const e=this._current;this._process(e.value),this._current=e.next}this._last=null}}const o="xstate.init",i="xstate.error",u="xstate.stop";function a(e,t){return{type:`xstate.done.state.${e}`,output:t}}function c(e,t){return{type:`xstate.error.actor.${e}`,error:t,actorId:e}}function D(e){return{type:o,input:e}}function l(e){setTimeout(()=>{throw e})}const d="function"==typeof Symbol&&Symbol.observable||"@@observable";function h(e,t){const n=f(e),s=f(t);return"string"==typeof s?"string"==typeof n&&s===n:"string"==typeof n?n in s:Object.keys(n).every(e=>e in s&&h(n[e],s[e]))}function p(e){if(y(e))return e;const t=[];let n="";for(let s=0;s<e.length;s++){switch(e.charCodeAt(s)){case 92:n+=e[s+1],s++;continue;case 46:t.push(n),n="";continue}n+=e[s]}return t.push(n),t}function f(e){return Le(e)?e.value:"string"!=typeof e?e:g(p(e))}function g(e){if(1===e.length)return e[0];const t={};let n=t;for(let t=0;t<e.length-1;t++)if(t===e.length-2)n[e[t]]=e[t+1];else{const s=n;n={},s[e[t]]=n}return t}function F(e,t){const n={},s=Object.keys(e);for(let r=0;r<s.length;r++){const o=s[r];n[o]=t(e[o],o,e,r)}return n}function m(e){return y(e)?e:[e]}function E(e){return void 0===e?[]:m(e)}function C(e,t,n,s){return"function"==typeof e?e({context:t,event:n,self:s}):e}function y(e){return Array.isArray(e)}function v(e){return m(e).map(e=>void 0===e||"string"==typeof e?{target:e}:e)}function _(e){if(void 0!==e&&""!==e)return E(e)}function b(e,t,n){const s="object"==typeof e,r=s?e:void 0;return{next:(s?e.next:e)?.bind(r),error:(s?e.error:t)?.bind(r),complete:(s?e.complete:n)?.bind(r)}}function S(e,t){return`${t}.${e}`}function w(e,t){const n=t.match(/^xstate\.invoke\.(\d+)\.(.*)/);if(!n)return e.implementations.actors[t];const[,s,r]=n,o=e.getStateNodeById(r).config.invoke;return(Array.isArray(o)?o[s]:o).src}function B(e){return[...new Set([...e._nodes.flatMap(e=>e.ownEvents)])]}function x(e,t){return`${e.sessionId}.${t}`}let A=0,O=!1,T=function(e){return e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped",e}({});const k={clock:{setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e)},logger:console.log.bind(console),devTools:!1};class N{constructor(e,t){this.logic=e,this._snapshot=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new r(this._process.bind(this)),this.observers=new Set,this.eventListeners=new Map,this.logger=void 0,this._processingStatus=T.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const n={...k,...t},{clock:s,logger:o,parent:i,syncSnapshot:u,id:a,systemId:c,inspect:D}=n;this.system=i?i.system:function(e,t){const n=new Map,s=new Map,r=new WeakMap,o=new Set,i={},{clock:u,logger:a}=t,c={schedule:(e,t,n,s,r=Math.random().toString(36).slice(2))=>{const o={source:e,target:t,event:n,delay:s,id:r,startedAt:Date.now()},a=x(e,r);D._snapshot._scheduledEvents[a]=o;const c=u.setTimeout(()=>{delete i[a],delete D._snapshot._scheduledEvents[a],D._relay(e,t,n)},s);i[a]=c},cancel:(e,t)=>{const n=x(e,t),s=i[n];delete i[n],delete D._snapshot._scheduledEvents[n],void 0!==s&&u.clearTimeout(s)},cancelAll:e=>{for(const t in D._snapshot._scheduledEvents){const n=D._snapshot._scheduledEvents[t];n.source===e&&c.cancel(e,n.id)}}},D={_snapshot:{_scheduledEvents:(t?.snapshot&&t.snapshot.scheduler)??{}},_bookId:()=>"x:"+A++,_register:(e,t)=>(n.set(e,t),e),_unregister:e=>{n.delete(e.sessionId);const t=r.get(e);void 0!==t&&(s.delete(t),r.delete(e))},get:e=>s.get(e),_set:(e,t)=>{const n=s.get(e);if(n&&n!==t)throw new Error(`Actor with system ID '${e}' already exists.`);s.set(e,t),r.set(t,e)},inspect:e=>{const t=b(e);return o.add(t),{unsubscribe(){o.delete(t)}}},_sendInspectionEvent:t=>{if(!o.size)return;const n={...t,rootId:e.sessionId};o.forEach(e=>e.next?.(n))},_relay:(e,t,n)=>{D._sendInspectionEvent({type:"@xstate.event",sourceRef:e,actorRef:t,event:n}),t._send(n)},scheduler:c,getSnapshot:()=>({_scheduledEvents:{...D._snapshot._scheduledEvents}}),start:()=>{const e=D._snapshot._scheduledEvents;D._snapshot._scheduledEvents={};for(const t in e){const{source:n,target:s,event:r,delay:o,id:i}=e[t];c.schedule(n,s,r,o,i)}},_clock:u,_logger:a};return D}(this,{clock:s,logger:o}),D&&!i&&this.system.inspect(b(D)),this.sessionId=this.system._bookId(),this.id=a??this.sessionId,this.logger=t?.logger??this.system._logger,this.clock=t?.clock??this.system._clock,this._parent=i,this._syncSnapshot=u,this.options=n,this.src=n.src??e,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:e=>{this._deferred.push(e)},system:this.system,stopChild:e=>{if(e._parent!==this)throw new Error(`Cannot stop child actor ${e.id} of ${this.id} because it is not a child`);e._stop()},emit:e=>{const t=this.eventListeners.get(e.type),n=this.eventListeners.get("*");if(!t&&!n)return;const s=[...t?t.values():[],...n?n.values():[]];for(const t of s)t(e)},actionExecutor:e=>{const t=()=>{if(this._actorScope.system._sendInspectionEvent({type:"@xstate.action",actorRef:this,action:{type:e.type,params:e.params}}),!e.exec)return;const t=O;try{O=!0,e.exec(e.info,e.params)}finally{O=t}};this._processingStatus===T.Running?t():this._deferred.push(t)}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),c&&(this._systemId=c,this.system._set(c,this)),this._initState(t?.snapshot??t?.state),c&&"active"!==this._snapshot.status&&this.system._unregister(this)}_initState(e){try{this._snapshot=e?this.logic.restoreSnapshot?this.logic.restoreSnapshot(e,this._actorScope):e:this.logic.getInitialSnapshot(this._actorScope,this.options?.input)}catch(e){this._snapshot={status:"error",output:void 0,error:e}}}update(e,t){let n;for(this._snapshot=e;n=this._deferred.shift();)try{n()}catch(t){this._deferred.length=0,this._snapshot={...e,status:"error",error:t}}switch(this._snapshot.status){case"active":for(const t of this.observers)try{t.next?.(e)}catch(e){l(e)}break;case"done":for(const t of this.observers)try{t.next?.(e)}catch(e){l(e)}this._stopProcedure(),this._complete(),this._doneEvent={type:`xstate.done.actor.${s=this.id}`,output:this._snapshot.output,actorId:s},this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._error(this._snapshot.error)}var s;this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:t,snapshot:e})}subscribe(e,t,n){const s=b(e,t,n);if(this._processingStatus!==T.Stopped)this.observers.add(s);else switch(this._snapshot.status){case"done":try{s.complete?.()}catch(e){l(e)}break;case"error":{const e=this._snapshot.error;if(s.error)try{s.error(e)}catch(e){l(e)}else l(e);break}}return{unsubscribe:()=>{this.observers.delete(s)}}}on(e,t){let n=this.eventListeners.get(e);n||(n=new Set,this.eventListeners.set(e,n));const s=t.bind(void 0);return n.add(s),{unsubscribe:()=>{n.delete(s)}}}start(){if(this._processingStatus===T.Running)return this;this._syncSnapshot&&this.subscribe({next:e=>{"active"===e.status&&this.system._relay(this,this._parent,{type:`xstate.snapshot.${this.id}`,snapshot:e})},error:()=>{}}),this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this._processingStatus=T.Running;const e=D(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:e}),this._snapshot.status){case"done":return this.update(this._snapshot,e),this;case"error":return this._error(this._snapshot.error),this}if(this._parent||this.system.start(),this.logic.start)try{this.logic.start(this._snapshot,this._actorScope)}catch(e){return this._snapshot={...this._snapshot,status:"error",error:e},this._error(e),this}return this.update(this._snapshot,e),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(e){let t,n;try{t=this.logic.transition(this._snapshot,e,this._actorScope)}catch(e){n={err:e}}if(n){const{err:e}=n;return this._snapshot={...this._snapshot,status:"error",error:e},void this._error(e)}this.update(t,e),e.type===u&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===T.Stopped?this:(this.mailbox.clear(),this._processingStatus===T.NotStarted?(this._processingStatus=T.Stopped,this):(this.mailbox.enqueue({type:u}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){for(const e of this.observers)try{e.complete?.()}catch(e){l(e)}this.observers.clear()}_reportError(e){if(!this.observers.size)return void(this._parent||l(e));let t=!1;for(const n of this.observers){const s=n.error;t||=!s;try{s?.(e)}catch(e){l(e)}}this.observers.clear(),t&&l(e)}_error(e){this._stopProcedure(),this._reportError(e),this._parent&&this.system._relay(this,this._parent,c(this.id,e))}_stopProcedure(){return this._processingStatus!==T.Running||(this.system.scheduler.cancelAll(this),this.mailbox.clear(),this.mailbox=new r(this._process.bind(this)),this._processingStatus=T.Stopped,this.system._unregister(this)),this}_send(e){this._processingStatus!==T.Stopped&&this.mailbox.enqueue(e)}send(e){this.system._relay(void 0,this,e)}attachDevTools(){const{devTools:e}=this.options;e&&("function"==typeof e?e:s)(this)}toJSON(){return{xstate$$type:1,id:this.id}}getPersistedSnapshot(e){return this.logic.getPersistedSnapshot(this._snapshot,e)}[d](){return this}getSnapshot(){return this._snapshot}}function P(e,...[t]){return new N(e,t)}const I=P;function R(e,t,n,s,{sendId:r}){return[t,{sendId:"function"==typeof r?r(n,s):r},void 0]}function M(e,t){e.defer(()=>{e.system.scheduler.cancel(e.self,t.sendId)})}function L(e){function t(e,t){}return t.type="xstate.cancel",t.sendId=e,t.resolve=R,t.execute=M,t}function $(e,t,n,s,{id:r,systemId:o,src:i,input:u,syncSnapshot:a}){const c="string"==typeof i?w(t.machine,i):i,D="function"==typeof r?r(n):r;let l,d;return c&&(d="function"==typeof u?u({context:t.context,event:n.event,self:e.self}):u,l=P(c,{id:D,src:i,parent:e.self,syncSnapshot:a,systemId:o,input:d})),[Ve(t,{children:{...t.children,[D]:l}}),{id:r,systemId:o,actorRef:l,src:i,input:d},void 0]}function j(e,{actorRef:t}){t&&e.defer(()=>{t._processingStatus!==T.Stopped&&t.start()})}function U(...[e,{id:t,systemId:n,input:s,syncSnapshot:r=!1}={}]){function o(e,t){}return o.type="xstate.spawnChild",o.id=t,o.systemId=n,o.src=e,o.input=s,o.syncSnapshot=r,o.resolve=$,o.execute=j,o}function W(e,t,n,s,{actorRef:r}){const o="function"==typeof r?r(n,s):r,i="string"==typeof o?t.children[o]:o;let u=t.children;return i&&(u={...u},delete u[i.id]),[Ve(t,{children:u}),i,void 0]}function G(e,t){t&&(e.system._unregister(t),t._processingStatus===T.Running?e.defer(()=>{e.stopChild(t)}):e.stopChild(t))}function z(e){function t(e,t){}return t.type="xstate.stopChild",t.actorRef=e,t.resolve=W,t.execute=G,t}const V=z;function H(e,t,{stateValue:n}){if("string"==typeof n&&ce(n)){const t=e.machine.getStateNodeById(n);return e._nodes.some(e=>e===t)}return e.matches(n)}function q(e){function t(){return!1}return t.check=H,t.stateValue=e,t}function J(e,{context:t,event:n},{guards:s}){return!ee(s[0],t,n,e)}function X(e){function t(e,t){return!1}return t.check=J,t.guards=[e],t}function Q(e,{context:t,event:n},{guards:s}){return s.every(s=>ee(s,t,n,e))}function K(e){function t(e,t){return!1}return t.check=Q,t.guards=e,t}function Y(e,{context:t,event:n},{guards:s}){return s.some(s=>ee(s,t,n,e))}function Z(e){function t(e,t){return!1}return t.check=Y,t.guards=e,t}function ee(e,t,n,s){const{machine:r}=s,o="function"==typeof e,i=o?e:r.implementations.guards["string"==typeof e?e:e.type];if(!o&&!i)throw new Error(`Guard '${"string"==typeof e?e:e.type}' is not implemented.'.`);if("function"!=typeof i)return ee(i,t,n,s);const u={context:t,event:n},a=o||"string"==typeof e?void 0:"params"in e?"function"==typeof e.params?e.params({context:t,event:n}):e.params:void 0;return"check"in i?i.check(s,u,i):i(u,a)}const te=e=>"atomic"===e.type||"final"===e.type;function ne(e){return Object.values(e.states).filter(e=>"history"!==e.type)}function se(e,t){const n=[];if(t===e)return n;let s=e.parent;for(;s&&s!==t;)n.push(s),s=s.parent;return n}function re(e){const t=new Set(e),n=ie(t);for(const e of t)if("compound"!==e.type||n.get(e)&&n.get(e).length){if("parallel"===e.type)for(const n of ne(e))if("history"!==n.type&&!t.has(n)){const e=he(n);for(const n of e)t.add(n)}}else he(e).forEach(e=>t.add(e));for(const e of t){let n=e.parent;for(;n;)t.add(n),n=n.parent}return t}function oe(e,t){const n=t.get(e);if(!n)return{};if("compound"===e.type){const e=n[0];if(!e)return{};if(te(e))return e.key}const s={};for(const e of n)s[e.key]=oe(e,t);return s}function ie(e){const t=new Map;for(const n of e)t.has(n)||t.set(n,[]),n.parent&&(t.has(n.parent)||t.set(n.parent,[]),t.get(n.parent).push(n));return t}function ue(e,t){return oe(e,ie(re(t)))}function ae(e,t){return"compound"===t.type?ne(t).some(t=>"final"===t.type&&e.has(t)):"parallel"===t.type?ne(t).every(t=>ae(e,t)):"final"===t.type}const ce=e=>"#"===e[0];function De(e,t,n){const s=_(n.target),r=n.reenter??!1,o=function(e,t){if(void 0!==t)return t.map(t=>{if("string"!=typeof t)return t;if(ce(t))return e.machine.getStateNodeById(t);const n="."===t[0];if(n&&!e.parent)return ge(e,t.slice(1));const s=n?e.key+t:t;if(!e.parent)throw new Error(`Invalid target: "${t}" is not a valid target from the root node. Did you mean ".${t}"?`);try{return ge(e.parent,s)}catch(t){throw new Error(`Invalid transition definition for state node '${e.id}':\n${t.message}`)}})}(e,s),i={...n,actions:E(n.actions),guard:n.guard,target:o,source:e,reenter:r,eventType:t,toJSON:()=>({...i,source:`#${e.id}`,target:o?o.map(e=>`#${e.id}`):void 0})};return i}function le(e){const t=_(e.config.target);return t?{target:t.map(t=>"string"==typeof t?ge(e.parent,t):t)}:e.parent.initial}function de(e){return"history"===e.type}function he(e){const t=pe(e);for(const n of t)for(const s of se(n,e))t.add(s);return t}function pe(e){const t=new Set;return function e(n){if(!t.has(n))if(t.add(n),"compound"===n.type)e(n.initial.target[0]);else if("parallel"===n.type)for(const t of ne(n))e(t)}(e),t}function fe(e,t){if(ce(t))return e.machine.getStateNodeById(t);if(!e.states)throw new Error(`Unable to retrieve child state '${t}' from '${e.id}'; no child states exist.`);const n=e.states[t];if(!n)throw new Error(`Child state '${t}' does not exist on '${e.id}'`);return n}function ge(e,t){if("string"==typeof t&&ce(t))try{return e.machine.getStateNodeById(t)}catch{}const n=p(t).slice();let s=e;for(;n.length;){const e=n.shift();if(!e.length)break;s=fe(s,e)}return s}function Fe(e,t){if("string"==typeof t){const n=e.states[t];if(!n)throw new Error(`State '${t}' does not exist on '${e.id}'`);return[e,n]}const n=Object.keys(t),s=n.map(t=>fe(e,t)).filter(Boolean);return[e.machine.root,e].concat(s,n.reduce((n,s)=>{const r=fe(e,s);if(!r)return n;const o=Fe(r,t[s]);return n.concat(o)},[]))}function me(e,t,n,s){return"string"==typeof t?function(e,t,n,s){const r=fe(e,t).next(n,s);return r&&r.length?r:e.next(n,s)}(e,t,n,s):1===Object.keys(t).length?function(e,t,n,s){const r=Object.keys(t),o=me(fe(e,r[0]),t[r[0]],n,s);return o&&o.length?o:e.next(n,s)}(e,t,n,s):function(e,t,n,s){const r=[];for(const o of Object.keys(t)){const i=t[o];if(!i)continue;const u=me(fe(e,o),i,n,s);u&&r.push(...u)}return r.length?r:e.next(n,s)}(e,t,n,s)}function Ee(e){return Object.keys(e.states).map(t=>e.states[t]).filter(e=>"history"===e.type)}function Ce(e,t){let n=e;for(;n.parent&&n.parent!==t;)n=n.parent;return n.parent===t}function ye(e,t){const n=new Set(e),s=new Set(t);for(const e of n)if(s.has(e))return!0;for(const e of s)if(n.has(e))return!0;return!1}function ve(e,t,n){const s=new Set;for(const r of e){let e=!1;const o=new Set;for(const i of s)if(ye(Se([r],t,n),Se([i],t,n))){if(!Ce(r.source,i.source)){e=!0;break}o.add(i)}if(!e){for(const e of o)s.delete(e);s.add(r)}}return Array.from(s)}function _e(e,t){if(!e.target)return[];const n=new Set;for(const s of e.target)if(de(s))if(t[s.id])for(const e of t[s.id])n.add(e);else for(const e of _e(le(s),t))n.add(e);else n.add(s);return[...n]}function be(e,t){const n=_e(e,t);if(!n)return;if(!e.reenter&&n.every(t=>t===e.source||Ce(t,e.source)))return e.source;return function(e){const[t,...n]=e;for(const e of se(t,void 0))if(n.every(t=>Ce(t,e)))return e}(n.concat(e.source))||(e.reenter?void 0:e.source.machine.root)}function Se(e,t,n){const s=new Set;for(const r of e)if(r.target?.length){const e=be(r,n);r.reenter&&r.source===e&&s.add(e);for(const n of t)Ce(n,e)&&s.add(n)}return[...s]}function we(e,t,n,s,r,o){if(!e.length)return t;const i=new Set(t._nodes);let u=t.historyValue;const c=ve(e,i,u);let D=t;r||([D,u]=function(e,t,n,s,r,o,i){let u=e;const a=Se(s,r,o);let c;a.sort((e,t)=>t.order-e.order);for(const e of a)for(const t of Ee(e)){let n;n="deep"===t.history?t=>te(t)&&Ce(t,e):t=>t.parent===e,c??={...o},c[t.id]=Array.from(r).filter(n)}for(const e of a)u=Ne(u,t,n,[...e.exit,...e.invoke.map(e=>z(e.id))],i,void 0),r.delete(e);return[u,c||o]}(D,s,n,c,i,u,o,n.actionExecutor)),D=Ne(D,s,n,c.flatMap(e=>e.actions),o,void 0),D=function(e,t,n,s,r,o,i,u){let c=e;const D=new Set,l=new Set;(function(e,t,n,s){for(const r of e){const e=be(r,t);for(const o of r.target||[])de(o)||r.source===o&&r.source===e&&!r.reenter||(s.add(o),n.add(o)),xe(o,t,n,s);const o=_e(r,t);for(const i of o){const o=se(i,e);"parallel"===e?.type&&o.push(e),Ae(s,t,n,o,!r.source.parent&&r.reenter?void 0:e)}}})(s,i,l,D),u&&l.add(e.machine.root);const d=new Set;for(const e of[...D].sort((e,t)=>e.order-t.order)){r.add(e);const s=[];s.push(...e.entry);for(const t of e.invoke)s.push(U(t.src,{...t,syncSnapshot:!!t.onSnapshot}));if(l.has(e)){const t=e.initial.actions;s.push(...t)}if(c=Ne(c,t,n,s,o,e.invoke.map(e=>e.id)),"final"===e.type){const s=e.parent;let i="parallel"===s?.type?s:s?.parent,u=i||e;for("compound"===s?.type&&o.push(a(s.id,void 0!==e.output?C(e.output,c.context,t,n.self):void 0));"parallel"===i?.type&&!d.has(i)&&ae(r,i);)d.add(i),o.push(a(i.id)),u=i,i=i.parent;if(i)continue;c=Ve(c,{status:"done",output:Be(c,t,n,c.machine.root,u)})}}return c}(D,s,n,c,i,o,u,r);const l=[...i];"done"===D.status&&(D=Ne(D,s,n,l.sort((e,t)=>t.order-e.order).flatMap(e=>e.exit),o,void 0));try{return u===t.historyValue&&function(e,t){if(e.length!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}(t._nodes,i)?D:Ve(D,{_nodes:l,historyValue:u})}catch(e){throw e}}function Be(e,t,n,s,r){if(void 0===s.output)return;const o=a(r.id,void 0!==r.output&&r.parent?C(r.output,e.context,t,n.self):void 0);return C(s.output,e.context,o,n.self)}function xe(e,t,n,s){if(de(e))if(t[e.id]){const r=t[e.id];for(const e of r)s.add(e),xe(e,t,n,s);for(const o of r)Oe(o,e.parent,s,t,n)}else{const r=le(e);for(const o of r.target)s.add(o),r===e.parent?.initial&&n.add(e.parent),xe(o,t,n,s);for(const o of r.target)Oe(o,e.parent,s,t,n)}else if("compound"===e.type){const[r]=e.initial.target;de(r)||(s.add(r),n.add(r)),xe(r,t,n,s),Oe(r,e,s,t,n)}else if("parallel"===e.type)for(const r of ne(e).filter(e=>!de(e)))[...s].some(e=>Ce(e,r))||(de(r)||(s.add(r),n.add(r)),xe(r,t,n,s))}function Ae(e,t,n,s,r){for(const o of s)if(r&&!Ce(o,r)||e.add(o),"parallel"===o.type)for(const s of ne(o).filter(e=>!de(e)))[...e].some(e=>Ce(e,s))||(e.add(s),xe(s,t,n,e))}function Oe(e,t,n,s,r){Ae(n,s,r,se(e,t))}function Te(e,t){return e.implementations.actions[t]}function ke(e,t,n,s,r,o){const{machine:i}=e;let u=e;for(const e of s){const s="function"==typeof e,a=s?e:Te(i,"string"==typeof e?e:e.type),c={context:u.context,event:t,self:n.self,system:n.system},D=s||"string"==typeof e?void 0:"params"in e?"function"==typeof e.params?e.params({context:u.context,event:t}):e.params:void 0;if(!a||!("resolve"in a)){n.actionExecutor({type:"string"==typeof e?e:"object"==typeof e?e.type:e.name||"(anonymous)",info:c,params:D,exec:a});continue}const l=a,[d,h,p]=l.resolve(n,u,c,D,a,r);u=d,"retryResolve"in l&&o?.push([l,h]),"execute"in l&&n.actionExecutor({type:l.type,info:c,params:h,exec:l.execute.bind(null,n,h)}),p&&(u=ke(u,t,n,p,r,o))}return u}function Ne(e,t,n,s,r,o){const i=o?[]:void 0,u=ke(e,t,n,s,{internalQueue:r,deferredActorIds:o},i);return i?.forEach(([e,t])=>{e.retryResolve(n,u,t)}),u}function Pe(e,t,n,s){let r=e;const i=[];function a(e,t,s){n.system._sendInspectionEvent({type:"@xstate.microstep",actorRef:n.self,event:t,snapshot:e,_transitions:s}),i.push(e)}if(t.type===u)return r=Ve(Ie(r,t,n),{status:"stopped"}),a(r,t,[]),{snapshot:r,microstates:i};let c=t;if(c.type!==o){const t=c,o=function(e){return e.type.startsWith("xstate.error.actor")}(t),u=Re(t,r);if(o&&!u.length)return r=Ve(e,{status:"error",error:t.error}),a(r,t,[]),{snapshot:r,microstates:i};r=we(u,e,n,c,!1,s),a(r,t,u)}let D=!0;for(;"active"===r.status;){let e=D?Me(r,c):[];const t=e.length?r:void 0;if(!e.length){if(!s.length)break;c=s.shift(),e=Re(c,r)}r=we(e,r,n,c,!1,s),D=r!==t,a(r,c,e)}return"active"!==r.status&&Ie(r,c,n),{snapshot:r,microstates:i}}function Ie(e,t,n){return Ne(e,t,n,Object.values(e.children).map(e=>z(e)),[],void 0)}function Re(e,t){return t.machine.getTransitionData(t,e)}function Me(e,t){const n=new Set,s=e._nodes.filter(te);for(const r of s)e:for(const s of[r].concat(se(r,void 0)))if(s.always)for(const r of s.always)if(void 0===r.guard||ee(r.guard,e.context,t,e)){n.add(r);break e}return ve(Array.from(n),new Set(e._nodes),e.historyValue)}function Le(e){return!!e&&"object"==typeof e&&"machine"in e&&"value"in e}const $e=function(e){return h(e,this.value)},je=function(e){return this.tags.has(e)},Ue=function(e){const t=this.machine.getTransitionData(this,e);return!!t?.length&&t.some(e=>void 0!==e.target||e.actions.length)},We=function(){const{_nodes:e,tags:t,machine:n,getMeta:s,toJSON:r,can:o,hasTag:i,matches:u,...a}=this;return{...a,tags:Array.from(t)}},Ge=function(){return this._nodes.reduce((e,t)=>(void 0!==t.meta&&(e[t.id]=t.meta),e),{})};function ze(e,t){return{status:e.status,output:e.output,error:e.error,machine:t,context:e.context,_nodes:e._nodes,value:ue(t.root,e._nodes),tags:new Set(e._nodes.flatMap(e=>e.tags)),children:e.children,historyValue:e.historyValue||{},matches:$e,hasTag:je,can:Ue,getMeta:Ge,toJSON:We}}function Ve(e,t={}){return ze({...e,...t},e.machine)}function He(e){if("object"!=typeof e||null===e)return{};const t={};for(const n in e){const s=e[n];Array.isArray(s)&&(t[n]=s.map(e=>({id:e.id})))}return t}function qe(e){let t;for(const n in e){const s=e[n];if(s&&"object"==typeof s)if("sessionId"in s&&"send"in s&&"ref"in s)t??=Array.isArray(e)?e.slice():{...e},t[n]={xstate$$type:1,id:s.id};else{const r=qe(s);r!==s&&(t??=Array.isArray(e)?e.slice():{...e},t[n]=r)}}return t??e}function Je(e,t,n,s,{event:r,id:o,delay:i},{internalQueue:u}){const a=t.machine.implementations.delays;if("string"==typeof r)throw new Error(`Only event objects may be used with raise; use raise({ type: "${r}" }) instead`);const c="function"==typeof r?r(n,s):r;let D;if("string"==typeof i){const e=a&&a[i];D="function"==typeof e?e(n,s):e}else D="function"==typeof i?i(n,s):i;return"number"!=typeof D&&u.push(c),[t,{event:c,id:o,delay:D},void 0]}function Xe(e,t){const{event:n,delay:s,id:r}=t;"number"!=typeof s||e.defer(()=>{const t=e.self;e.system.scheduler.schedule(t,t,n,s,r)})}function Qe(e,t){function n(e,t){}return n.type="xstate.raise",n.event=e,n.id=t?.id,n.delay=t?.delay,n.resolve=Je,n.execute=Xe,n}function Ke(e,t){return{config:e,transition:(t,n,s)=>({...t,context:e(t.context,n,s)}),getInitialSnapshot:(e,n)=>({status:"active",output:void 0,error:void 0,context:"function"==typeof t?t({input:n}):t}),getPersistedSnapshot:e=>e,restoreSnapshot:e=>e}}const Ye=new WeakMap;function Ze(e){const t={config:e,start:(t,n)=>{const{self:s,system:r,emit:o}=n,i={receivers:void 0,dispose:void 0};Ye.set(s,i),i.dispose=e({input:t.input,system:r,self:s,sendBack:e=>{"stopped"!==s.getSnapshot().status&&s._parent&&r._relay(s,s._parent,e)},receive:e=>{i.receivers??=new Set,i.receivers.add(e)},emit:o})},transition:(e,t,n)=>{const s=Ye.get(n.self);return t.type===u?(e={...e,status:"stopped",error:void 0},s.dispose?.(),e):(s.receivers?.forEach(e=>e(t)),e)},getInitialSnapshot:(e,t)=>({status:"active",output:void 0,error:void 0,input:t}),getPersistedSnapshot:e=>e,restoreSnapshot:e=>e};return t}const et="xstate.observable.next",tt="xstate.observable.error",nt="xstate.observable.complete";function st(e){const t={config:e,transition:(e,t)=>{if("active"!==e.status)return e;switch(t.type){case et:return{...e,context:t.data};case tt:return{...e,status:"error",error:t.data,input:void 0,_subscription:void 0};case nt:return{...e,status:"done",input:void 0,_subscription:void 0};case u:return e._subscription.unsubscribe(),{...e,status:"stopped",input:void 0,_subscription:void 0};default:return e}},getInitialSnapshot:(e,t)=>({status:"active",output:void 0,error:void 0,context:void 0,input:t,_subscription:void 0}),start:(t,{self:n,system:s,emit:r})=>{"done"!==t.status&&(t._subscription=e({input:t.input,system:s,self:n,emit:r}).subscribe({next:e=>{s._relay(n,n,{type:et,data:e})},error:e=>{s._relay(n,n,{type:tt,data:e})},complete:()=>{s._relay(n,n,{type:nt})}}))},getPersistedSnapshot:({_subscription:e,...t})=>t,restoreSnapshot:e=>({...e,_subscription:void 0})};return t}function rt(e){const t={config:e,transition:(e,t)=>{if("active"!==e.status)return e;switch(t.type){case tt:return{...e,status:"error",error:t.data,input:void 0,_subscription:void 0};case nt:return{...e,status:"done",input:void 0,_subscription:void 0};case u:return e._subscription.unsubscribe(),{...e,status:"stopped",input:void 0,_subscription:void 0};default:return e}},getInitialSnapshot:(e,t)=>({status:"active",output:void 0,error:void 0,context:void 0,input:t,_subscription:void 0}),start:(t,{self:n,system:s,emit:r})=>{"done"!==t.status&&(t._subscription=e({input:t.input,system:s,self:n,emit:r}).subscribe({next:e=>{n._parent&&s._relay(n,n._parent,e)},error:e=>{s._relay(n,n,{type:tt,data:e})},complete:()=>{s._relay(n,n,{type:nt})}}))},getPersistedSnapshot:({_subscription:e,...t})=>t,restoreSnapshot:e=>({...e,_subscription:void 0})};return t}const ot="xstate.promise.resolve",it="xstate.promise.reject",ut=new WeakMap;function at(e){const t={config:e,transition:(e,t,n)=>{if("active"!==e.status)return e;switch(t.type){case ot:{const n=t.data;return{...e,status:"done",output:n,input:void 0}}case it:return{...e,status:"error",error:t.data,input:void 0};case u:return ut.get(n.self)?.abort(),{...e,status:"stopped",input:void 0};default:return e}},start:(t,{self:n,system:s,emit:r})=>{if("active"!==t.status)return;const o=new AbortController;ut.set(n,o),Promise.resolve(e({input:t.input,system:s,self:n,signal:o.signal,emit:r})).then(e=>{"active"===n.getSnapshot().status&&(ut.delete(n),s._relay(n,n,{type:ot,data:e}))},e=>{"active"===n.getSnapshot().status&&(ut.delete(n),s._relay(n,n,{type:it,data:e}))})},getInitialSnapshot:(e,t)=>({status:"active",output:void 0,error:void 0,input:t}),getPersistedSnapshot:e=>e,restoreSnapshot:e=>e};return t}const ct=Ke(e=>{},void 0);function Dt(){return P(ct)}function lt(e,{machine:t,context:n},s,r){return(o,i)=>{const u=((o,i)=>{if("string"==typeof o){const u=w(t,o);if(!u)throw new Error(`Actor logic '${o}' not implemented in machine '${t.id}'`);const a=P(u,{id:i?.id,parent:e.self,syncSnapshot:i?.syncSnapshot,input:"function"==typeof i?.input?i.input({context:n,event:s,self:e.self}):i?.input,src:o,systemId:i?.systemId});return r[a.id]=a,a}return P(o,{id:i?.id,parent:e.self,syncSnapshot:i?.syncSnapshot,input:i?.input,src:o,systemId:i?.systemId})})(o,i);return r[u.id]=u,e.defer(()=>{u._processingStatus!==T.Stopped&&u.start()}),u}}function dt(e,t,n,s,{assignment:r}){if(!t.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const o={},i={context:t.context,event:n.event,spawn:lt(e,t,n.event,o),self:e.self,system:e.system};let u={};if("function"==typeof r)u=r(i,s);else for(const e of Object.keys(r)){const t=r[e];u[e]="function"==typeof t?t(i,s):t}return[Ve(t,{context:Object.assign({},t.context,u),children:Object.keys(o).length?{...t.children,...o}:t.children}),void 0,void 0]}function ht(e){function t(e,t){}return t.type="xstate.assign",t.assignment=e,t.resolve=dt,t}const pt=new WeakMap;function ft(e,t,n){let s=pt.get(e);return s?t in s||(s[t]=n()):(s={[t]:n()},pt.set(e,s)),s[t]}const gt={},Ft=e=>"string"==typeof e?{type:e}:"function"==typeof e?"resolve"in e?{type:e.type}:{type:e.name}:e;class mt{constructor(e,t){if(this.config=e,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=t._parent,this.key=t._key,this.machine=t._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join("."),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?F(this.config.states,(e,t)=>new mt(e,{_parent:this,_key:t,_machine:this.machine})):gt,"compound"===this.type&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=!0===this.config.history?"shallow":this.config.history||!1,this.entry=E(this.config.entry).slice(),this.exit=E(this.config.exit).slice(),this.meta=this.config.meta,this.output="final"!==this.type&&this.parent?void 0:this.config.output,this.tags=E(e.tags).slice()}_initialize(){this.transitions=function(e){const t=new Map;if(e.config.on)for(const n of Object.keys(e.config.on)){if(""===n)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const s=e.config.on[n];t.set(n,v(s).map(t=>De(e,n,t)))}if(e.config.onDone){const n=`xstate.done.state.${e.id}`;t.set(n,v(e.config.onDone).map(t=>De(e,n,t)))}for(const n of e.invoke){if(n.onDone){const s=`xstate.done.actor.${n.id}`;t.set(s,v(n.onDone).map(t=>De(e,s,t)))}if(n.onError){const s=`xstate.error.actor.${n.id}`;t.set(s,v(n.onError).map(t=>De(e,s,t)))}if(n.onSnapshot){const s=`xstate.snapshot.${n.id}`;t.set(s,v(n.onSnapshot).map(t=>De(e,s,t)))}}for(const n of e.after){let e=t.get(n.eventType);e||(e=[],t.set(n.eventType,e)),e.push(n)}return t}(this),this.config.always&&(this.always=v(this.config.always).map(e=>De(this,"",e))),Object.keys(this.states).forEach(e=>{this.states[e]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(Ft),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(e=>`#${e.id}`),source:`#${this.id}`,actions:this.initial.actions.map(Ft),eventType:null})}:void 0,history:this.history,states:F(this.states,e=>e.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(e=>({...e,actions:e.actions.map(Ft)})),entry:this.entry.map(Ft),exit:this.exit.map(Ft),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return ft(this,"invoke",()=>E(this.config.invoke).map((e,t)=>{const{src:n,systemId:s}=e,r=e.id??S(this.id,t),o="string"==typeof n?n:`xstate.invoke.${S(this.id,t)}`;return{...e,src:o,id:r,systemId:s,toJSON(){const{onDone:t,onError:n,...s}=e;return{...s,type:"xstate.invoke",src:o,id:r}}}}))}get on(){return ft(this,"on",()=>[...this.transitions].flatMap(([e,t])=>t.map(t=>[e,t])).reduce((e,[t,n])=>(e[t]=e[t]||[],e[t].push(n),e),{}))}get after(){return ft(this,"delayedTransitions",()=>function(e){const t=e.config.after;if(!t)return[];const n=Object.keys(t).flatMap(n=>{const s=t[n],r="string"==typeof s?{target:s}:s,o=Number.isNaN(+n)?n:+n,i=(t=>{const n={type:`xstate.after.${t}.${e.id}`},s=n.type;return e.entry.push(Qe(n,{id:s,delay:t})),e.exit.push(L(s)),s})(o);return E(r).map(e=>({...e,event:i,delay:o}))});return n.map(t=>{const{delay:n}=t;return{...De(e,t.event,t),delay:n}})}(this))}get initial(){return ft(this,"initial",()=>function(e,t){const n="string"==typeof t?e.states[t]:t?e.states[t.target]:void 0;if(!n&&t)throw new Error(`Initial state node "${t}" not found on parent state node #${e.id}`);const s={source:e,actions:t&&"string"!=typeof t?E(t.actions):[],eventType:null,reenter:!1,target:n?[n]:[],toJSON:()=>({...s,source:`#${e.id}`,target:n?[`#${n.id}`]:[]})};return s}(this,this.config.initial))}next(e,t){const n=t.type,s=[];let r;const o=ft(this,`candidates-${n}`,()=>{return t=n,(e=this).transitions.get(t)||[...e.transitions.keys()].filter(e=>{if("*"===e)return!0;if(!e.endsWith(".*"))return!1;const n=e.split("."),s=t.split(".");for(let e=0;e<n.length;e++){const t=n[e],r=s[e];if("*"===t)return e===n.length-1;if(t!==r)return!1}return!0}).sort((e,t)=>t.length-e.length).flatMap(t=>e.transitions.get(t));var e,t});for(const i of o){const{guard:o}=i,u=e.context;let a=!1;try{a=!o||ee(o,u,t,e)}catch(e){const t="string"==typeof o?o:"object"==typeof o?o.type:void 0;throw new Error(`Unable to evaluate guard ${t?`'${t}' `:""}in transition for event '${n}' in state node '${this.id}':\n${e.message}`)}if(a){s.push(...i.actions),r=i;break}}return r?[r]:void 0}get events(){return ft(this,"events",()=>{const{states:e}=this,t=new Set(this.ownEvents);if(e)for(const n of Object.keys(e)){const s=e[n];if(s.states)for(const e of s.events)t.add(`${e}`)}return Array.from(t)})}get ownEvents(){const e=new Set([...this.transitions.keys()].filter(e=>this.transitions.get(e).some(e=>!(!e.target&&!e.actions.length&&!e.reenter))));return Array.from(e)}}class Et{constructor(e,t){this.config=e,this.version=void 0,this.schemas=void 0,this.implementations=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.id=e.id||"(machine)",this.implementations={actors:t?.actors??{},actions:t?.actions??{},delays:t?.delays??{},guards:t?.guards??{}},this.version=this.config.version,this.schemas=this.config.schemas,this.transition=this.transition.bind(this),this.getInitialSnapshot=this.getInitialSnapshot.bind(this),this.getPersistedSnapshot=this.getPersistedSnapshot.bind(this),this.restoreSnapshot=this.restoreSnapshot.bind(this),this.start=this.start.bind(this),this.root=new mt(e,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(e){const{actions:t,guards:n,actors:s,delays:r}=this.implementations;return new Et(this.config,{actions:{...t,...e.actions},guards:{...n,...e.guards},actors:{...s,...e.actors},delays:{...r,...e.delays}})}resolveState(e){const t=ue(n=this.root,[...re(Fe(n,e.value))]);var n;const s=re(Fe(this.root,t));return ze({_nodes:[...s],context:e.context||{},children:{},status:ae(s,this.root)?"done":e.status||"active",output:e.output,error:e.error,historyValue:e.historyValue},this)}transition(e,t,n){return Pe(e,t,n,[]).snapshot}microstep(e,t,n){return Pe(e,t,n,[]).microstates}getTransitionData(e,t){return me(this.root,e.value,e,t)||[]}getPreInitialState(e,t,n){const{context:s}=this.config,r=ze({context:"function"!=typeof s&&s?s:{},_nodes:[this.root],children:{},status:"active"},this);return"function"==typeof s?Ne(r,t,e,[ht(({spawn:e,event:t,self:n})=>s({spawn:e,input:t.input,self:n}))],n,void 0):r}getInitialSnapshot(e,t){const n=D(t),s=[],r=this.getPreInitialState(e,n,s),o=we([{target:[...pe(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],r,e,n,!0,s),{snapshot:i}=Pe(o,n,e,s);return i}start(e){Object.values(e.children).forEach(e=>{"active"===e.getSnapshot().status&&e.start()})}getStateNodeById(e){const t=p(e),n=t.slice(1),s=ce(t[0])?t[0].slice(1):t[0],r=this.idMap.get(s);if(!r)throw new Error(`Child state node '#${s}' does not exist on machine '${this.id}'`);return ge(r,n)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedSnapshot(e,t){return function(e,t){const{_nodes:n,tags:s,machine:r,children:o,context:i,can:u,hasTag:a,matches:c,getMeta:D,toJSON:l,...d}=e,h={};for(const e in o){const n=o[e];h[e]={snapshot:n.getPersistedSnapshot(t),src:n.src,systemId:n._systemId,syncSnapshot:n._syncSnapshot}}return{...d,context:qe(i),children:h,historyValue:He(d.historyValue)}}(e,t)}restoreSnapshot(e,t){const n={},s=e.children;function r(e,t){if(t instanceof mt)return t;try{return e.machine.getStateNodeById(t.id)}catch{}}Object.keys(s).forEach(e=>{const r=s[e],o=r.snapshot,i=r.src,u="string"==typeof i?w(this,i):i;if(!u)return;const a=P(u,{id:e,parent:t.self,syncSnapshot:r.syncSnapshot,snapshot:o,src:i,systemId:r.systemId});n[e]=a});const o=function(e,t){if(!t||"object"!=typeof t)return{};const n={};for(const s in t){const o=t[s];for(const t of o){const o=r(e,t);o&&(n[s]??=[],n[s].push(o))}}return n}(this.root,e.historyValue),i=ze({...e,children:n,_nodes:Array.from(re(Fe(this.root,e.value))),historyValue:o},this),u=new Set;return function e(t,n){if(!u.has(t)){u.add(t);for(const s in t){const r=t[s];if(r&&"object"==typeof r){if("xstate$$type"in r&&1===r.xstate$$type){t[s]=n[r.id];continue}e(r,n)}}}}(i.context,n),i}}function Ct(e,t,n,s,{event:r}){return[t,{event:"function"==typeof r?r(n,s):r},void 0]}function yt(e,{event:t}){e.defer(()=>e.emit(t))}function vt(e){function t(e,t){}return t.type="xstate.emit",t.event=e,t.resolve=Ct,t.execute=yt,t}let _t=function(e){return e.Parent="#_parent",e.Internal="#_internal",e}({});function bt(e,t,n,s,{to:r,event:o,id:i,delay:u},a){const c=t.machine.implementations.delays;if("string"==typeof o)throw new Error(`Only event objects may be used with sendTo; use sendTo({ type: "${o}" }) instead`);const D="function"==typeof o?o(n,s):o;let l;if("string"==typeof u){const e=c&&c[u];l="function"==typeof e?e(n,s):e}else l="function"==typeof u?u(n,s):u;const d="function"==typeof r?r(n,s):r;let h;if("string"==typeof d){if(h=d===_t.Parent?e.self._parent:d===_t.Internal?e.self:d.startsWith("#_")?t.children[d.slice(2)]:a.deferredActorIds?.includes(d)?d:t.children[d],!h)throw new Error(`Unable to send event to actor '${d}' from machine '${t.machine.id}'.`)}else h=d||e.self;return[t,{to:h,targetId:"string"==typeof d?d:void 0,event:D,id:i,delay:l},void 0]}function St(e,t,n){"string"==typeof n.to&&(n.to=t.children[n.to])}function wt(e,t){e.defer(()=>{const{to:n,event:s,delay:r,id:o}=t;"number"!=typeof r?e.system._relay(e.self,n,s.type===i?c(e.self.id,s.data):s):e.system.scheduler.schedule(e.self,n,s,r,o)})}function Bt(e,t,n){function s(e,t){}return s.type="xstate.sendTo",s.to=e,s.event=t,s.id=n?.id,s.delay=n?.delay,s.resolve=bt,s.retryResolve=St,s.execute=wt,s}function xt(e,t){return Bt(_t.Parent,e,t)}function At(e,t){return Bt(e,({event:e})=>e,t)}function Ot(e,t,n,s,{collect:r}){const o=[],i=function(e){o.push(e)};return i.assign=(...e)=>{o.push(ht(...e))},i.cancel=(...e)=>{o.push(L(...e))},i.raise=(...e)=>{o.push(Qe(...e))},i.sendTo=(...e)=>{o.push(Bt(...e))},i.sendParent=(...e)=>{o.push(xt(...e))},i.spawnChild=(...e)=>{o.push(U(...e))},i.stopChild=(...e)=>{o.push(z(...e))},i.emit=(...e)=>{o.push(vt(...e))},r({context:n.context,event:n.event,enqueue:i,check:e=>ee(e,t.context,n.event,t),self:e.self,system:e.system},s),[t,void 0,o]}function Tt(e){function t(e,t){}return t.type="xstate.enqueueActions",t.collect=e,t.resolve=Ot,t}function kt(e,t,n,s,{value:r,label:o}){return[t,{value:"function"==typeof r?r(n,s):r,label:o},void 0]}function Nt({logger:e},{value:t,label:n}){n?e(n,t):e(t)}function Pt(e=({context:e,event:t})=>({context:e,event:t}),t){function n(e,t){}return n.type="xstate.log",n.value=e,n.label=t,n.resolve=kt,n.execute=Nt,n}function It(e,t){const n=E(t);if(!n.includes(e.type)){const t=1===n.length?`type "${n[0]}"`:`one of types "${n.join('", "')}"`;throw new Error(`Expected event ${JSON.stringify(e)} to have ${t}`)}}function Rt(e,t){return new Et(e,t)}function Mt(e){const t=P(e);return{self:t,defer:()=>{},id:"",logger:()=>{},sessionId:"",stopChild:()=>{},system:t.system,emit:()=>{},actionExecutor:()=>{}}}function Lt(e,...[t]){const n=Mt(e);return e.getInitialSnapshot(n,t)}function $t(e,t,n){const s=Mt(e);return s.self._snapshot=t,e.transition(t,n,s)}function jt({schemas:e,actors:t,actions:n,guards:s,delays:r}){return{createMachine:o=>Rt({...o,schemas:e},{actors:t,actions:n,guards:s,delays:r})}}class Ut{constructor(){this.timeouts=new Map,this._now=0,this._id=0,this._flushing=!1,this._flushingInvalidated=!1}now(){return this._now}getId(){return this._id++}setTimeout(e,t){this._flushingInvalidated=this._flushing;const n=this.getId();return this.timeouts.set(n,{start:this.now(),timeout:t,fn:e}),n}clearTimeout(e){this._flushingInvalidated=this._flushing,this.timeouts.delete(e)}set(e){if(this._now>e)throw new Error("Unable to travel back in time");this._now=e,this.flushTimeouts()}flushTimeouts(){if(this._flushing)return void(this._flushingInvalidated=!0);this._flushing=!0;const e=[...this.timeouts].sort(([e,t],[n,s])=>{const r=t.start+t.timeout;return s.start+s.timeout>r?-1:1});for(const[t,n]of e){if(this._flushingInvalidated)return this._flushingInvalidated=!1,this._flushing=!1,void this.flushTimeouts();this.now()-n.start>=n.timeout&&(this.timeouts.delete(t),n.fn.call(null))}this._flushing=!1}increment(e){this._now+=e,this.flushTimeouts()}}function Wt(e){return new Promise((t,n)=>{e.subscribe({complete:()=>{t(e.getSnapshot().output)},error:n})})}function Gt(e,t,n){const s=[],r=Mt(e);return r.actionExecutor=e=>{s.push(e)},[e.transition(t,n,r),s]}function zt(e,...[t]){const n=[],s=Mt(e);return s.actionExecutor=e=>{n.push(e)},[e.getInitialSnapshot(s,t),n]}const Vt={timeout:1/0};function Ht(e,t,n){const s={...Vt,...n};return new Promise((n,r)=>{const{signal:o}=s;if(o?.aborted)return void r(o.reason);let i=!1;const u=s.timeout===1/0?void 0:setTimeout(()=>{a(),r(new Error(`Timeout of ${s.timeout} ms exceeded`))},s.timeout),a=()=>{clearTimeout(u),i=!0,l?.unsubscribe(),D&&o.removeEventListener("abort",D)};function c(e){t(e)&&(a(),n(e))}let D,l;c(e.getSnapshot()),i||(o&&(D=()=>{a(),r(o.reason)},o.addEventListener("abort",D)),l=e.subscribe({next:c,error:e=>{a(),r(e)},complete:()=>{a(),r(new Error("Actor terminated without satisfying predicate"))}}),i&&l.unsubscribe())})}},4367:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.formatterMachine=void 0;const u=i(n(1398)),a=n(3922),c=n(139);t.formatterMachine=(0,a.setup)({types:{context:{},events:{}},actions:{advancePosition:(0,a.assign)({position:({context:e})=>e.position+1,column:({context:e})=>e.column+1}),incrementLine:(0,a.assign)({line:({context:e})=>e.line+1,column:0}),recordTemplateStart:(0,a.assign)({templateStart:({context:e})=>e.position,templateIndent:({context:e})=>e.indentLevel+1}),enterTemplate:(0,a.assign)({indentLevel:({context:e})=>e.templateIndent}),exitTemplate:(0,a.assign)({indentLevel:({context:e})=>Math.max(0,e.indentLevel-1)}),resetTemplate:(0,a.assign)({inTemplate:null,templateStart:0,templateIndent:0}),enterInterpolation:(0,a.assign)({exprDepth:1}),incrementExprDepth:(0,a.assign)({exprDepth:({context:e})=>e.exprDepth+1}),decrementExprDepth:(0,a.assign)({exprDepth:({context:e})=>Math.max(0,e.exprDepth-1)}),addNewlineAfterBacktick:(0,a.assign)({edits:({context:e})=>{const t=new u.Position(e.line,e.column+1),n="  ".repeat(e.templateIndent),s=u.TextEdit.insert(t,`\n${n}`);return[...e.edits,s]}}),addNewlineBeforeBacktick:(0,a.assign)({edits:({context:e})=>{const t=new u.Position(e.line,e.column),n="  ".repeat(e.templateIndent-1),s=u.TextEdit.insert(t,`\n${n}`);return[...e.edits,s]}}),addTemplateIndent:(0,a.assign)({edits:({context:e})=>{const t=new u.Position(e.line,0),n="  ".repeat(e.indentLevel),s=new u.Range(t,t.translate(0,e.column)),r=u.TextEdit.replace(s,n);return[...e.edits,r]}}),setTemplateTag:(0,a.assign)({inTemplate:({event:e})=>"TEMPLATE_TAG"===e.type?e.tag:null}),initializeFormatting:(0,a.assign)({input:({event:e})=>"START_FORMATTING"===e.type&&e.input||"",indentSize:({event:e})=>"START_FORMATTING"===e.type?e.options.insertSpaces?e.options.tabSize:4:2,edits:[],formattedEdits:[]}),processTokens:(0,a.assign)({formattedEdits:({context:e})=>{try{const t=e.input,n=[];if(!t)return n;const s=(0,c.tokenizeForMachine)(t);let r=0,o=0;const i=0;let a=!1,D=null;for(let e=0;e<s.length;e++){const t=s[e],c=s[e+1];switch(t.type){case"TEMPLATE_TAG":D=t.tag,a=!0;break;case"BACKTICK":if(a&&D){if(c&&"EOF"!==c.type)try{const e=new u.Position(r,o+1),t="  ".repeat(i+1),s=u.TextEdit.insert(e,`\n${t}`);n.push(s)}catch(e){}a=!a}break;case"NEWLINE":if(r++,o=0,a&&D)try{const e=new u.Position(r,0),t="  ".repeat(i+1),s=u.TextEdit.insert(e,t);n.push(s)}catch(e){}break;case"DOLLAR_LBRACE":case"LBRACE":case"RBRACE":case"EOF":break;case"CHAR":o++}}return n}catch(e){return[]}}}),finalizeEdits:(0,a.assign)({formattedEdits:({context:e})=>e.edits})},guards:{isAtExpressionEnd:({context:e})=>1===e.exprDepth}}).createMachine({id:"formatter",initial:"root",context:{input:"",position:0,line:0,column:0,indentLevel:0,exprDepth:0,edits:[],formattedEdits:[],currentIndent:"",indentSize:2,preserveNewlines:!0,inTemplate:null,templateStart:0,templateIndent:0},states:{root:{on:{START_FORMATTING:{target:"formatting",actions:["initializeFormatting"]},TEMPLATE_TAG:{target:"waitingForBacktick",actions:"setTemplateTag"},CHAR:{actions:"advancePosition"},NEWLINE:{actions:["advancePosition","incrementLine"]}}},formatting:{entry:["processTokens","finalizeEdits"],always:{target:"root"}},waitingForBacktick:{on:{BACKTICK:{target:"template",actions:["recordTemplateStart","addNewlineAfterBacktick"]},CHAR:{target:"root",actions:"advancePosition"}}},template:{entry:"enterTemplate",exit:"exitTemplate",on:{DOLLAR_LBRACE:{target:"interpolation",actions:"enterInterpolation"},BACKTICK:{target:"root",actions:["addNewlineBeforeBacktick","resetTemplate"]},NEWLINE:{actions:["advancePosition","incrementLine","addTemplateIndent"]},CHAR:{actions:"advancePosition"}}},interpolation:{entry:"incrementExprDepth",on:{LBRACE:{actions:"incrementExprDepth"},RBRACE:[{guard:"isAtExpressionEnd",target:"template",actions:"decrementExprDepth"},{actions:"decrementExprDepth"}],CHAR:{actions:"advancePosition"},NEWLINE:{actions:["advancePosition","incrementLine"]}}}}})},4434:e=>{"use strict";e.exports=require("events")},4756:e=>{"use strict";e.exports=require("tls")},4910:(e,t,n)=>{"use strict";const{Writable:s}=n(2203),r=n(9147),{BINARY_TYPES:o,EMPTY_BUFFER:i,kStatusCode:u,kWebSocket:a}=n(6614),{concat:c,toArrayBuffer:D,unmask:l}=n(6890),{isValidStatusCode:d,isValidUTF8:h}=n(7672),p=Buffer[Symbol.species];e.exports=class extends s{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||o[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[a]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,n){if(8===this._opcode&&0==this._state)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=new p(t.buffer,t.byteOffset+e,t.length-e),new p(t.buffer,t.byteOffset,e)}const t=Buffer.allocUnsafe(e);do{const n=this._buffers[0],s=t.length-e;e>=n.length?t.set(this._buffers.shift(),s):(t.set(new Uint8Array(n.buffer,n.byteOffset,e),s),this._buffers[0]=new p(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return t}startLoop(e){this._loop=!0;do{switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:return void(this._loop=!1)}}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2)return void(this._loop=!1);const t=this.consume(2);if(48&t[0])return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));const n=!(64&~t[0]);if(!n||this._extensions[r.extensionName]){if(this._fin=!(128&~t[0]),this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(n)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=n}else{if(!(this._opcode>7&&this._opcode<11))return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(n)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=!(128&~t[1]),this._isServer){if(!this._masked)return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}else e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}getPayloadLength16(e){this._bufferedBytes<2?this._loop=!1:(this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e))}getPayloadLength64(e){if(this._bufferedBytes<8)return void(this._loop=!1);const t=this.consume(8),n=t.readUInt32BE(0);n>Math.pow(2,21)-1?e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=n*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e))}haveLength(e){this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)?e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")):this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=i;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&0!==(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])&&l(t,this._mask)}if(this._opcode>7)this.controlMessage(t,e);else{if(this._compressed)return this._state=5,void this.decompress(t,e);t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}}decompress(e,t){this._extensions[r.extensionName].decompress(e,this._fin,(e,n)=>{if(e)return t(e);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0){const e=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");return void t(e)}this._fragments.push(n)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin)return void(this._state=0);const t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let s;s="nodebuffer"===this._binaryType?c(n,t):"arraybuffer"===this._binaryType?D(c(n,t)):"blob"===this._binaryType?new Blob(n):n,this._allowSynchronousEvents?(this.emit("message",s,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",s,!0),this._state=0,this.startLoop(e)}))}else{const s=c(n,t);if(!this._skipUTF8Validation&&!h(s)){const t=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void e(t)}5===this._state||this._allowSynchronousEvents?(this.emit("message",s,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",s,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8!==this._opcode)this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}));else{if(0===e.length)this._loop=!1,this.emit("conclude",1005,i),this.end();else{const n=e.readUInt16BE(0);if(!d(n)){const e=this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");return void t(e)}const s=new p(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!h(s)){const e=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void t(e)}this._loop=!1,this.emit("conclude",n,s),this.end()}this._state=0}}createError(e,t,n,s,r){this._loop=!1,this._errored=!0;const o=new e(n?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=r,o[u]=s,o}}},5120:(e,t,n)=>{"use strict";Object.create;var s,r,o,i,u=Object.defineProperty,a=Object.getOwnPropertyDescriptor,c=Object.getOwnPropertyNames,D=(Object.getPrototypeOf,Object.prototype.hasOwnProperty),l=(e,t)=>function(){return e&&(t=(0,e[c(e)[0]])(e=0)),t},d=(e,t)=>{for(var n in t)u(e,n,{get:t[n],enumerable:!0})},h=e=>((e,t,n,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of c(t))D.call(e,r)||r===n||u(e,r,{get:()=>t[r],enumerable:!(s=a(t,r))||s.enumerable});return e})(u({},"__esModule",{value:!0}),e);function p(e){return(t,n,s)=>{const r=Boolean(null==s?void 0:s.backwards);if(!1===n)return!1;const{length:o}=t;let i=n;for(;i>=0&&i<o;){const n=t.charAt(i);if(e instanceof RegExp){if(!e.test(n))return i}else if(!e.includes(n))return i;r?i--:i++}return(-1===i||i===o)&&i}}var f,g=l({"src/utils/skip.js"(){s=p(/\s/u),r=p(" \t"),o=p(",; \t"),i=p(/[^\n\r]/u)}});function F(e,t){if(!1===t)return!1;if("/"===e.charAt(t)&&"*"===e.charAt(t+1))for(let n=t+2;n<e.length;++n)if("*"===e.charAt(n)&&"/"===e.charAt(n+1))return n+2;return t}var m,E=l({"src/utils/skip-inline-comment.js"(){f=F}});function C(e,t,n){const s=Boolean(null==n?void 0:n.backwards);if(!1===t)return!1;const r=e.charAt(t);if(s){if("\r"===e.charAt(t-1)&&"\n"===r)return t-2;if("\n"===r||"\r"===r||"\u2028"===r||"\u2029"===r)return t-1}else{if("\r"===r&&"\n"===e.charAt(t+1))return t+2;if("\n"===r||"\r"===r||"\u2028"===r||"\u2029"===r)return t+1}return t}var y,v=l({"src/utils/skip-newline.js"(){m=C}});function _(e,t){return!1!==t&&("/"===e.charAt(t)&&"/"===e.charAt(t+1)?i(e,t):t)}var b,S=l({"src/utils/skip-trailing-comment.js"(){g(),y=_}});function w(e,t){let n=null,s=t;for(;s!==n;)n=s,s=r(e,s),s=f(e,s),s=y(e,s),s=m(e,s);return s}var B,x=l({"src/utils/get-next-non-space-non-comment-character-index.js"(){g(),E(),v(),S(),b=w}});function A(e,t,n={}){const s=r(e,n.backwards?t-1:t,n);return s!==m(e,s,n)}var O,T=l({"src/utils/has-newline.js"(){g(),v(),B=A}});function k(e,t){let n=null,s=t;for(;s!==n;)n=s,s=o(e,s),s=f(e,s),s=r(e,s);return s=y(e,s),s=m(e,s),!1!==s&&B(e,s)}var N,P=l({"src/utils/is-next-line-empty.js"(){T(),g(),E(),v(),S(),O=k}});function I(e,t){let n=t-1;return n=r(e,n,{backwards:!0}),n=m(e,n,{backwards:!0}),n=r(e,n,{backwards:!0}),n!==m(e,n,{backwards:!0})}var R=l({"src/utils/is-previous-line-empty.js"(){g(),v(),N=I}});function M(e,t){(e.comments??(e.comments=[])).push(t),t.printed=!1,t.nodeDescription=function(e){const t=e.type||e.kind||"(unknown type)";let n=String(e.name||e.id&&("object"==typeof e.id?e.id.name:e.id)||e.key&&("object"==typeof e.key?e.key.name:e.key)||e.value&&("object"==typeof e.value?"":String(e.value))||e.operator||"");return n.length>20&&(n=n.slice(0,19)+"â€¦"),t+(n?" "+n:"")}(e)}function L(e,t){t.leading=!0,t.trailing=!1,M(e,t)}function $(e,t,n){t.leading=!1,t.trailing=!1,n&&(t.marker=n),M(e,t)}function j(e,t){t.leading=!1,t.trailing=!0,M(e,t)}var U,W=l({"src/main/comments/utils.js"(){}});function G(e,t,n=0){let s=0;for(let r=n;r<e.length;++r)"\t"===e[r]?s=s+t-s%t:s++;return s}var z,V=l({"src/utils/get-alignment-size.js"(){U=G}});function H(e,t){const n=e.lastIndexOf("\n");return-1===n?0:U(e.slice(n+1).match(/^[\t ]*/u)[0],t)}var q,J=l({"src/utils/get-indent-size.js"(){V(),z=H}}),X=l({"node_modules/escape-string-regexp/index.js"(){}});function Q(e,t){const n=e.match(new RegExp(`(${function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}(t)})+`,"gu"));return null===n?0:n.reduce((e,n)=>Math.max(e,n.length/t.length),0)}var K,Y=l({"src/utils/get-max-continuous-count.js"(){X(),q=Q}});function Z(e,t){const n=b(e,t);return!1===n?"":e.charAt(n)}var ee,te,ne,se=l({"src/utils/get-next-non-space-non-comment-character.js"(){x(),K=Z}});function re(e,t){const n=!0===t||t===ee?ee:te,s=n===ee?te:ee;let r=0,o=0;for(const t of e)t===n?r++:t===s&&o++;return r>o?s:n}var oe,ie,ue,ae,ce=l({"src/utils/get-preferred-quote.js"(){ee="'",te='"',ne=re}}),De=l({"node_modules/emoji-regex/index.mjs"(){oe=()=>/[#*0-9]\uFE0F?\u20E3|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26AA\u26B0\u26B1\u26BD\u26BE\u26C4\u26C8\u26CF\u26D1\u26E9\u26F0-\u26F5\u26F7\u26F8\u26FA\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B55\u3030\u303D\u3297\u3299]\uFE0F?|[\u261D\u270C\u270D](?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?|[\u270A\u270B](?:\uD83C[\uDFFB-\uDFFF])?|[\u23E9-\u23EC\u23F0\u23F3\u25FD\u2693\u26A1\u26AB\u26C5\u26CE\u26D4\u26EA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2795-\u2797\u27B0\u27BF\u2B50]|\u26D3\uFE0F?(?:\u200D\uD83D\uDCA5)?|\u26F9(?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?(?:\u200D[\u2640\u2642]\uFE0F?)?|\u2764\uFE0F?(?:\u200D(?:\uD83D\uDD25|\uD83E\uDE79))?|\uD83C(?:[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37\uDF21\uDF24-\uDF2C\uDF36\uDF7D\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFCD\uDFCE\uDFD4-\uDFDF\uDFF5\uDFF7]\uFE0F?|[\uDF85\uDFC2\uDFC7](?:\uD83C[\uDFFB-\uDFFF])?|[\uDFC4\uDFCA](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDFCB\uDFCC](?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDCCF\uDD8E\uDD91-\uDD9A\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF43\uDF45-\uDF4A\uDF4C-\uDF7C\uDF7E-\uDF84\uDF86-\uDF93\uDFA0-\uDFC1\uDFC5\uDFC6\uDFC8\uDFC9\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF8-\uDFFF]|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|\uDF44(?:\u200D\uD83D\uDFEB)?|\uDF4B(?:\u200D\uD83D\uDFE9)?|\uDFC3(?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D(?:[\u2640\u2642]\uFE0F?(?:\u200D\u27A1\uFE0F?)?|\u27A1\uFE0F?))?|\uDFF3\uFE0F?(?:\u200D(?:\u26A7\uFE0F?|\uD83C\uDF08))?|\uDFF4(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDC73\uDB40\uDC63\uDB40\uDC74|\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F)?)|\uD83D(?:[\uDC3F\uDCFD\uDD49\uDD4A\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3]\uFE0F?|[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4\uDEB5](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD74\uDD90](?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?|[\uDC00-\uDC07\uDC09-\uDC14\uDC16-\uDC25\uDC27-\uDC3A\uDC3C-\uDC3E\uDC40\uDC44\uDC45\uDC51-\uDC65\uDC6A\uDC79-\uDC7B\uDC7D-\uDC80\uDC84\uDC88-\uDC8E\uDC90\uDC92-\uDCA9\uDCAB-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDDA4\uDDFB-\uDE2D\uDE2F-\uDE34\uDE37-\uDE41\uDE43\uDE44\uDE48-\uDE4A\uDE80-\uDEA2\uDEA4-\uDEB3\uDEB7-\uDEBF\uDEC1-\uDEC5\uDED0-\uDED2\uDED5-\uDED7\uDEDC-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uDC08(?:\u200D\u2B1B)?|\uDC15(?:\u200D\uD83E\uDDBA)?|\uDC26(?:\u200D(?:\u2B1B|\uD83D\uDD25))?|\uDC3B(?:\u200D\u2744\uFE0F?)?|\uDC41\uFE0F?(?:\u200D\uD83D\uDDE8\uFE0F?)?|\uDC68(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDC68\uDC69]\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE])))?))?|\uDC69(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?[\uDC68\uDC69]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?))|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFE])))?))?|\uDC6F(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDD75(?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDE2E(?:\u200D\uD83D\uDCA8)?|\uDE35(?:\u200D\uD83D\uDCAB)?|\uDE36(?:\u200D\uD83C\uDF2B\uFE0F?)?|\uDE42(?:\u200D[\u2194\u2195]\uFE0F?)?|\uDEB6(?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D(?:[\u2640\u2642]\uFE0F?(?:\u200D\u27A1\uFE0F?)?|\u27A1\uFE0F?))?)|\uD83E(?:[\uDD0C\uDD0F\uDD18-\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2\uDDD3\uDDD5\uDEC3-\uDEC5\uDEF0\uDEF2-\uDEF8](?:\uD83C[\uDFFB-\uDFFF])?|[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD\uDDCF\uDDD4\uDDD6-\uDDDD](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDDDE\uDDDF](?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD0D\uDD0E\uDD10-\uDD17\uDD20-\uDD25\uDD27-\uDD2F\uDD3A\uDD3F-\uDD45\uDD47-\uDD76\uDD78-\uDDB4\uDDB7\uDDBA\uDDBC-\uDDCC\uDDD0\uDDE0-\uDDFF\uDE70-\uDE7C\uDE80-\uDE89\uDE8F-\uDEC2\uDEC6\uDECE-\uDEDC\uDEDF-\uDEE9]|\uDD3C(?:\u200D[\u2640\u2642]\uFE0F?|\uD83C[\uDFFB-\uDFFF])?|\uDDCE(?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D(?:[\u2640\u2642]\uFE0F?(?:\u200D\u27A1\uFE0F?)?|\u27A1\uFE0F?))?|\uDDD1(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1|\uDDD1\u200D\uD83E\uDDD2(?:\u200D\uD83E\uDDD2)?|\uDDD2(?:\u200D\uD83E\uDDD2)?))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFC-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFD-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFD\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFE]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?))?|\uDEF1(?:\uD83C(?:\uDFFB(?:\u200D\uD83E\uDEF2\uD83C[\uDFFC-\uDFFF])?|\uDFFC(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFD-\uDFFF])?|\uDFFD(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])?|\uDFFE(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFD\uDFFF])?|\uDFFF(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFE])?))?)/g}}),le=l({"node_modules/get-east-asian-width/lookup.js"(){}}),de=l({"node_modules/get-east-asian-width/index.js"(){le(),ie=e=>{return!(12288===(t=e)||t>=65281&&t<=65376||t>=65504&&t<=65510||function(e){return e>=4352&&e<=4447||8986===e||8987===e||9001===e||9002===e||e>=9193&&e<=9196||9200===e||9203===e||9725===e||9726===e||9748===e||9749===e||e>=9776&&e<=9783||e>=9800&&e<=9811||9855===e||e>=9866&&e<=9871||9875===e||9889===e||9898===e||9899===e||9917===e||9918===e||9924===e||9925===e||9934===e||9940===e||9962===e||9970===e||9971===e||9973===e||9978===e||9981===e||9989===e||9994===e||9995===e||10024===e||10060===e||10062===e||e>=10067&&e<=10069||10071===e||e>=10133&&e<=10135||10160===e||10175===e||11035===e||11036===e||11088===e||11093===e||e>=11904&&e<=11929||e>=11931&&e<=12019||e>=12032&&e<=12245||e>=12272&&e<=12287||e>=12289&&e<=12350||e>=12353&&e<=12438||e>=12441&&e<=12543||e>=12549&&e<=12591||e>=12593&&e<=12686||e>=12688&&e<=12773||e>=12783&&e<=12830||e>=12832&&e<=12871||e>=12880&&e<=42124||e>=42128&&e<=42182||e>=43360&&e<=43388||e>=44032&&e<=55203||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65106||e>=65108&&e<=65126||e>=65128&&e<=65131||e>=94176&&e<=94180||94192===e||94193===e||e>=94208&&e<=100343||e>=100352&&e<=101589||e>=101631&&e<=101640||e>=110576&&e<=110579||e>=110581&&e<=110587||110589===e||110590===e||e>=110592&&e<=110882||110898===e||e>=110928&&e<=110930||110933===e||e>=110948&&e<=110951||e>=110960&&e<=111355||e>=119552&&e<=119638||e>=119648&&e<=119670||126980===e||127183===e||127374===e||e>=127377&&e<=127386||e>=127488&&e<=127490||e>=127504&&e<=127547||e>=127552&&e<=127560||127568===e||127569===e||e>=127584&&e<=127589||e>=127744&&e<=127776||e>=127789&&e<=127797||e>=127799&&e<=127868||e>=127870&&e<=127891||e>=127904&&e<=127946||e>=127951&&e<=127955||e>=127968&&e<=127984||127988===e||e>=127992&&e<=128062||128064===e||e>=128066&&e<=128252||e>=128255&&e<=128317||e>=128331&&e<=128334||e>=128336&&e<=128359||128378===e||128405===e||128406===e||128420===e||e>=128507&&e<=128591||e>=128640&&e<=128709||128716===e||e>=128720&&e<=128722||e>=128725&&e<=128727||e>=128732&&e<=128735||128747===e||128748===e||e>=128756&&e<=128764||e>=128992&&e<=129003||129008===e||e>=129292&&e<=129338||e>=129340&&e<=129349||e>=129351&&e<=129535||e>=129648&&e<=129660||e>=129664&&e<=129673||e>=129679&&e<=129734||e>=129742&&e<=129756||e>=129759&&e<=129769||e>=129776&&e<=129784||e>=131072&&e<=196605||e>=196608&&e<=262141}(e));var t}}});function he(e){if(!e)return 0;if(!ue.test(e))return e.length;e=e.replace(oe(),"  ");let t=0;for(const n of e){const e=n.codePointAt(0);e<=31||e>=127&&e<=159||e>=768&&e<=879||(t+=ie(e)?1:2)}return t}var pe,fe=l({"src/utils/get-string-width.js"(){De(),de(),ue=/[^\x20-\x7F]/u,ae=he}});function ge(e,t,n){for(let s=t;s<n;++s)if("\n"===e.charAt(s))return!0;return!1}var Fe,me=l({"src/utils/has-newline-in-range.js"(){pe=ge}});function Ee(e,t,n={}){return r(e,n.backwards?t-1:t,n)!==t}var Ce,ye,ve=l({"src/utils/has-spaces.js"(){g(),Fe=Ee}}),_e=l({"scripts/build/shims/string-replace-all.js"(){Ce=(e,t,n,s)=>{if(!e||null!=t)return t.replaceAll?t.replaceAll(n,s):n.global?t.replace(n,s):t.split(n).join(s)}}});function be(e,t,n){const s='"'===t?"'":'"',r=Ce(!1,e,/\\(.)|(["'])/gsu,(e,r,o)=>r===s?r:o===t?"\\"+o:o||(n&&/^[^\n\r"'0-7\\bfnrt-vx\u2028\u2029]$/u.test(r)?r:"\\"+r));return t+r+t}var Se=l({"src/utils/make-string.js"(){_e(),ye=be}}),we={};function Be(e,t){return 2===arguments.length||"number"==typeof t?b(e,t):function(e,t,n){return b(e,n(t))}(...arguments)}function xe(e,t){return 2===arguments.length||"number"==typeof t?N(e,t):function(e,t,n){return N(e,n(t))}(...arguments)}function Ae(e,t){return 2===arguments.length||"number"==typeof t?O(e,t):function(e,t,n){return O(e,n(t))}(...arguments)}d(we,{addDanglingComment:()=>$,addLeadingComment:()=>L,addTrailingComment:()=>j,getAlignmentSize:()=>U,getIndentSize:()=>z,getMaxContinuousCount:()=>q,getNextNonSpaceNonCommentCharacter:()=>K,getNextNonSpaceNonCommentCharacterIndex:()=>Be,getPreferredQuote:()=>ne,getStringWidth:()=>ae,hasNewline:()=>B,hasNewlineInRange:()=>pe,hasSpaces:()=>Fe,isNextLineEmpty:()=>Ae,isNextLineEmptyAfterIndex:()=>O,isPreviousLineEmpty:()=>xe,makeString:()=>ye,skip:()=>p,skipEverythingButNewLine:()=>i,skipInlineComment:()=>f,skipNewline:()=>m,skipSpaces:()=>r,skipToLineEnd:()=>o,skipTrailingComment:()=>y,skipWhitespace:()=>s});var Oe,Te=l({"src/utils/public.js"(){x(),P(),R(),W(),V(),J(),Y(),se(),ce(),fe(),T(),me(),ve(),Se(),g(),E(),v(),S()}}),ke={};d(ke,{default:()=>Oe});var Ne=l({"src/main/version.evaluate.js"(){Oe="3.6.2"}}),Pe=Promise.all([n.e(714),n.e(502)]).then(n.bind(n,4714)),Ie=Object.create(null);for(const e of["formatWithCursor","format","check","resolveConfig","resolveConfigFile","clearConfigCache","getFileInfo","getSupportInfo"])Ie[e]=async(...t)=>(await Pe)[e](...t);var Re=Object.create(null);for(const e of["parse","formatAST","formatDoc","printToDoc","printDocToString"])Re[e]=async(...t)=>(await Pe).__debug[e](...t);Ie.__debug=Re,Ie.util=(Te(),h(we)),Ie.doc=n(1961),Ie.version=(Ne(),h(ke)).default,e.exports=Ie},5692:e=>{"use strict";e.exports=require("https")},6444:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleFormattingProvider=void 0;const u=i(n(1398));t.SimpleFormattingProvider=class{constructor(e){this.outputChannel=e}async provideDocumentFormattingEdits(e,t,n){const s=this.findTemplates(e),r=[];for(const e of s){const n=this.formatTemplate(e,t);n!==e.content&&r.push(u.TextEdit.replace(e.range,n))}return r}async provideDocumentRangeFormattingEdits(e,t,n,s){const r=this.findTemplates(e),o=[];for(const e of r)if(t.intersection(e.range)){const t=this.formatTemplate(e,n);t!==e.content&&o.push(u.TextEdit.replace(e.range,t))}return o}findTemplates(e){const t=[],n=e.getText(),s=/\b(html|css)\s*`/g;let r;for(r=s.exec(n);null!==r;){const o=r[1],i=r.index+r[0].length,a=this.findClosingBacktick(n,i);if(-1===a){r=s.exec(n);continue}const c=n.slice(i,a),D=e.positionAt(i),l=e.positionAt(a),d=this.getIndentLevel(e,D.line);t.push({range:new u.Range(D,l),content:c,language:o,indentLevel:d}),r=s.exec(n)}return t}findClosingBacktick(e,t){let n=1,s=t;for(;s<e.length&&n>0;)if("\\"!==e[s]){if("`"===e[s]){const t=e.slice(Math.max(0,s-10),s);/\b(html|css)\s*$/.test(t)?n++:n--}s++}else s+=2;return 0===n?s-1:-1}getIndentLevel(e,t){const n=e.lineAt(t).text.match(/^(\s*)/);return n?Math.floor(n[1].length/2):0}formatTemplate(e,t){const{content:n,language:s,indentLevel:r}=e;if(!n.trim())return n;const{cleanContent:o,expressions:i}=this.extractExpressions(n),u="html"===s?this.formatHtml(o):this.formatCss(o),a=this.restoreExpressions(u,i);return this.applyTemplateIndentation(a,r,t)}extractExpressions(e){const t=[];let n=e,s=0;return n=n.replace(/\$\{[^}]*\}/g,e=>{const n=`__EXPR_${s++}__`;return t.push({placeholder:n,content:e}),n}),{cleanContent:n,expressions:t}}restoreExpressions(e,t){let n=e;for(const e of t)n=n.replace(e.placeholder,e.content);return n}formatHtml(e){return e.replace(/>\s*</g,">\n<").replace(/(<[^>]+>)\s*([^<\s][^<]*?)\s*(<\/[^>]+>)/g,"$1$2$3").split("\n").map(e=>e.trim()).filter(e=>e.length>0).map((e,t,n)=>{let s=0;for(let e=0;e<t;e++)n[e].match(/<[^/][^>]*[^/]>/)&&!n[e].match(/<[^>]*\/>/)&&s++,n[e].match(/<\/[^>]+>/)&&s--;return e.match(/<\/[^>]+>/)&&s--,"  ".repeat(Math.max(0,s))+e}).join("\n")}formatCss(e){return e.replace(/;\s*/g,";\n").replace(/\{\s*/g," {\n").replace(/\}\s*/g,"\n}\n").replace(/,\s*/g,",\n").split("\n").map(e=>e.trim()).filter(e=>e.length>0).map((e,t,n)=>{let s=0;for(let e=0;e<t;e++)n[e].includes("{")&&s++,n[e].includes("}")&&s--;return"}"===e&&s--,"  ".repeat(Math.max(0,s))+e}).join("\n")}applyTemplateIndentation(e,t,n){if(!e.trim())return e;const s=n.insertSpaces?" ".repeat(n.tabSize*(t+1)):"\t".repeat(t+1),r=e.split("\n").map(e=>e.trim()?s+e:""),o=n.insertSpaces?" ".repeat(n.tabSize*t):"\t".repeat(t);return`\n${r.join("\n")}\n${o}`}}},6614:e=>{"use strict";const t=["nodebuffer","arraybuffer","fragments"],n="undefined"!=typeof Blob;n&&t.push("blob"),e.exports={BINARY_TYPES:t,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:n,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},6760:e=>{"use strict";e.exports=require("node:path")},6890:(e,t,n)=>{"use strict";const{EMPTY_BUFFER:s}=n(6614),r=Buffer[Symbol.species];function o(e,t,n,s,r){for(let o=0;o<r;o++)n[s+o]=e[o]^t[3&o]}function i(e,t){for(let n=0;n<e.length;n++)e[n]^=t[3&n]}if(e.exports={concat:function(e,t){if(0===e.length)return s;if(1===e.length)return e[0];const n=Buffer.allocUnsafe(t);let o=0;for(let t=0;t<e.length;t++){const s=e[t];n.set(s,o),o+=s.length}return o<t?new r(n.buffer,n.byteOffset,o):n},mask:o,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(t){if(e.readOnly=!0,Buffer.isBuffer(t))return t;let n;return t instanceof ArrayBuffer?n=new r(t):ArrayBuffer.isView(t)?n=new r(t.buffer,t.byteOffset,t.byteLength):(n=Buffer.from(t),e.readOnly=!1),n},unmask:i},!process.env.WS_NO_BUFFER_UTIL)try{const t=n(Object(function(){var e=new Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e}()));e.exports.mask=function(e,n,s,r,i){i<48?o(e,n,s,r,i):t.mask(e,n,s,r,i)},e.exports.unmask=function(e,n){e.length<32?i(e,n):t.unmask(e,n)}}catch(e){}},6928:e=>{"use strict";e.exports=require("path")},6982:e=>{"use strict";e.exports=require("crypto")},7016:e=>{"use strict";e.exports=require("url")},7067:e=>{"use strict";e.exports=require("node:http")},7071:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.discoveryMachine=void 0;const u=i(n(1398)),a=n(3922);function c(e,t){const n=e.indexOf("html`",t),s=e.indexOf("css`",t);return-1===n&&-1===s?{type:null,start:-1}:-1!==n&&(-1===s||n<s)?{type:"html",start:n}:{type:"css",start:s}}function D(e,t){let n=0,s=t,r=!1,o="";for(;s<e.length;){const t=e[s],i=e[s+1];if("\\"!==t){if(r||'"'!==t&&"'"!==t&&"`"!==t)r&&t===o&&(r=!1,o="");else if("`"===t){if(0===n)return s;n--}else r=!0,o=t;r||("$"===t&&"{"===i?(n++,s++):"}"===t&&n>0&&n--),s++}else s+=2}return-1}function l(e){const t=(e.match(/\$\{/g)||[]).length,n=e.split("\n").length;return/html`|css`/.test(e)||t>10||n>20?"complex":t>3||n>5?"medium":"simple"}function d(e,t){const n=e.lineAt(t).text.match(/^(\s*)/);return n?Math.floor(n[1].length/2):0}function h(e,t){let n=0,s=t-1;for(;s>=0;){if("`"===e[s]){let t=s-1;for(;t>=0&&/\s/.test(e[t]);)t--;const r=t+1;for(;t>=0&&/[a-zA-Z_$]/.test(e[t]);)t--;if(t>=0&&/\b(html|css)$/.test(e.slice(t+1,r))&&(n++,n>1))return!0}s--}return!1}const p=(0,a.fromPromise)(async({input:e})=>{const{document:t}=e,n=t.getText(),s=[];let r=0;for(;r<n.length;){const{type:e,start:o}=c(n,r);if(!e||-1===o)break;const i=o+e.length+1,a=D(n,i);if(-1===a){r=o+1;continue}const p=n.slice(i,a),f=t.positionAt(i),g=t.positionAt(a),F=d(t,f.line),m=h(n,o),E=l(p),C=(p.match(/\$\{/g)||[]).length,y=p.split("\n").length,v={range:new u.Range(f,g),content:p,language:e,indentLevel:F,isNested:m,complexity:E,expressionCount:C,lineCount:y,startPosition:i,endPosition:a};s.push(v),r=a+1}return s}),f=(0,a.fromPromise)(async({input:e})=>{const{templates:t}=e,n={totalTemplates:t.length,htmlTemplates:t.filter(e=>"html"===e.language).length,cssTemplates:t.filter(e=>"css"===e.language).length,nestedTemplates:t.filter(e=>e.isNested).length,complexTemplates:t.filter(e=>"complex"===e.complexity).length,processingTime:Date.now()};return{templates:t,stats:n}}),g=(0,a.fromPromise)(async({input:e})=>{const{templates:t}=e,n=[];for(const e of t){if(e.content.trim()||n.push(`Empty ${e.language} template found`),"html"===e.language){const t=(e.content.match(/<[^/][^>]*>/g)||[]).length,s=(e.content.match(/<\/[^>]*>/g)||[]).length;t-(e.content.match(/<[^>]*\/>/g)||[]).length!==s&&n.push(`Mismatched HTML tags in template at line ${e.range.start.line+1}`)}"css"===e.language&&(e.content.match(/\{/g)||[]).length!==(e.content.match(/\}/g)||[]).length&&n.push(`Mismatched CSS braces in template at line ${e.range.start.line+1}`)}return{templates:t,errors:n}});t.discoveryMachine=(0,a.setup)({types:{context:{},events:{}},actors:{discoverTemplates:p,analyzeTemplates:f,validateTemplates:g},actions:{setDocument:(0,a.assign)({document:({event:e})=>"DISCOVER"===e.type?e.document:null,text:({event:e})=>"DISCOVER"===e.type?e.document.getText():"",position:0}),updateTemplates:(0,a.assign)({templates:({context:e,event:t})=>"TEMPLATE_FOUND"===t.type?[...e.templates,t.template]:e.templates}),setAnalysisResults:(0,a.assign)({templates:({context:e,event:t})=>(t.type,e.templates)}),setValidationResults:(0,a.assign)({errors:({context:e,event:t})=>(t.type,e.errors)}),addError:(0,a.assign)({errors:({context:e,event:t})=>"ERROR"===t.type?[...e.errors,t.error]:e.errors}),resetState:(0,a.assign)({document:null,text:"",position:0,templates:[],errors:[],currentTemplate:null,stats:{totalTemplates:0,htmlTemplates:0,cssTemplates:0,nestedTemplates:0,complexTemplates:0,processingTime:0}})}}).createMachine({id:"discovery",initial:"idle",context:{document:null,text:"",position:0,templates:[],errors:[],currentTemplate:null,stats:{totalTemplates:0,htmlTemplates:0,cssTemplates:0,nestedTemplates:0,complexTemplates:0,processingTime:0}},states:{idle:{on:{DISCOVER:{target:"scanning",actions:"setDocument"}}},scanning:{invoke:{id:"discoverTemplates",src:"discoverTemplates",input:({context:e})=>{if(!e.document)throw new Error("No document provided for scanning");return{document:e.document}},onDone:{target:"analyzing",actions:(0,a.assign)({templates:({event:e})=>e.output})},onError:{target:"error",actions:(0,a.assign)({errors:({context:e,event:t})=>[...e.errors,`Discovery error: ${t.error}`]})}}},analyzing:{invoke:{id:"analyzeTemplates",src:"analyzeTemplates",input:({context:e})=>({templates:e.templates}),onDone:{target:"validating",actions:(0,a.assign)({templates:({event:e})=>e.output.templates,stats:({event:e})=>e.output.stats})},onError:{target:"error",actions:(0,a.assign)({errors:({context:e,event:t})=>[...e.errors,`Analysis error: ${t.error}`]})}}},validating:{invoke:{id:"validateTemplates",src:"validateTemplates",input:({context:e})=>({templates:e.templates}),onDone:{target:"completed",actions:(0,a.assign)({templates:({event:e})=>e.output.templates,errors:({event:e})=>e.output.errors})},onError:{target:"error",actions:(0,a.assign)({errors:({context:e,event:t})=>[...e.errors,`Validation error: ${t.error}`]})}}},completed:{on:{DISCOVER:{target:"scanning",actions:"setDocument"},RESET:{target:"idle",actions:"resetState"}}},error:{on:{RETRY:{target:"scanning"},RESET:{target:"idle",actions:"resetState"}}}}})},7598:e=>{"use strict";e.exports=require("node:crypto")},7672:(e,t,n)=>{"use strict";const{isUtf8:s}=n(181),{hasBlob:r}=n(6614);function o(e){const t=e.length;let n=0;for(;n<t;)if(128&e[n])if(192==(224&e[n])){if(n+1===t||128!=(192&e[n+1])||192==(254&e[n]))return!1;n+=2}else if(224==(240&e[n])){if(n+2>=t||128!=(192&e[n+1])||128!=(192&e[n+2])||224===e[n]&&128==(224&e[n+1])||237===e[n]&&160==(224&e[n+1]))return!1;n+=3}else{if(240!=(248&e[n]))return!1;if(n+3>=t||128!=(192&e[n+1])||128!=(192&e[n+2])||128!=(192&e[n+3])||240===e[n]&&128==(240&e[n+1])||244===e[n]&&e[n+1]>143||e[n]>244)return!1;n+=4}else n++;return!0}if(e.exports={isBlob:function(e){return r&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:o,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},s)e.exports.isValidUTF8=function(e){return e.length<24?o(e):s(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{const t=n(Object(function(){var e=new Error("Cannot find module 'utf-8-validate'");throw e.code="MODULE_NOT_FOUND",e}()));e.exports.isValidUTF8=function(e){return e.length<32?o(e):t(e)}}catch(e){}},7679:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.XStateRangeFormattingProvider=t.XStateFormattingProvider=void 0;const u=i(n(1398)),a=n(9438);class c{constructor(e){this.outputChannel=e;try{const t=u.extensions.getExtension("actor-spa.actor-spa-framework");this.version=t?.packageJSON?.version||"unknown",this.legacyFormatter=new a.ActorSpaFormattingProvider(e),this.testXStateImports(),this.log(`ðŸ¤– XState Formatter v${this.version} initialized - XState machine ready`)}catch(t){this.version="unknown",this.log(`âŒ XState Formatter initialization error: ${t instanceof Error?t.message:String(t)}`),this.log(`ðŸ“Š Error stack: ${t instanceof Error?t.stack:"No stack"}`),this.legacyFormatter=new a.ActorSpaFormattingProvider(e)}}testXStateImports(){try{const e=n(3922);this.log("ðŸ”§ XState imports test successful",{xstateAvailable:!!e,createActorType:typeof e.createActor})}catch(e){throw this.log("âŒ XState imports failed during test",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:"No stack"}),new Error(`XState imports failed: ${e instanceof Error?e.message:String(e)}`)}}log(e,t){try{const n=`[${(new Date).toISOString()}] [XState Formatter] ${e}`;if(this.outputChannel){const e=t?` | Data: ${JSON.stringify(t,null,2)}`:"";this.outputChannel.appendLine(`${n}${e}`),this.outputChannel.show()}}catch(e){}}async provideDocumentFormattingEdits(e,t,n){this.log(`ðŸš€ XState formatter v${this.version} activated - Using state machine`),this.log(`ðŸ” Processing document: ${e.fileName} (${e.getText().length} characters)`),this.log(`ðŸ“Š Formatting options: tabSize=${t.tabSize}, insertSpaces=${t.insertSpaces}`);try{return await this.formatWithXStateMachine(e,t,n)}catch(s){this.log("âŒ XState machine failed, falling back to legacy formatter",{error:s instanceof Error?s.message:String(s),stack:s instanceof Error?s.stack:"No stack"});try{return await this.legacyFormatter.provideDocumentFormattingEdits(e,t,n)}catch(e){return this.log("âŒ Even legacy formatter failed",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:"No stack"}),[]}}}async formatWithXStateMachine(e,t,s){this.log("ðŸ¤– Starting XState formatter machine");try{this.log("ðŸ“¦ Loading XState modules...");const{createActor:s}=n(3922),{formatterMachine:r}=n(4367);this.log("ðŸ”§ XState modules loaded successfully"),this.log("ðŸŽ­ Creating XState actor...");const o=s(r);this.log("ðŸŽ­ Created XState actor, starting machine"),this.log("ðŸš€ Starting XState machine..."),o.start(),this.log("ðŸš€ XState machine started successfully");const i=e.getText();this.log("ðŸ“ Processing document text with XState machine",{textLength:i.length,fileName:e.fileName,firstChars:i.substring(0,100)}),this.log("ðŸ“¤ Sending START_FORMATTING event..."),o.send({type:"START_FORMATTING",input:i,options:t}),this.log("ðŸ“¤ START_FORMATTING event sent successfully"),this.log("ðŸ“Š Getting machine state...");const u=o.getSnapshot();this.log("ðŸ“Š XState machine state",{state:u.value,contextKeys:Object.keys(u.context),hasFormattedEdits:u.context.formattedEdits?.length>0,editsCount:u.context.formattedEdits?.length||0,hasInput:!!u.context.input,inputLength:u.context.input?.length||0}),this.log("ðŸ›‘ Stopping XState machine..."),o.stop(),this.log("ðŸ›‘ XState machine stopped");const a=u.context.formattedEdits||[];return this.log(`âœ… XState machine completed with ${a.length} edits`),a}catch(e){throw this.log("âŒ XState machine processing failed",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:"No stack",errorName:e instanceof Error?e.name:"Unknown"}),e}}}t.XStateFormattingProvider=c,t.XStateRangeFormattingProvider=class{constructor(e){this.formattingProvider=new c(e)}async provideDocumentRangeFormattingEdits(e,t,n,s){return this.formattingProvider.provideDocumentFormattingEdits(e,n,s)}}},7682:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(e){try{const t=u.extensions.getExtension("actor-spa.actor-spa-framework"),n=t?.packageJSON?.version||"unknown";p=u.window.createOutputChannel("Actor-SPA Framework"),p.show(),f=(0,c.createDebugLogger)(p),f.info(c.COMPONENTS.EXTENSION,`ðŸš€ Actor-SPA Framework extension v${n} activated`),f.debug(c.COMPONENTS.EXTENSION,"Extension context details",{extensionPath:e.extensionPath,globalState:!!e.globalState,workspaceState:!!e.workspaceState,version:n});let s,r;switch(u.workspace.getConfiguration("actor-spa").get("formatting.formatter","simple")){case"simple":{f.info(c.COMPONENTS.EXTENSION,"ðŸŽ¯ Using Simple formatter (recommended)");const e=new h.SimpleFormattingProvider(p);s=e,r=e;break}case"actor":{f.info(c.COMPONENTS.EXTENSION,"ðŸ¤– Using Actor-based formatter");const e=(0,D.createFormattingProvider)(p,f);s=e.documentProvider,r=e.rangeProvider;break}default:f.info(c.COMPONENTS.EXTENSION,"ðŸ“¦ Using Legacy formatter"),s=new l.ActorSpaFormattingProvider(p),r=new l.ActorSpaRangeFormattingProvider(p)}const o=[{language:"typescript",scheme:"file"},{language:"javascript",scheme:"file"},{language:"typescriptreact",scheme:"file"},{language:"javascriptreact",scheme:"file"}],i=u.languages.registerDocumentFormattingEditProvider(o,s),g=u.languages.registerDocumentRangeFormattingEditProvider(o,r),F=new d.ReactiveLintProvider(p),m=u.languages.registerCodeActionsProvider(o,F),E=u.workspace.onDidChangeTextDocument(e=>{"typescript"!==e.document.languageId&&"typescriptreact"!==e.document.languageId||setTimeout(()=>{F.analyzeFile(e.document)},1e3)});u.workspace.textDocuments.forEach(e=>{"typescript"!==e.languageId&&"typescriptreact"!==e.languageId||F.analyzeFile(e)});const C=u.commands.registerCommand("actor-spa.generateComponent",()=>{f.info(c.COMPONENTS.EXTENSION,"ðŸ“¦ Generate Component command executed"),u.window.showInformationMessage("Actor-SPA: Generate Component command executed!")}),y=u.commands.registerCommand("actor-spa.showReactivePatternDocs",e=>{f.info(c.COMPONENTS.EXTENSION,`ðŸ“– Showing reactive pattern docs for rule: ${e}`);const t=u.Uri.file(`${u.workspace.workspaceFolders?.[0]?.uri.fsPath}/docs/REACTIVE_PATTERNS.md`);u.window.showTextDocument(t).then(()=>{const t=u.window.activeTextEditor;if(t){const n=t.document,s=n.getText(),r=new RegExp(`### \\d+\\. \`${e}\``,"i"),o=s.match(r);if(o&&void 0!==o.index){const e=n.positionAt(o.index),s=new u.Range(e,e);t.selection=new u.Selection(s.start,s.end),t.revealRange(s,u.TextEditorRevealType.InCenter)}}},e=>{u.window.showErrorMessage(`Could not open reactive patterns documentation: ${e.message}`)})}),v=u.commands.registerCommand("actor-spa.generateMachine",()=>{f.info(c.COMPONENTS.EXTENSION,"ðŸ¤– Generate Machine command executed"),u.window.showInformationMessage("Actor-SPA: Generate Machine command executed!")});(0,a.initializeAICommunication)(e,p).catch(e=>{f.error(c.COMPONENTS.EXTENSION,"âŒ Failed to initialize AI Communication",void 0,e instanceof Error?e:new Error(String(e)))}),(0,a.registerAICommunicationCommands)(e),e.subscriptions.push(p,i,g,m,E,C,v,y,F),f.info(c.COMPONENTS.EXTENSION,"âœ… All providers registered successfully")}catch(t){p||(p=u.window.createOutputChannel("Actor-SPA Framework")),f||(f=(0,c.createDebugLogger)(p)),f.error(c.COMPONENTS.EXTENSION,"âŒ Extension activation failed",void 0,t instanceof Error?t:new Error(String(t)));try{const t=new h.SimpleFormattingProvider(p),n=[{language:"typescript",scheme:"file"},{language:"javascript",scheme:"file"},{language:"typescriptreact",scheme:"file"},{language:"javascriptreact",scheme:"file"}],s=u.languages.registerDocumentFormattingEditProvider(n,t);e.subscriptions.push(p,s),f.info(c.COMPONENTS.EXTENSION,"ðŸ†˜ Fallback to simple formatter activated")}catch(e){f.error(c.COMPONENTS.EXTENSION,"ðŸ’¥ Fallback also failed",void 0,e instanceof Error?e:new Error(String(e)))}}},t.deactivate=function(){f&&f.info(c.COMPONENTS.EXTENSION,"ðŸ‘‹ Actor-SPA Framework extension deactivated"),(0,a.cleanupAICommunication)(),p&&p.dispose()},t.getOutputChannel=function(){return p},t.getDebugLogger=function(){return f};const u=i(n(1398)),a=n(3384),c=n(9600),D=n(3917),l=n(9438),d=n(1999),h=n(6444);let p,f},7730:(e,t,n)=>{"use strict";const{Duplex:s}=n(2203),{randomFillSync:r}=n(6982),o=n(9147),{EMPTY_BUFFER:i,kWebSocket:u,NOOP:a}=n(6614),{isBlob:c,isValidStatusCode:D}=n(7672),{mask:l,toBuffer:d}=n(6890),h=Symbol("kByteLength"),p=Buffer.alloc(4),f=8192;let g,F=f;class m{constructor(e,t,n){this._extensions=t||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=a,this[u]=void 0}static frame(e,t){let n,s,o=!1,i=2,u=!1;t.mask&&(n=t.maskBuffer||p,t.generateMask?t.generateMask(n):(F===f&&(void 0===g&&(g=Buffer.alloc(f)),r(g,0,f),F=0),n[0]=g[F++],n[1]=g[F++],n[2]=g[F++],n[3]=g[F++]),u=0===(n[0]|n[1]|n[2]|n[3]),i=6),"string"==typeof e?s=t.mask&&!u||void 0===t[h]?(e=Buffer.from(e)).length:t[h]:(s=e.length,o=t.mask&&t.readOnly&&!u);let a=s;s>=65536?(i+=8,a=127):s>125&&(i+=2,a=126);const c=Buffer.allocUnsafe(o?s+i:i);return c[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(c[0]|=64),c[1]=a,126===a?c.writeUInt16BE(s,2):127===a&&(c[2]=c[3]=0,c.writeUIntBE(s,4,6)),t.mask?(c[1]|=128,c[i-4]=n[0],c[i-3]=n[1],c[i-2]=n[2],c[i-1]=n[3],u?[c,e]:o?(l(e,n,c,i,s),[c]):(l(e,n,e,0,s),[c,e])):[c,e]}close(e,t,n,s){let r;if(void 0===e)r=i;else{if("number"!=typeof e||!D(e))throw new TypeError("First argument must be a valid error code number");if(void 0!==t&&t.length){const n=Buffer.byteLength(t);if(n>123)throw new RangeError("The message must not be greater than 123 bytes");r=Buffer.allocUnsafe(2+n),r.writeUInt16BE(e,0),"string"==typeof t?r.write(t,2):r.set(t,2)}else r=Buffer.allocUnsafe(2),r.writeUInt16BE(e,0)}const o={[h]:r.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,r,!1,o,s]):this.sendFrame(m.frame(r,o),s)}ping(e,t,n){let s,r;if("string"==typeof e?(s=Buffer.byteLength(e),r=!1):c(e)?(s=e.size,r=!1):(s=(e=d(e)).length,r=d.readOnly),s>125)throw new RangeError("The data size must not be greater than 125 bytes");const o={[h]:s,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:r,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):0!==this._state?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(m.frame(e,o),n)}pong(e,t,n){let s,r;if("string"==typeof e?(s=Buffer.byteLength(e),r=!1):c(e)?(s=e.size,r=!1):(s=(e=d(e)).length,r=d.readOnly),s>125)throw new RangeError("The data size must not be greater than 125 bytes");const o={[h]:s,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:r,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):0!==this._state?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(m.frame(e,o),n)}send(e,t,n){const s=this._extensions[o.extensionName];let r,i,u=t.binary?2:1,a=t.compress;"string"==typeof e?(r=Buffer.byteLength(e),i=!1):c(e)?(r=e.size,i=!1):(r=(e=d(e)).length,i=d.readOnly),this._firstFragment?(this._firstFragment=!1,a&&s&&s.params[s._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(a=r>=s._threshold),this._compress=a):(a=!1,u=0),t.fin&&(this._firstFragment=!0);const D={[h]:r,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:u,readOnly:i,rsv1:a};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,D,n]):this.getBlobData(e,this._compress,D,n):0!==this._state?this.enqueue([this.dispatch,e,this._compress,D,n]):this.dispatch(e,this._compress,D,n)}getBlobData(e,t,n,s){this._bufferedBytes+=n[h],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){const e=new Error("The socket was closed while the blob was being read");return void process.nextTick(E,this,e,s)}this._bufferedBytes-=n[h];const r=d(e);t?this.dispatch(r,t,n,s):(this._state=0,this.sendFrame(m.frame(r,n),s),this.dequeue())}).catch(e=>{process.nextTick(C,this,e,s)})}dispatch(e,t,n,s){if(!t)return void this.sendFrame(m.frame(e,n),s);const r=this._extensions[o.extensionName];this._bufferedBytes+=n[h],this._state=1,r.compress(e,n.fin,(e,t)=>{this._socket.destroyed?E(this,new Error("The socket was closed while data was being compressed"),s):(this._bufferedBytes-=n[h],this._state=0,n.readOnly=!1,this.sendFrame(m.frame(t,n),s),this.dequeue())})}dequeue(){for(;0===this._state&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][h],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][h],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function E(e,t,n){"function"==typeof n&&n(t);for(let n=0;n<e._queue.length;n++){const s=e._queue[n],r=s[s.length-1];"function"==typeof r&&r(t)}}function C(e,t,n){E(e,t,n),e.onerror(t)}e.exports=m},7975:e=>{"use strict";e.exports=require("node:util")},8161:e=>{"use strict";e.exports=require("node:os")},8165:(e,t,n)=>{"use strict";const{kForOnEventAttribute:s,kListener:r}=n(6614),o=Symbol("kCode"),i=Symbol("kData"),u=Symbol("kError"),a=Symbol("kMessage"),c=Symbol("kReason"),D=Symbol("kTarget"),l=Symbol("kType"),d=Symbol("kWasClean");class h{constructor(e){this[D]=null,this[l]=e}get target(){return this[D]}get type(){return this[l]}}Object.defineProperty(h.prototype,"target",{enumerable:!0}),Object.defineProperty(h.prototype,"type",{enumerable:!0});class p extends h{constructor(e,t={}){super(e),this[o]=void 0===t.code?0:t.code,this[c]=void 0===t.reason?"":t.reason,this[d]=void 0!==t.wasClean&&t.wasClean}get code(){return this[o]}get reason(){return this[c]}get wasClean(){return this[d]}}Object.defineProperty(p.prototype,"code",{enumerable:!0}),Object.defineProperty(p.prototype,"reason",{enumerable:!0}),Object.defineProperty(p.prototype,"wasClean",{enumerable:!0});class f extends h{constructor(e,t={}){super(e),this[u]=void 0===t.error?null:t.error,this[a]=void 0===t.message?"":t.message}get error(){return this[u]}get message(){return this[a]}}Object.defineProperty(f.prototype,"error",{enumerable:!0}),Object.defineProperty(f.prototype,"message",{enumerable:!0});class g extends h{constructor(e,t={}){super(e),this[i]=void 0===t.data?null:t.data}get data(){return this[i]}}Object.defineProperty(g.prototype,"data",{enumerable:!0});const F={addEventListener(e,t,n={}){for(const o of this.listeners(e))if(!n[s]&&o[r]===t&&!o[s])return;let o;if("message"===e)o=function(e,n){const s=new g("message",{data:n?e:e.toString()});s[D]=this,m(t,this,s)};else if("close"===e)o=function(e,n){const s=new p("close",{code:e,reason:n.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});s[D]=this,m(t,this,s)};else if("error"===e)o=function(e){const n=new f("error",{error:e,message:e.message});n[D]=this,m(t,this,n)};else{if("open"!==e)return;o=function(){const e=new h("open");e[D]=this,m(t,this,e)}}o[s]=!!n[s],o[r]=t,n.once?this.once(e,o):this.on(e,o)},removeEventListener(e,t){for(const n of this.listeners(e))if(n[r]===t&&!n[s]){this.removeListener(e,n);break}}};function m(e,t,n){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,n):e.call(t,n)}e.exports={CloseEvent:p,ErrorEvent:f,Event:h,EventTarget:F,MessageEvent:g}},8410:(e,t,n)=>{"use strict";const s=n(4434),r=n(8611),{Duplex:o}=n(2203),{createHash:i}=n(6982),u=n(2902),a=n(9147),c=n(8653),D=n(3540),{GUID:l,kWebSocket:d}=n(6614),h=/^[+/0-9A-Za-z]{22}==$/;function p(e){e._state=2,e.emit("close")}function f(){this.destroy()}function g(e,t,n,s){n=n||r.STATUS_CODES[t],s={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(n),...s},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${r.STATUS_CODES[t]}\r\n`+Object.keys(s).map(e=>`${e}: ${s[e]}`).join("\r\n")+"\r\n\r\n"+n)}function F(e,t,n,s,r,o){if(e.listenerCount("wsClientError")){const s=new Error(r);Error.captureStackTrace(s,F),e.emit("wsClientError",s,n,t)}else g(n,s,r,o)}e.exports=class extends s{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:D,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=r.createServer((e,t)=>{const n=r.STATUS_CODES[426];t.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),t.end(n)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(const n of Object.keys(t))e.on(n,t[n]);return function(){for(const n of Object.keys(t))e.removeListener(n,t[n])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,n,s)=>{this.handleUpgrade(t,n,s,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state)return e&&this.once("close",()=>{e(new Error("The server is not running"))}),void process.nextTick(p,this);if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(p,this);else{const e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{p(this)})}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,s){t.on("error",f);const r=e.headers["sec-websocket-key"],o=e.headers.upgrade,i=+e.headers["sec-websocket-version"];if("GET"!==e.method)return void F(this,e,t,405,"Invalid HTTP method");if(void 0===o||"websocket"!==o.toLowerCase())return void F(this,e,t,400,"Invalid Upgrade header");if(void 0===r||!h.test(r))return void F(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");if(13!==i&&8!==i)return void F(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});if(!this.shouldHandle(e))return void g(t,400);const D=e.headers["sec-websocket-protocol"];let l=new Set;if(void 0!==D)try{l=c.parse(D)}catch(n){return void F(this,e,t,400,"Invalid Sec-WebSocket-Protocol header")}const d=e.headers["sec-websocket-extensions"],p={};if(this.options.perMessageDeflate&&void 0!==d){const n=new a(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const e=u.parse(d);e[a.extensionName]&&(n.accept(e[a.extensionName]),p[a.extensionName]=n)}catch(n){return void F(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header")}}if(this.options.verifyClient){const o={origin:e.headers[8===i?"sec-websocket-origin":"origin"],secure:!(!e.socket.authorized&&!e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(o,(o,i,u,a)=>{if(!o)return g(t,i||401,u,a);this.completeUpgrade(p,r,l,e,t,n,s)});if(!this.options.verifyClient(o))return g(t,401)}this.completeUpgrade(p,r,l,e,t,n,s)}completeUpgrade(e,t,n,s,r,o,c){if(!r.readable||!r.writable)return r.destroy();if(r[d])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return g(r,503);const D=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${i("sha1").update(t+l).digest("base64")}`],h=new this.options.WebSocket(null,void 0,this.options);if(n.size){const e=this.options.handleProtocols?this.options.handleProtocols(n,s):n.values().next().value;e&&(D.push(`Sec-WebSocket-Protocol: ${e}`),h._protocol=e)}if(e[a.extensionName]){const t=e[a.extensionName].params,n=u.format({[a.extensionName]:[t]});D.push(`Sec-WebSocket-Extensions: ${n}`),h._extensions=e}this.emit("headers",D,s),r.write(D.concat("\r\n").join("\r\n")),r.removeListener("error",f),h.setSocket(r,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(h),h.on("close",()=>{this.clients.delete(h),this._shouldEmitClose&&!this.clients.size&&process.nextTick(p,this)})),c(h,s)}}},8611:e=>{"use strict";e.exports=require("http")},8653:(e,t,n)=>{"use strict";const{tokenChars:s}=n(7672);e.exports={parse:function(e){const t=new Set;let n=-1,r=-1,o=0;for(;o<e.length;o++){const i=e.charCodeAt(o);if(-1===r&&1===s[i])-1===n&&(n=o);else if(0===o||32!==i&&9!==i){if(44!==i)throw new SyntaxError(`Unexpected character at index ${o}`);{if(-1===n)throw new SyntaxError(`Unexpected character at index ${o}`);-1===r&&(r=o);const s=e.slice(n,r);if(t.has(s))throw new SyntaxError(`The "${s}" subprotocol is duplicated`);t.add(s),n=r=-1}}else-1===r&&-1!==n&&(r=o)}if(-1===n||-1!==r)throw new SyntaxError("Unexpected end of input");const i=e.slice(n,o);if(t.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return t.add(i),t}}},9023:e=>{"use strict";e.exports=require("util")},9147:(e,t,n)=>{"use strict";const s=n(3106),r=n(6890),o=n(1591),{kStatusCode:i}=n(6614),u=Buffer[Symbol.species],a=Buffer.from([0,0,255,255]),c=Symbol("permessage-deflate"),D=Symbol("total-length"),l=Symbol("callback"),d=Symbol("buffers"),h=Symbol("error");let p;function f(e){this[d].push(e),this[D]+=e.length}function g(e){this[D]+=e.length,this[c]._maxPayload<1||this[D]<=this[c]._maxPayload?this[d].push(e):(this[h]=new RangeError("Max payload size exceeded"),this[h].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[h][i]=1009,this.removeListener("data",g),this.reset())}function F(e){this[c]._inflate=null,this[h]?this[l](this[h]):(e[i]=1007,this[l](e))}e.exports=class{constructor(e,t,n){if(this._maxPayload=0|n,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!p){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;p=new o(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[l];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,n=e.find(e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(n.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?n.client_max_window_bits=t.clientMaxWindowBits:!0!==n.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete n.client_max_window_bits,n}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let n=e[t];if(n.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(n=n[0],"client_max_window_bits"===t){if(!0!==n){const e=+n;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}else if("server_max_window_bits"===t){const e=+n;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==n)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}e[t]=n})}),e}decompress(e,t,n){p.add(s=>{this._decompress(e,t,(e,t)=>{s(),n(e,t)})})}compress(e,t,n){p.add(s=>{this._compress(e,t,(e,t)=>{s(),n(e,t)})})}_decompress(e,t,n){const o=this._isServer?"client":"server";if(!this._inflate){const e=`${o}_max_window_bits`,t="number"!=typeof this.params[e]?s.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=s.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[c]=this,this._inflate[D]=0,this._inflate[d]=[],this._inflate.on("error",F),this._inflate.on("data",g)}this._inflate[l]=n,this._inflate.write(e),t&&this._inflate.write(a),this._inflate.flush(()=>{const e=this._inflate[h];if(e)return this._inflate.close(),this._inflate=null,void n(e);const s=r.concat(this._inflate[d],this._inflate[D]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[D]=0,this._inflate[d]=[],t&&this.params[`${o}_no_context_takeover`]&&this._inflate.reset()),n(null,s)})}_compress(e,t,n){const o=this._isServer?"server":"client";if(!this._deflate){const e=`${o}_max_window_bits`,t="number"!=typeof this.params[e]?s.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=s.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[D]=0,this._deflate[d]=[],this._deflate.on("data",f)}this._deflate[l]=n,this._deflate.write(e),this._deflate.flush(s.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=r.concat(this._deflate[d],this._deflate[D]);t&&(e=new u(e.buffer,e.byteOffset,e.length-4)),this._deflate[l]=null,this._deflate[D]=0,this._deflate[d]=[],t&&this.params[`${o}_no_context_takeover`]&&this._deflate.reset(),n(null,e)})}}},9153:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.AIWebSocketClient=t.webSocketServerMachine=void 0,t.createWebSocketServer=function(e,n){const s=(0,D.createActor)(t.webSocketServerMachine,{input:{config:{...d,...e}}});return n&&s.subscribe(e=>{n.debug(l,`State: ${JSON.stringify(e.value)}`,{activeConnections:e.context.connections.size,stats:e.context.stats})}),s};const u=n(7598),a=i(n(7067)),c=i(n(3747)),D=n(3922),l="WEBSOCKET_SERVER",d={port:8765,host:"localhost",maxConnections:100,heartbeatInterval:3e4,connectionTimeout:6e4,messageTimeout:3e4,maxMessageSize:1048576},h=(0,D.fromPromise)(async({input:e})=>{const{config:t,onConnection:n,debugLogger:s}=e;return new Promise((e,r)=>{const o=a.createServer(),i=new c.Server({server:o,maxPayload:t.maxMessageSize});i.on("connection",e=>{s?.info(l,"New WebSocket connection"),n(e)}),i.on("error",e=>{s?.error(l,"WebSocket server error",void 0,e),r(e)}),o.listen(t.port,t.host,()=>{s?.info(l,`WebSocket server started on ${t.host}:${t.port}`),e({server:i,httpServer:o})}),o.on("error",e=>{s?.error(l,"HTTP server error",void 0,e),r(e)})})}),p=(0,D.fromPromise)(async({input:e})=>{const{server:t,httpServer:n,connections:s}=e;s.forEach(e=>{e.ws.readyState===c.OPEN&&e.ws.close(1e3,"Server shutting down")}),t&&await new Promise(e=>{t.close(()=>e())}),n&&await new Promise(e=>{n.close(()=>e())})});t.webSocketServerMachine=(0,D.setup)({types:{context:{},events:{}},actors:{startServer:h,stopServer:p},actions:{initialize:(0,D.assign)({config:()=>d,connections:()=>new Map,stats:()=>({totalConnections:0,activeConnections:0,messagesSent:0,messagesReceived:0,errors:0}),errors:()=>[]}),setServer:(0,D.assign)({server:({event:e})=>"output"in e?e.output.server:null,httpServer:({event:e})=>"output"in e?e.output.httpServer:null}),addConnection:(0,D.assign)({connections:({context:e,event:t})=>{if("CONNECTION"!==t.type)return e.connections;const n={id:(0,u.randomUUID)(),ws:t.ws,agent:t.agent,connectedAt:Date.now(),lastActivity:Date.now(),messageCount:0},s=new Map(e.connections);return s.set(n.id,n),t.ws.on("message",e=>{try{JSON.parse(e.toString())}catch(e){}}),t.ws.on("close",()=>{s.delete(n.id)}),t.ws.on("error",e=>{}),s},stats:({context:e,event:t})=>"CONNECTION"!==t.type?e.stats:{...e.stats,totalConnections:e.stats.totalConnections+1,activeConnections:e.stats.activeConnections+1}}),removeConnection:(0,D.assign)({connections:({context:e,event:t})=>{if("DISCONNECTION"!==t.type)return e.connections;const n=new Map(e.connections);return n.delete(t.connectionId),n},stats:({context:e,event:t})=>"DISCONNECTION"!==t.type?e.stats:{...e.stats,activeConnections:Math.max(0,e.stats.activeConnections-1)}}),handleMessage:(0,D.assign)({connections:({context:e,event:t})=>{if("MESSAGE"!==t.type)return e.connections;const n=new Map(e.connections),s=n.get(t.connectionId);return s&&(s.lastActivity=Date.now(),s.messageCount++),n},stats:({context:e,event:t})=>"MESSAGE"!==t.type?e.stats:{...e.stats,messagesReceived:e.stats.messagesReceived+1}}),broadcastMessage:({context:e,event:t})=>{if("BROADCAST"!==t.type)return;const{message:n,excludeId:s}=t;let r=0;e.connections.forEach((e,t)=>{if(t!==s&&e.ws.readyState===c.OPEN)try{e.ws.send(JSON.stringify(n)),r++}catch(e){}}),e.stats.messagesSent+=r},sendToConnection:({context:e,event:t})=>{if("SEND_TO"!==t.type)return;const{connectionId:n,message:s}=t,r=e.connections.get(n);if(r&&r.ws.readyState===c.OPEN)try{r.ws.send(JSON.stringify(s)),e.stats.messagesSent++}catch(e){}},checkConnections:({context:e})=>{const t=Date.now(),n=e.config.connectionTimeout;e.connections.forEach((e,s)=>{t-e.lastActivity>n?e.ws.readyState===c.OPEN&&e.ws.close(1e3,"Connection timeout"):e.ws.readyState===c.OPEN&&e.ws.ping()})},clearServer:(0,D.assign)({server:()=>null,httpServer:()=>null}),logError:(0,D.assign)({errors:({context:e,event:t})=>"ERROR"===t.type?[...e.errors,t.error]:e.errors,stats:({context:e,event:t})=>"ERROR"===t.type?{...e.stats,errors:e.stats.errors+1}:e.stats})}}).createMachine({id:"webSocketServer",initial:"stopped",context:{server:null,httpServer:null,connections:new Map,config:d,stats:{totalConnections:0,activeConnections:0,messagesSent:0,messagesReceived:0,errors:0},errors:[]},states:{stopped:{entry:"initialize",on:{START:"starting"}},starting:{invoke:{id:"startServer",src:"startServer",input:({context:e,self:t})=>({config:e.config,onConnection:e=>{e.once("message",n=>{try{const s=JSON.parse(n.toString());"HANDSHAKE"===s.type&&s.agent&&t.send({type:"CONNECTION",ws:e,agent:s.agent})}catch(t){e.close(1002,"Invalid handshake")}})},debugLogger:void 0}),onDone:{target:"running",actions:"setServer"},onError:{target:"stopped",actions:"logError"}}},running:{on:{CONNECTION:{actions:"addConnection"},DISCONNECTION:{actions:"removeConnection"},MESSAGE:{actions:"handleMessage"},BROADCAST:{actions:"broadcastMessage"},SEND_TO:{actions:"sendToConnection"},HEARTBEAT:{actions:"checkConnections"},STOP:"stopping",ERROR:{actions:"logError"}}},stopping:{invoke:{id:"stopServer",src:"stopServer",input:({context:e})=>({server:e.server,httpServer:e.httpServer,connections:e.connections}),onDone:{target:"stopped",actions:"clearServer"},onError:{target:"stopped",actions:["logError","clearServer"]}}}}}),t.AIWebSocketClient=class{constructor(e,t="ws://localhost:8765"){this.ws=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.agent=e,this.url=t}connect(){return new Promise((e,t)=>{this.ws=new c.WebSocket(this.url),this.ws.on("open",()=>{this.ws?.send(JSON.stringify({type:"HANDSHAKE",agent:this.agent})),this.reconnectAttempts=0,e()}),this.ws.on("error",e=>{t(e)}),this.ws.on("close",()=>{this.handleDisconnect()})})}handleDisconnect(){this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,setTimeout(()=>{this.connect().catch(console.error)},this.reconnectDelay*this.reconnectAttempts))}send(e){if(!this.ws||this.ws.readyState!==c.OPEN)throw new Error("WebSocket not connected");this.ws.send(JSON.stringify(e))}onMessage(e){this.ws&&this.ws.on("message",t=>{try{const n=JSON.parse(t.toString());e(n)}catch(e){}})}close(){this.ws&&(this.ws.close(),this.ws=null)}}},9157:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.aiCommunicationBridgeMachine=void 0,t.createAICommunicationBridge=function(e){const n=(0,l.createActor)(t.aiCommunicationBridgeMachine);return e&&n.subscribe(t=>{e.debug(p,`State: ${JSON.stringify(t.value)}`,{agents:t.context.agents.size,queueLength:t.context.messageQueue.length,historyLength:t.context.messageHistory.length,stats:t.context.stats})}),n},t.createAIAgent=function(e,t){return{id:(0,u.randomUUID)(),type:e,name:t,version:"1.0.0",capabilities:[]}},t.createMessage=function(e,t,n,s,r){return{id:(0,u.randomUUID)(),timestamp:Date.now(),source:e,target:t,type:n,payload:s,metadata:{priority:r?.priority??h.MessagePriority.NORMAL,channel:r?.channel??h.CommunicationChannel.GENERAL,correlationId:r?.correlationId,replyTo:r?.replyTo}}};const u=n(7598),a=i(n(1455)),c=i(n(6760)),D=i(n(1398)),l=n(3922),d=n(9600),h=n(843),p="AI_COMMUNICATION",f={maxQueueSize:1e3,maxHistorySize:1e4,messageTimeout:3e4,retryAttempts:3,retryDelay:1e3,enableEncryption:!1,enableCompression:!1,communicationMethod:"file",fileStoragePath:".ai-messages"},g=(0,l.fromPromise)(async({input:e})=>{const{message:t,storagePath:n}=e,s=c.join(D.workspace.workspaceFolders?.[0]?.uri.fsPath||process.cwd(),n);await a.mkdir(s,{recursive:!0});const r=`${t.timestamp}-${t.id}.json`,o=c.join(s,r);return await a.writeFile(o,JSON.stringify(t,null,2),"utf8"),o}),F=(0,l.fromPromise)(async({input:e})=>{const{storagePath:t,since:n=0}=e,s=c.join(D.workspace.workspaceFolders?.[0]?.uri.fsPath||process.cwd(),t);try{const e=await a.readdir(s),t=[];for(const r of e)if(r.endsWith(".json")){const e=c.join(s,r),o=await a.readFile(e,"utf8"),i=JSON.parse(o);i.timestamp>=n&&t.push(i)}return t.sort((e,t)=>e.timestamp-t.timestamp)}catch(e){return[]}}),m=(0,l.fromPromise)(async({input:e})=>{const{message:t,config:n,debugLogger:s}=e;return s?.info(p,"Processing outgoing message",{messageId:t.id,type:t.type,target:"string"==typeof t.target?t.target:t.target.id}),n.enableEncryption&&!t.metadata.encrypted&&s?.debug(p,"Encryption not yet implemented"),n.enableCompression&&!t.metadata.compressed&&s?.debug(p,"Compression not yet implemented"),{...t,signature:"not-implemented"}});t.aiCommunicationBridgeMachine=(0,l.setup)({types:{context:{},events:{}},actors:{persistMessage:g,loadMessageHistory:F,processOutgoingMessage:m},actions:{initialize:(0,l.assign)({agents:()=>new Map,messageQueue:()=>[],messageHistory:()=>[],subscriptions:()=>new Map([[h.CommunicationChannel.CODE_REVIEW,new Set],[h.CommunicationChannel.REFACTORING,new Set],[h.CommunicationChannel.ARCHITECTURE,new Set],[h.CommunicationChannel.TASK_COORDINATION,new Set],[h.CommunicationChannel.KNOWLEDGE_SHARING,new Set],[h.CommunicationChannel.SYSTEM,new Set],[h.CommunicationChannel.GENERAL,new Set]]),stats:()=>({messagesSent:0,messagesReceived:0,messagesDropped:0,averageLatency:0,activeConnections:0,lastActivity:Date.now()}),config:()=>({...f,...D.workspace.getConfiguration("actor-spa.aiCommunication").get("config",{})}),errors:()=>[]}),queueMessage:(0,l.assign)({messageQueue:({context:e,event:t})=>{if("SEND_MESSAGE"!==t.type)return e.messageQueue;const{message:n}=t,s=[...e.messageQueue,n];if(s.length>e.config.maxQueueSize){const t=s.splice(0,s.length-e.config.maxQueueSize);e.stats.messagesDropped+=t.length}return s},stats:({context:e,event:t})=>"SEND_MESSAGE"!==t.type?e.stats:{...e.stats,messagesSent:e.stats.messagesSent+1,lastActivity:Date.now()}}),processReceivedMessage:(0,l.assign)({messageHistory:({context:e,event:t})=>{if("MESSAGE_RECEIVED"!==t.type)return e.messageHistory;const n=[...e.messageHistory,t.message];return n.length>e.config.maxHistorySize&&n.splice(0,n.length-e.config.maxHistorySize),n},stats:({context:e,event:t})=>{if("MESSAGE_RECEIVED"!==t.type)return e.stats;const n=Date.now()-t.message.timestamp,s=e.stats.messagesReceived+1,r=(e.stats.averageLatency*e.stats.messagesReceived+n)/s;return{...e.stats,messagesReceived:s,averageLatency:r,lastActivity:Date.now()}}}),notifySubscribers:({context:e,event:t})=>{if("MESSAGE_RECEIVED"!==t.type)return;const{message:n}=t,s=e.subscriptions.get(n.metadata.channel);s&&s.forEach(e=>{if(e.filter){const{types:t,sources:s,priority:r}=e.filter;if(t&&!t.includes(n.type))return;if(s&&!s.includes(n.source.id))return;if(void 0!==r&&n.metadata.priority<r)return}try{e.handler(n)}catch(e){}})},addSubscription:(0,l.assign)({subscriptions:({context:e,event:t})=>{if("SUBSCRIBE"!==t.type)return e.subscriptions;const{channel:n,callback:s}=t,r={id:(0,u.randomUUID)(),channel:n,handler:s},o=e.subscriptions.get(n)||new Set;o.add(r);const i=new Map(e.subscriptions);return i.set(n,o),i}}),removeSubscription:(0,l.assign)({subscriptions:({context:e,event:t})=>{if("UNSUBSCRIBE"!==t.type)return e.subscriptions;const{channel:n,handlerId:s}=t,r=e.subscriptions.get(n);if(r){const t=new Set(Array.from(r).filter(e=>e.id!==s)),o=new Map(e.subscriptions);return o.set(n,t),o}return e.subscriptions}}),registerAgent:(0,l.assign)({agents:({context:e,event:t})=>{if("CONNECT"!==t.type)return e.agents;const{agent:n}=t,s=new Map(e.agents);return s.set(n.id,n),s},stats:({context:e,event:t})=>"CONNECT"!==t.type?e.stats:{...e.stats,activeConnections:e.stats.activeConnections+1,lastActivity:Date.now()}}),unregisterAgent:(0,l.assign)({agents:({context:e,event:t})=>{if("DISCONNECT"!==t.type)return e.agents;const{agentId:n}=t,s=new Map(e.agents);return s.delete(n),s},stats:({context:e,event:t})=>"DISCONNECT"!==t.type?e.stats:{...e.stats,activeConnections:Math.max(0,e.stats.activeConnections-1),lastActivity:Date.now()}}),clearHistory:(0,l.assign)({messageHistory:()=>[],stats:({context:e})=>({...e.stats,lastActivity:Date.now()})}),logError:(0,l.assign)({errors:({context:e,event:t})=>"ERROR"!==t.type?e.errors:[...e.errors,t.error]})}}).createMachine({id:"aiCommunicationBridge",initial:"initializing",context:{agents:new Map,messageQueue:[],messageHistory:[],subscriptions:new Map,stats:{messagesSent:0,messagesReceived:0,messagesDropped:0,averageLatency:0,activeConnections:0,lastActivity:Date.now()},config:f,errors:[]},states:{initializing:{entry:"initialize",invoke:{id:"loadHistory",src:"loadMessageHistory",input:({context:e})=>({storagePath:e.config.fileStoragePath||".ai-messages",since:Date.now()-864e5}),onDone:{target:"active",actions:(0,l.assign)({messageHistory:({event:e})=>e.output||[]})},onError:{target:"active",actions:"logError"}}},active:{on:{SEND_MESSAGE:{actions:["queueMessage"],target:".processingQueue"},MESSAGE_RECEIVED:{actions:["processReceivedMessage","notifySubscribers"]},SUBSCRIBE:{actions:"addSubscription"},UNSUBSCRIBE:{actions:"removeSubscription"},CONNECT:{actions:"registerAgent"},DISCONNECT:{actions:"unregisterAgent"},HEARTBEAT:{actions:(0,l.assign)({stats:({context:e})=>({...e.stats,lastActivity:Date.now()})})},CLEAR_HISTORY:{actions:"clearHistory"},REPLAY_MESSAGES:{actions:({context:e,event:t,self:n})=>{"REPLAY_MESSAGES"===t.type&&e.messageHistory.filter(e=>e.timestamp>=t.since).forEach(e=>{n.send({type:"MESSAGE_RECEIVED",message:e})})}},ERROR:{actions:"logError"}},initial:"idle",states:{idle:{},processingQueue:{always:[{target:"sendingMessage",guard:({context:e})=>e.messageQueue.length>0},{target:"idle"}]},sendingMessage:{invoke:{id:"processOutgoing",src:"processOutgoingMessage",input:({context:e})=>({message:e.messageQueue[0],config:e.config,debugLogger:(0,d.createDebugLogger)(D.window.createOutputChannel("AI Communication"))}),onDone:{target:"persistingMessage",actions:(0,l.assign)({messageQueue:({context:e})=>e.messageQueue.slice(1)})},onError:{target:"idle",actions:["logError",(0,l.assign)({messageQueue:({context:e})=>e.messageQueue.slice(1)})]}}},persistingMessage:{invoke:{id:"persist",src:"persistMessage",input:({context:e})=>({message:e.messageQueue[0],storagePath:e.config.fileStoragePath||".ai-messages"}),onDone:{target:"processingQueue"},onError:{target:"processingQueue",actions:"logError"}}}}}}})},9278:e=>{"use strict";e.exports=require("net")},9438:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ActorSpaRangeFormattingProvider=t.ActorSpaFormattingProvider=void 0;const u=n(1421),a=i(n(3024)),c=i(n(8161)),D=i(n(6760)),l=n(7975),d=i(n(1398));let h;try{h=n(5120)}catch(e){}const p=(0,l.promisify)(u.exec);class f{constructor(e){this.outputChannel=e;const t=d.extensions.getExtension("actor-spa.actor-spa-framework");this.version=t?.packageJSON?.version||"unknown"}log(e,t){const n=`[${(new Date).toISOString()}] [Actor-SPA Formatter] ${e}`;if(this.outputChannel){const e=t?` | Data: ${JSON.stringify(t,null,2)}`:"";this.outputChannel.appendLine(`${n}${e}`)}}logDebug(e,t){d.workspace.getConfiguration("actor-spa").get("enableDiagnostics",!0)&&this.log(`[DEBUG] ${e}`,t)}async provideDocumentFormattingEdits(e,t,n){if(this.log(`ðŸš€ Starting Actor-SPA document formatting v${this.version} (Biome â†’ Prettier â†’ Simple fallback)`,{fileName:e.fileName,languageId:e.languageId,lineCount:e.lineCount}),!d.workspace.getConfiguration("actor-spa.formatting").get("enabled",!0))return this.log("âŒ Formatting disabled in configuration"),[];const s=[],r=this.findTemplates(e);r.length>50&&this.log("âš ï¸ Large number of templates detected, formatting may take longer",{templateCount:r.length});const o={totalTemplates:r.length,nestedTemplates:r.filter(e=>e.isNested).length,htmlTemplates:r.filter(e=>"html"===e.language).length,cssTemplates:r.filter(e=>"css"===e.language).length,startTime:Date.now()};this.log(`ðŸ“‹ Found ${r.length} templates to format`,{templates:r.map(e=>({language:e.language,isNested:e.isNested,indentLevel:e.indentLevel,contentLength:e.content.length,lineRange:`${e.range.start.line+1}-${e.range.end.line+1}`,linesSpanned:e.range.end.line-e.range.start.line+1})),summary:o});let i=0,u=0;for(let e=0;e<r.length;e++){const o=r[e];if(n.isCancellationRequested){this.log("âš ï¸ Formatting cancelled by user",{processedCount:e,totalCount:r.length});break}this.logDebug(`ðŸ”§ Processing template ${e+1}/${r.length}`,{language:o.language,isNested:o.isNested,originalLength:o.content.length,linesSpanned:o.range.end.line-o.range.start.line+1});try{const n=await this.formatTemplate(o,t);n!==o.content?(s.push(d.TextEdit.replace(o.range,n)),i++,this.logDebug(`âœ… Template ${e+1} formatted successfully`,{originalLength:o.content.length,formattedLength:n.length,changePercent:Math.round((n.length-o.content.length)/o.content.length*100)})):(this.logDebug(`â­ï¸ Template ${e+1} unchanged (already formatted)`),i++)}catch(t){u++,this.log(`âŒ Failed to format template ${e+1}`,{error:t instanceof Error?t.message:String(t),template:{language:o.language,length:o.content.length,isNested:o.isNested}})}}const a=Date.now()-o.startTime;return this.log("ðŸŽ‰ Formatting complete",{totalEdits:s.length,templatesProcessed:r.length,successCount:i,errorCount:u,processingTimeMs:a,averageTimePerTemplate:r.length>0?Math.round(a/r.length):0,performance:a>5e3?"slow":a>2e3?"moderate":"fast"}),s}findTemplates(e){this.logDebug("ðŸ” Starting template discovery");const t=[],n=e.getText(),s=this.findTemplatesOfType(n,e,"html",t);this.logDebug(`Found ${s} HTML templates`);const r=this.findTemplatesOfType(n,e,"css",t);return this.logDebug(`Found ${r} CSS templates`),this.logDebug("ðŸ“Š Template discovery summary",{htmlTemplates:s,cssTemplates:r,totalTemplates:t.length,nestedTemplates:t.filter(e=>e.isNested).length}),t}findTemplatesOfType(e,t,n,s){const r=new RegExp(`\\b(${n})\\s*\``,"g");let o,i=0;for(o=r.exec(e);null!==o;){const u=o.index,a=u+o[0].length;this.logDebug(`ðŸŽ¯ Found ${n} template at position ${u}`);const c=this.findClosingBacktick(e,a);if(-1===c){this.logDebug(`âš ï¸ No closing backtick found for ${n} template at position ${u}`),o=r.exec(e);continue}const D=e.slice(a,c),l=t.positionAt(a),h=t.positionAt(c),p=l.line,f=h.line,g=this.getIndentLevel(t,l.line),F=this.isNestedTemplate(e,u);s.push({range:new d.Range(l,h),content:D,language:n,indentLevel:g,isNested:F}),i++,this.logDebug(`âœ… ${n} template processed`,{position:u,contentLength:D.length,isNested:F,indentLevel:g,lineRange:`${p+1}-${f+1}`,linesSpanned:f-p+1}),o=r.exec(e)}return i}isNestedTemplate(e,t){this.logDebug(`ðŸ” Checking if template at position ${t} is nested`);let n=0,s=0,r=t-1,o=!1,i="";for(;r>=0;){const t=e[r],u=e[r+1];if("\\"!==t){if(o||'"'!==t&&"'"!==t&&"`"!==t)o&&t===i&&(o=!1,i="");else if("`"===t){let u=r-1;for(;u>=0&&/\s/.test(e[u]);)u--;const a=u+1;for(;u>=0&&/[a-zA-Z_$]/.test(e[u]);)u--;if(u>=0&&/\b(html|css)$/.test(e.slice(u+1,a))){if(n--,this.logDebug(`ðŸŽ¯ Found template tag at position ${u+1}, template depth: ${n}`),n>0||s>0)return this.logDebug(`ðŸª† Template is nested (template depth: ${n}, expression depth: ${s})`),!0}else o=!0,i=t}else o=!0,i=t;o||("}"===t&&"}"!==u?s++:"$"===t&&"{"===u?(s--,s<0&&(s=0)):"`"===t&&n++),r--}else r-=2}return this.logDebug("ðŸ“„ Template is top-level (not nested)"),!1}findClosingBacktick(e,t){this.logDebug(`ðŸ” Finding closing backtick starting from position ${t}`),this.logDebug(`ðŸ“ Context: "${e.slice(Math.max(0,t-10),t+50)}"`);let n=0,s=t,r=!1,o="",i=!1;for(;s<e.length;){const u=e[s],a=e[s+1];if(s<t+20&&this.logDebug(`ðŸ“ Pos ${s}: char='${u}' depth=${n} inString=${r} inRegex=${i}`),"\\"!==u){if(!r&&"/"===u&&"/"!==a&&"*"!==a){let t=s-1;for(;t>=0&&/\s/.test(e[t]);)t--;const n=e[t];if(n&&"=({[,;:!&|?+\n".includes(n)){i=!0,this.logDebug(`ðŸ”¤ Entering regex at ${s}`),s++;continue}}if(i)"/"===u&&"\\"!==e[s-1]&&(i=!1,this.logDebug(`ðŸ”¤ Exiting regex at ${s}`)),s++;else{if("`"===u){if(0===n)return this.logDebug(`âœ… Found closing backtick at position ${s} (depth: ${n})`),s;n--,this.logDebug(`ðŸ“‰ Nested template closed, depth now: ${n}`)}else"$"===u&&"{"===a?(n++,this.logDebug(`ðŸ“ˆ Template expression opened, depth now: ${n}`),s++):"}"===u&&n>0&&(n--,this.logDebug(`ðŸ“‰ Template expression closed, depth now: ${n}`));r||!('"'===u||"'"===u||"`"===u&&n>0)?r?(u===o&&"\\"!==e[s-1]&&(r=!1,o="",this.logDebug(`ðŸŽ¨ Exiting string at ${s}`)),s++):s++:(r=!0,o=u,this.logDebug(`ðŸŽ¨ Entering string '${u}' at ${s}`),s++)}}else this.logDebug(`ðŸ”„ Escaped character at ${s}, skipping`),s+=2}return this.logDebug(`âŒ No closing backtick found (ended at depth: ${n})`),this.logDebug(`ðŸ“ Final context: "${e.slice(Math.max(0,s-20),s+10)}"`),-1}getIndentLevel(e,t){const n=e.lineAt(t).text.match(/^(\s*)/),s=n?Math.floor(n[1].length/2):0;return this.logDebug(`ðŸ“ Calculated indent level: ${s} for line ${t+1}`),s}validateTemplateContent(e){const t=[];if(e.content.length>1e4&&t.push(`Large template (${e.content.length} chars)`),e.isNested&&e.content.includes("${")){const n=(e.content.match(/\$\{/g)||[]).length;n>20&&t.push(`High expression density (${n} expressions)`)}"html"===e.language&&e.content.includes("<script")&&t.push("Contains script tags - may need special handling"),"css"===e.language&&e.content.includes("@import")&&t.push("Contains @import - may need special handling");const n=(e.content.match(/html`|css`/g)||[]).length;return n>5&&t.push(`Deep template nesting (${n} nested templates)`),{isValid:!0,warnings:t}}async formatTemplate(e,t){const{content:n,language:s,indentLevel:r}=e;if(this.logDebug(`ðŸŽ¨ Starting ${s} template formatting`,{contentLength:n.length,indentLevel:r,tabSize:t.tabSize}),!n.trim())return this.logDebug("â­ï¸ Skipping empty template"),n;const o=this.validateTemplateContent(e);o.warnings.length>0&&this.logDebug("âš ï¸ Template validation warnings",{warnings:o.warnings,language:e.language,isNested:e.isNested});try{const{content:e,expressions:t}=this.extractExpressions(n);this.logDebug(`ðŸ”§ Extracted ${t.length} expressions`,{expressionsWithNestedTemplates:t.filter(e=>e.hasNestedTemplate).length,cleanContentLength:e.length});const o=await this.formatWithBiome(e,s);this.logDebug(`âœ¨ ${s} formatting applied`,{originalLength:e.length,formattedLength:o.length});const i=this.restoreExpressions(o,t);this.logDebug(`ðŸ”„ Restored ${t.length} expressions`);const u=this.applyTemplateLiteralStyle(i,r);return this.logDebug("ðŸŽ¯ Applied template literal styling",{finalLength:u.length,totalChangePercent:Math.round((u.length-n.length)/n.length*100)}),u}catch(e){return this.log(`âŒ Formatting failed for ${s} template`,{error:e instanceof Error?e.message:String(e),contentLength:n.length,indentLevel:r}),n}}async formatWithBiome(e,t){this.logDebug(`ðŸ”§ Formatting ${t} content (Biome CLI â†’ Prettier â†’ Legacy)`,{contentLength:e.length});try{try{this.logDebug(`ðŸŸª Attempting Biome CLI formatting for ${t}`);const n=d.extensions.getExtension("actor-spa.actor-spa-framework")?.extensionPath;if(!n)throw new Error("Extension path not found");const s=D.join(n,"node_modules",".bin","biome");let r=s;try{await a.promises.access(s)}catch{r="biome"}const o=c.tmpdir(),i=D.join(o,`biome-format-${Date.now()}.${t}`);await a.promises.writeFile(i,e,"utf8");const u=["format","--write",i];try{const{stdout:e,stderr:s}=await p(`"${r}" ${u.join(" ")}`,{cwd:n,timeout:1e4});e&&this.logDebug("ðŸŸª Biome CLI stdout:",{output:e}),s&&this.logDebug("ðŸŸª Biome CLI stderr:",{output:s});const o=await a.promises.readFile(i,"utf8");return await a.promises.unlink(i).catch(()=>{}),this.logDebug(`âœ… Biome CLI formatting successful for ${t}`),o}catch(e){await a.promises.unlink(i).catch(()=>{}),this.logDebug(`âš ï¸ Biome CLI formatting failed for ${t}`,{error:e instanceof Error?e.message:String(e)})}}catch(e){this.logDebug(`âš ï¸ Biome CLI setup failed for ${t}`,{error:e instanceof Error?e.message:String(e)})}if(h)try{this.logDebug(`ðŸŸ¦ Attempting Prettier formatting for ${t}`);const n="html"===t?"html":"css",s=await h.format(e,{parser:n,printWidth:100,tabWidth:2,useTabs:!1,semi:!0,singleQuote:!1,trailingComma:"es5"});return this.logDebug(`âœ… Prettier formatting successful for ${t}`),s}catch(e){this.logDebug(`âš ï¸ Prettier bundled formatting failed for ${t}`,{error:e instanceof Error?e.message:String(e)})}else this.logDebug("âš ï¸ Prettier not available, falling back to legacy");return this.logDebug(`ðŸŸ¨ Using legacy simple formatting for ${t}`),this.simpleFormat(e,t)}catch(n){return this.logDebug(`âŒ Formatting error for ${t}`,{error:n instanceof Error?n.message:String(n)}),e}}simpleFormat(e,t){return this.logDebug(`ðŸ”§ Applying simple ${t} formatting`),"html"===t?this.simpleHtmlFormat(e):this.simpleCssFormat(e)}simpleHtmlFormat(e){const t=e.replace(/(?<!^)(<[^/])/g,"\n$1").replace(/(<\/)/g,"\n$1").replace(/(\/>|>)/g,"$1\n").replace(/\n+/g,"\n").trim().split("\n"),n=[];let s=0;for(let e=0;e<t.length;e++){const r=t[e].trim();if(r){if(r.startsWith("<")&&!r.startsWith("</")){const r=this.tryCreateSingleLineTag(t,e);if(r.success){n.push(" ".repeat(2*s)+r.content),e=r.skipToIndex;continue}}if(r.startsWith("</")&&(s=Math.max(0,s-1)),n.push(" ".repeat(2*s)+r),r.startsWith("<")&&!r.startsWith("</")&&!r.endsWith("/>")){const e=r.match(/<(\w+)/);if(e){const t=e[1].toLowerCase();["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"].includes(t)||s++}}}}return n.join("\n")}tryCreateSingleLineTag(e,t){const n=e[t].trim();if(n.length>50||n.includes("\n"))return{success:!1,content:"",skipToIndex:t};const s=n.match(/<(\w+)/);if(!s)return{success:!1,content:"",skipToIndex:t};const r=`</${s[1].toLowerCase()}>`;let o="",i=t+1,u=!1,a=n.length;for(;i<e.length&&i<t+5;){const t=e[i].trim();if(t===r){u=!0,a+=t.length;break}if(t.includes("<")||a>80)break;o+=(o?" ":"")+t,a+=t.length+1,i++}return u&&a<=80&&!o.includes("\n")?{success:!0,content:o?`${n}${o}${r}`:`${n}${r}`,skipToIndex:i}:{success:!1,content:"",skipToIndex:t}}simpleCssFormat(e){const t=e.replace(/;(?![^()]*\))/g,";\n").replace(/\s*\{/g," {\n").replace(/\}/g,"\n}\n").replace(/\n+/g,"\n").replace(/[ \t]+/g," ").trim().split("\n"),n=[];let s=0;for(let e of t)e=e.trim(),e&&("}"===e&&(s=Math.max(0,s-1)),n.push(" ".repeat(2*s)+e),e.endsWith("{")&&s++);return n.join("\n")}extractExpressions(e){this.logDebug("ðŸ” Extracting template expressions");const t=[];let n=e,s=0;const r=/\$\{[^}]*(?:\{[^}]*\}[^}]*)*\}/g;let o;for(o=r.exec(e);null!==o;){const i=`__EXPR_${s}__`,u=o[0],a=u.includes("html`")||u.includes("css`");t.push({placeholder:i,original:u,hasNestedTemplate:a}),this.logDebug(`ðŸ“¦ Extracted expression ${s}`,{length:u.length,hasNestedTemplate:a,preview:u.length>50?`${u.substring(0,47)}...`:u}),n=n.replace(u,i),s++,o=r.exec(e)}return this.logDebug("âœ… Expression extraction complete",{totalExpressions:t.length,nestedTemplateExpressions:t.filter(e=>e.hasNestedTemplate).length}),{content:n,expressions:t}}restoreExpressions(e,t){this.logDebug(`ðŸ”„ Restoring ${t.length} expressions`);let n=e;for(const e of t)n=n.replace(new RegExp(e.placeholder,"g"),e.original);return this.logDebug("âœ… Expression restoration complete"),n}applyTemplateLiteralStyle(e,t){if(this.logDebug("ðŸŽ¯ Applying template literal styling",{baseIndent:t,contentLines:e.split("\n").length}),!e.trim())return e;const n=e.split("\n"),s="  ".repeat(t+1),r=`\n${n.map(e=>e.trim()?s+e:e).join("\n")}\n${"  ".repeat(t)}`;return this.logDebug("âœ… Template literal styling applied",{inputLines:n.length,outputLength:r.length}),r}}t.ActorSpaFormattingProvider=f,t.ActorSpaRangeFormattingProvider=class{constructor(e){this.formattingProvider=new f(e)}async provideDocumentRangeFormattingEdits(e,t,n,s){return this.formattingProvider.provideDocumentFormattingEdits(e,n,s)}}},9600:function(e,t,n){"use strict";var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.COMPONENTS=t.DebugLogger=t.LogLevel=void 0,t.createDebugLogger=function(e){return c.getInstance(e)};const u=i(n(1398));var a;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.TRACE=4]="TRACE"}(a||(t.LogLevel=a={}));class c{constructor(e){this.logLevel=a.INFO,this.enabledComponents=new Set,this.logBuffer=[],this.maxBufferSize=1e3,this.outputChannel=e,this.loadConfiguration(),u.workspace.onDidChangeConfiguration(e=>{e.affectsConfiguration("actor-spa.debug")&&this.loadConfiguration()})}static getInstance(e){if(!c.instance){if(!e)throw new Error("DebugLogger must be initialized with an output channel");c.instance=new c(e)}return c.instance}loadConfiguration(){const e=u.workspace.getConfiguration("actor-spa.debug"),t=e.get("logLevel","info").toLowerCase();this.logLevel=this.stringToLogLevel(t);const n=e.get("enabledComponents",["*"]);this.enabledComponents=new Set(n),this.enabledComponents.has("*")&&(this.enabledComponents.clear(),this.enabledComponents.add("*")),this.log(a.INFO,"DebugLogger",`Configuration loaded: level=${a[this.logLevel]}, components=${Array.from(this.enabledComponents).join(", ")}`)}stringToLogLevel(e){switch(e){case"error":return a.ERROR;case"warn":return a.WARN;case"info":default:return a.INFO;case"debug":return a.DEBUG;case"trace":return a.TRACE}}shouldLog(e,t){return!(e>this.logLevel)&&(!!this.enabledComponents.has("*")||this.enabledComponents.has(t))}log(e,t,n,s,r){if(!this.shouldLog(e,t))return;const o={timestamp:new Date,level:e,component:t,message:n,data:s,error:r};this.logBuffer.push(o),this.logBuffer.length>this.maxBufferSize&&this.logBuffer.shift(),this.outputToChannel(o)}outputToChannel(e){let t=`[${e.timestamp.toISOString()}] [${a[e.level].padEnd(5)}] [${e.component.padEnd(15)}] ${e.message}`;e.data&&(t+=`\n    Data: ${JSON.stringify(e.data,null,2)}`),e.error&&(t+=`\n    Error: ${e.error.message}`,e.error.stack&&(t+=`\n    Stack: ${e.error.stack}`)),this.outputChannel.appendLine(t)}error(e,t,n,s){this.log(a.ERROR,e,t,n,s),s&&u.window.showErrorMessage(`Actor-SPA ${e}: ${t}`)}warn(e,t,n){this.log(a.WARN,e,t,n)}info(e,t,n){this.log(a.INFO,e,t,n)}debug(e,t,n){this.log(a.DEBUG,e,t,n)}trace(e,t,n){this.log(a.TRACE,e,t,n)}show(){this.outputChannel.show()}clear(){this.outputChannel.clear(),this.logBuffer=[]}getLogBuffer(){return[...this.logBuffer]}exportLogs(){return this.logBuffer.map(e=>{let t=`[${e.timestamp.toISOString()}] [${a[e.level]}] [${e.component}] ${e.message}`;return e.data&&(t+=`\n    Data: ${JSON.stringify(e.data,null,2)}`),e.error&&(t+=`\n    Error: ${e.error.message}`,e.error.stack&&(t+=`\n    Stack: ${e.error.stack}`)),t}).join("\n")}async safeExecute(e,t,n,s){try{this.debug(e,`Starting ${t}`);const s=await n();return this.debug(e,`Successfully completed ${t}`),s}catch(n){return this.error(e,`Failed to ${t}`,{operation:t},n instanceof Error?n:new Error(String(n))),s}}safeExecuteSync(e,t,n,s){try{this.debug(e,`Starting ${t}`);const s=n();return this.debug(e,`Successfully completed ${t}`),s}catch(n){return this.error(e,`Failed to ${t}`,{operation:t},n instanceof Error?n:new Error(String(n))),s}}}t.DebugLogger=c,t.COMPONENTS={EXTENSION:"Extension",ACTOR_FORMATTER:"ActorFormatter",COORDINATOR:"Coordinator",DISCOVERY:"Discovery",FORMATTING:"Formatting",PARSER:"Parser",VALIDATOR:"Validator"}},9896:e=>{"use strict";e.exports=require("fs")}},n={};function s(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}};return t[e].call(o.exports,o,o.exports,s),o.exports}s.m=t,s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce((t,n)=>(s.f[n](e,t),t),[])),s.u=e=>e+".extension.js",s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e={792:1},s.f.require=(t,n)=>{e[t]||(t=>{var n=t.modules,r=t.ids,o=t.runtime;for(var i in n)s.o(n,i)&&(s.m[i]=n[i]);o&&o(s);for(var u=0;u<r.length;u++)e[r[u]]=1})(require("./"+s.u(t)))};var r=s(7682);module.exports=r})();
//# sourceMappingURL=extension.js.map