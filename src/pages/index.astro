---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

const title =
    "Jose Flores | Statecharts & Actor Model in TypeScript | Writing & Open Source";
const description =
    "Writing and open-source on statecharts, actor models, and delivery. Independent software engineer focused on reliable systems in TypeScript.";
const personSchema = {
    "@context": "https://schema.org",
    "@type": "Person",
    name: "Jose Flores",
    url: "https://0xjcf.com",
    jobTitle: "Software Engineer",
    description,
    sameAs: [
        "https://github.com/0xjcf",
        "https://www.linkedin.com/in/joseflores-io",
        "https://x.com/0xjcf",
    ],
};

type WritingPreviewItem = {
    pathSegment: string;
    title: string;
    description: string;
    edition?: number;
};

const allowedSlugs = ["when-code-becomes-cheap"];

const writingEntries: CollectionEntry<"blog">[] = (await getCollection("blog"))
    .filter(
        (writingEntry: CollectionEntry<"blog">) =>
            !writingEntry.data.draft && allowedSlugs.includes(writingEntry.slug),
    )
    .sort(
        (
            firstWritingEntry: CollectionEntry<"blog">,
            secondWritingEntry: CollectionEntry<"blog">,
        ) => {
            const publicationDateDifference =
                secondWritingEntry.data.pubDate.valueOf() -
                firstWritingEntry.data.pubDate.valueOf();
            if (publicationDateDifference !== 0) {
                return publicationDateDifference;
            }

            const firstEditionValue = firstWritingEntry.data.edition ?? 0;
            const secondEditionValue = secondWritingEntry.data.edition ?? 0;
            return secondEditionValue - firstEditionValue;
        },
    );

const seriesName = "Behavior & Boundaries";
const seriesStartPost = writingEntries
    .filter((writingEntry) => writingEntry.data.series === seriesName)
    .sort((firstWritingEntry, secondWritingEntry) => {
        const firstEditionValue = firstWritingEntry.data.edition ?? 0;
        const secondEditionValue = secondWritingEntry.data.edition ?? 0;
        if (firstEditionValue !== secondEditionValue) {
            return firstEditionValue - secondEditionValue;
        }

        return (
            firstWritingEntry.data.pubDate.valueOf() -
            secondWritingEntry.data.pubDate.valueOf()
        );
    })[0];

const writingPreviewEntries = seriesStartPost
    ? [seriesStartPost]
    : writingEntries.slice(0, 1);

const writingPreviewItems: WritingPreviewItem[] = writingPreviewEntries.map(
    (writingEntry: CollectionEntry<"blog">) => ({
        pathSegment: writingEntry.slug,
        title: writingEntry.data.title,
        description: writingEntry.data.description,
        edition: writingEntry.data.edition,
    }),
);
---

<BaseLayout title={title} description={description} bodyClass="no-js home-page">
    <Fragment slot="head">
        <script
            type="application/ld+json"
            is:inline
            set:html={JSON.stringify(personSchema)}
        />
    </Fragment>

    <main id="main" role="main">
        <!-- Hero Section -->
        <section
            id="hero"
            class="hero section section--hero"
            aria-label="Introduction"
        >
            <!-- Background layers temporarily removed for theme debugging -->

            <header class="hero__content" aria-label="Intro">
                <!-- Enhanced credibility badge -->
                <p class="badge badge--enhanced">
                    SOFTWARE ENGINEER â€¢ TECHNICAL ADVISOR
                </p>

                <!-- Lead with outcomes -->
                <h1 class="name">
                    <span class="hero__name-text">Jose Flores</span>
                </h1>

                <!-- Value proposition -->
                <p class="subtitle subtitle--primary">
                    <span class="hero__claim"
                        >Statecharts &amp; Actor Model in TypeScript</span
                    >
                    <span class="hero__supporting"
                        >Writing and open-source on statecharts, actor models,
                        and system boundaries.</span
                    >
                </p>

                <!-- Secondary tagline - Desktop only -->
                <!-- Shifted below the hero for focus: supporting tagline -->

                <!-- CTAs -->
                <nav class="cta-row" aria-label="primary actions">
                    <a
                        class="button button--primary cta-animated"
                        href="/writing"
                        data-cta="hero_writing"
                        title="Read my writing"
                    >
                        <span class="button__text">Read my writing</span>
                        <svg
                            class="button__icon arrow"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            aria-hidden="true"
                        >
                            <path
                                d="M5 12h12M13 6l6 6-6 6"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                        </svg>
                    </a>
                    <!-- Business site link disabled until site is ready.
                    <a class="button button--secondary d-none d-sm-flex" href="https://bluejf.llc"
                        data-cta="hero_business" target="_blank" rel="noopener noreferrer">
                        <span class="button__text">Work with me â†’ bluejf.llc (Business site)</span>
                        <svg class="button__icon" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            aria-hidden="true">
                            <path d="M7 17L17 7M9 7h8v8" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </a>
                    -->
                </nav>
                <p class="cta-note text-muted">
                    <strong>Start here:</strong>
                    <a href="/writing/when-code-becomes-cheap" class="link-primary start-here-link"
                        ><em>When Code Becomes Cheap</em> â†’ Why architecture matters
                        now</a
                    >
                </p>
                <p class="cta-note text-muted">
                    Prefer to read first? <a href="/writing"
                        >Explore the Behavior &amp; Boundaries series â†’</a
                    >
                </p>

                <!-- Risk reversal note -->
            </header>

            <!-- Scroll indicator -->
            <div class="scroll" aria-hidden="false">
                <span class="scroll-text">Scroll</span>
                <div class="mouse" aria-hidden="true">
                    <div class="dot"></div>
                </div>
            </div>
        </section>

        <!-- Explore routing section -->
        <section class="section section--explore" aria-label="Explore my work">
            <div class="container">
                <header class="explore__header">
                    <h2 class="section__title">Explore my work</h2>
                    <p class="lead">
                        Routes for learning, building, and collaborating.
                    </p>
                </header>
                <div class="explore__grid">
                    <article class="explore__card">
                        <h3>Writing</h3>
                        <p>
                            Systems, delivery, and behavior-driven architecture.
                        </p>
                        <a href="/writing" class="explore__link"
                            >Read my writing â†’</a
                        >
                    </article>
                    <article class="explore__card">
                        <h3>Open Source</h3>
                        <p>
                            Actor-Web, Ignite-Element, and other projects I
                            maintain.
                        </p>
                        <a href="/open-source" class="explore__link"
                            >See OSS work â†’</a
                        >
                    </article>
                    <article class="explore__card">
                        <h3>About</h3>
                        <p>Background, approach, and how I work with teams.</p>
                        <a href="/about" class="explore__link"
                            >Get to know me â†’</a
                        >
                    </article>
                </div>
            </div>
        </section>

        <!-- Writing preview section -->
        <section
            id="writing-preview"
            class="section section--writing"
            aria-label="Writing preview"
        >
            <div class="container">
                <header class="writing__header">
                    <h2 class="section__title">Writing</h2>
                    <p class="lead">
                        Notes on architecture, statecharts, and delivery.
                    </p>
                </header>
                {
                    writingPreviewItems.length === 0 ? (
                        <p class="text-muted">
                            Posts are coming soon.{" "}
                            <a
                                href="/writing"
                                data-cta="writing_preview_fallback"
                            >
                                Explore writing â†’
                            </a>
                        </p>
                    ) : (
                        <ul class="list list--plain writing__list">
                            {writingPreviewItems.map((writingPreviewItem) => (
                                <li class="writing__item">
                                    <div class="writing-list__title">
                                        {writingPreviewItem.edition && (
                                            <span class="writing-list__edition">
                                                Edition{" "}
                                                {writingPreviewItem.edition}
                                            </span>
                                        )}
                                        <a
                                            class="writing__link"
                                            href={`/writing/${writingPreviewItem.pathSegment}`}
                                            data-cta={`writing_preview_${writingPreviewItem.pathSegment}`}
                                        >
                                            {writingPreviewItem.title}
                                        </a>
                                    </div>
                                    <p class="text-muted">
                                        {writingPreviewItem.description}
                                    </p>
                                </li>
                            ))}
                        </ul>
                    )
                }
            </div>
        </section>

        <!-- Open source highlight -->
        <section
            id="open-source-highlight"
            class="section section--open-source-highlight"
            aria-label="Open source highlight"
        >
            <div class="container">
                <header class="open-source-highlight__header">
                    <h2 class="section__title">Open Source Highlight</h2>
                    <p class="lead">
                        A production-grade library for building
                        statechart-driven UI components.
                    </p>
                </header>
                <div class="highlights-grid open-source-highlight__grid">
                    <article class="highlight-card">
                        <h3>ignite-element</h3>
                        <ul class="open-source-highlight__list">
                            <li>
                                Web-component-first integration for statecharts
                                and actors
                            </li>
                            <li>
                                Explicit behavior boundaries, testable by design
                            </li>
                            <li>Used to build real interfaces, not demos</li>
                        </ul>
                        <div class="open-source-highlight__actions">
                            <a
                                class="button button--primary"
                                href="https://0xjcf.github.io/ignite-element/"
                                target="_blank"
                                rel="noopener"
                            >
                                Read ignite-element docs â†’
                            </a>
                            <a
                                class="button button--secondary"
                                href="https://github.com/0xjcf/ignite-element"
                                target="_blank"
                                rel="noopener"
                            >
                                View source on GitHub â†’
                            </a>
                        </div>
                    </article>
                </div>
            </div>
        </section>

        <!-- About/Experience Section (unchanged body copy) -->
        <section
            id="about"
            class="about section section--about"
            aria-label="About and Experience"
        >
            <div class="noise-overlay" aria-hidden="true"></div>
            <div class="container">
                <header class="about__header">
                    <h2 class="section__title about__title">
                        <span class="text-white">ABOUT</span>
                        <span class="gradient">ME</span>
                    </h2>
                </header>

                <div class="about__card">
                    <div class="about__identity">
                        <div class="about__avatar">
                            <picture>
                                <source
                                    srcset="assets/images/gibli-pfp-200.webp 200w"
                                    sizes="(max-width: 640px) 96px, 160px"
                                    type="image/webp"
                                />
                                <img
                                    src="assets/images/gibli-pfp-200.webp"
                                    srcset="assets/images/gibli-pfp-200.webp 200w"
                                    sizes="(max-width: 640px) 96px, 160px"
                                    alt="Jose Flores"
                                    width="200"
                                    height="200"
                                    loading="lazy"
                                />
                            </picture>
                        </div>
                        <div class="about__identity-text">
                            <p class="about__name">Jose Flores</p>
                            <p class="about__role">
                                Software Engineer â€¢ Technical Advisor
                            </p>
                        </div>
                        <ul class="about__tags" aria-label="Focus areas">
                            <li class="about__tag">Statecharts</li>
                            <li class="about__tag">Actor Model</li>
                            <li class="about__tag">TypeScript</li>
                        </ul>
                    </div>
                    <div class="about__details">
                        <p class="about__value">
                            I make behavior explicit so teams can ship complex
                            systems with confidence.
                        </p>
                        <ul class="about__proof-list">
                            <li>
                                Independent software engineer and technical
                                advisor.
                            </li>
                            <li>
                                Statecharts and actor model specialist in
                                TypeScript.
                            </li>
                            <li>
                                Open-source maintainer: Actor-Web,
                                Ignite-Element.
                            </li>
                            <li>
                                Focus areas: architecture, delivery, developer
                                experience.
                            </li>
                            <li>
                                Make behavior explicit, testable, and easy to
                                evolve.
                            </li>
                        </ul>
                        <div class="about__actions">
                            <a class="about__action-link" href="/about"
                                >Read full background â†’</a
                            >
                            <a
                                class="about__action-link about__action-link--secondary"
                                href="/open-source">See open source â†’</a
                            >
                        </div>
                    </div>
                </div>
            </div>
        </section>

        {
            /*
          Services section hidden until business site is ready.
          <section class="section section--services-router" aria-label="Services overview">
            <div class="container">
                <header class="services-router__header">
                    <h2 class="section__title">Services</h2>
                    <p class="lead">Business services live on bluejf.llc.</p>
                </header>
                <div class="services-router__grid">
                    <article class="services-router__card">
                        <p class="eyebrow">Product Teams</p>
                        <h3>Technical advisory</h3>
                        <ul>
                            <li>Statecharts and actor models in TypeScript.</li>
                            <li>Architecture and delivery guidance.</li>
                        </ul>
                        <!-- Business site link disabled until site is ready.
                        <a class="button button--secondary" href="https://bluejf.llc" target="_blank"
                            rel="noopener noreferrer" aria-label="Business site for product teams"
                            data-cta="business_site_product_teams">
                            <span class="button__text">Business site</span>
                            <svg class="button__icon" width="18" height="18" viewBox="0 0 24 24" fill="none"
                                aria-hidden="true">
                                <path d="M7 17L17 7M9 7h8v8" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </a>
                        -->
                    </article>
                    <article class="services-router__card">
                        <p class="eyebrow">Local Businesses</p>
                        <h3>Web presence support</h3>
                        <ul>
                            <li>Content, structure, and performance guidance.</li>
                            <li>Local presence setup and maintenance.</li>
                        </ul>
                        <!-- Business site link disabled until site is ready.
                        <a class="button button--secondary" href="https://bluejf.llc" target="_blank"
                            rel="noopener noreferrer" aria-label="Business site for local businesses"
                            data-cta="business_site_local_businesses">
                            <span class="button__text">Business site</span>
                            <svg class="button__icon" width="18" height="18" viewBox="0 0 24 24" fill="none"
                                aria-hidden="true">
                                <path d="M7 17L17 7M9 7h8v8" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </a>
                        -->
                    </article>
                </div>
            </div>
          </section>
        */
        }
        <!-- Contact Section (Combined) -->
        <section
            id="contact"
            class="chapter chapter--contact contact section section--contact"
            aria-label="Contact and Connect"
        >
            <div class="contact__spotlight" aria-hidden="true"></div>
            <div class="container">
                <h2 class="section__title contact__title">
                    <span class="text-white">LET'S</span>
                    <span class="gradient">CONNECT</span>
                </h2>
                <p class="contact__supporting">
                    Subscribe to get new writing, open-source updates, and
                    occasional notes on systems and delivery.
                </p>

                <!-- Forms Section (formerly contact-forms) -->
                <div
                    class="contact__forms contact__forms--newsletter"
                    id="contact-forms"
                >
                    <div class="forms-container">
                        <div class="form-card">
                            <h3>
                                <svg
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path
                                        d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                                    ></path>
                                </svg>
                                Newsletter
                            </h3>
                            <p class="newsletter__social-proof">
                                <svg
                                    width="16"
                                    height="16"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    aria-hidden="true"
                                    class="newsletter__icon"
                                >
                                    <path
                                        d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"
                                    ></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                                Join other readers getting insights
                            </p>
                            <p class="newsletter__intro">
                                Get occasional notes on:
                            </p>
                            <ul class="newsletter__benefits">
                                <li class="newsletter__benefit">
                                    <span class="newsletter__bullet">â–¸</span>
                                    Architecture and delivery that ship
                                </li>
                                <li class="newsletter__benefit">
                                    <span class="newsletter__bullet">â–¸</span>
                                    Hands-on patterns: statecharts & actor model
                                </li>
                                <li class="newsletter__benefit">
                                    <span class="newsletter__bullet">â–¸</span>
                                    Open-source updates and experiments
                                </li>
                                <li class="newsletter__benefit">
                                    <span class="newsletter__bullet">â–¸</span>
                                    Clear notes on systems and behavior
                                </li>
                            </ul>
                            <form
                                class="pe-form"
                                action="/api/newsletter"
                                data-endpoint="/api/newsletter"
                                method="POST"
                            >
                                <noscript>
                                    <div
                                        class="form-error"
                                        style="margin-bottom: 1rem; padding: 1rem; background: #fef2f2; border: 1px solid #fecaca; border-radius: 4px; color: #dc2626;"
                                    >
                                        <strong>JavaScript Required:</strong> This
                                        form requires JavaScript to function properly.
                                        Please enable JavaScript in your browser to
                                        use this form.
                                    </div>
                                </noscript>
                                <div class="form-group">
                                    <label
                                        for="newsletter-email"
                                        class="form-label required"
                                        >EMAIL ADDRESS</label
                                    >
                                    <input
                                        type="email"
                                        id="newsletter-email"
                                        name="email"
                                        class="form-input"
                                        placeholder="your@email.com"
                                        required
                                    />
                                    <div
                                        id="newsletter-email-error"
                                        class="form-error"
                                        role="alert"
                                    >
                                        <span
                                            >Enter a valid email address
                                            (name@example.com)</span
                                        >
                                    </div>
                                </div>

                                <!-- Honeypot and timestamp fields for spam protection -->
                                <input
                                    type="text"
                                    name="website"
                                    class="sr-only-absolute"
                                    tabindex="-1"
                                    autocomplete="new-password"
                                    aria-hidden="true"
                                />
                                <input
                                    type="hidden"
                                    name="timestamp"
                                    value=""
                                />

                                <div class="form-submit">
                                    <button type="submit">
                                        <span class="button__text"
                                            >Get Insights <span
                                                aria-hidden="true">â†’</span
                                            ></span
                                        >
                                        <span
                                            class="sr-only loading-status"
                                            role="status"
                                            aria-live="polite"
                                            aria-atomic="true">Loadingâ€¦</span
                                        >
                                    </button>
                                    <div
                                        class="form-success-message"
                                        aria-live="polite"
                                    >
                                        <span class="success-emoji">ðŸŽ‰</span>
                                        <span
                                            >You're in! Check your inbox to
                                            confirm your subscription.</span
                                        >
                                    </div>
                                </div>
                            </form>
                            <p class="privacy-note">
                                Low frequency, high signal. Unsubscribe anytime.
                            </p>
                        </div>
                    </div>
                    <p class="contact__secondary-link text-muted">
                        For non-business questions, find me on
                        <a
                            href="https://www.linkedin.com/in/joseflores-io"
                            target="_blank"
                            rel="noopener">LinkedIn</a
                        >.
                    </p>
                </div>
            </div>
        </section>
    </main>

    <!-- Inline Critical JS for immediate feature detection -->
    <script is:inline>
        (function () {
            var d = document.documentElement;
            if ("classList" in d) {
                d.classList.remove("no-js");
                d.classList.add("js-enabled");
            }
        })();
    </script>
    <!-- Trust bars 'Read more' togglers (supports multiple bars) -->
    <script is:inline>
        (function () {
            var bars = document.querySelectorAll(".trust");
            if (!bars.length) return;

            bars.forEach(function (trust) {
                var more = trust.querySelector(".trust__more");
                var q = trust.querySelector(".q");
                if (!more || !q) return;

                function updateMoreVisibility() {
                    // Show toggle only if truncated
                    var truncated = q.scrollHeight > q.clientHeight + 1;
                    more.style.display = truncated ? "" : "none";
                    if (!truncated) {
                        trust.classList.remove("is-open");
                        more.setAttribute("aria-expanded", "false");
                        more.textContent = "Read more";
                    }
                }

                more.addEventListener("click", function () {
                    var open = trust.classList.toggle("is-open");
                    more.setAttribute("aria-expanded", open ? "true" : "false");
                    more.textContent = open ? "Read less" : "Read more";
                });

                // Re-evaluate on load and resize
                window.addEventListener("load", updateMoreVisibility);
                window.addEventListener(
                    "resize",
                    function () {
                        requestAnimationFrame(updateMoreVisibility);
                    },
                    { passive: true },
                );
                updateMoreVisibility();
            });
        })();
    </script>

    <!-- Deferred Progressive Enhancement Script -->
    <!-- Dev helper: fills endpoints on localhost when placeholders exist -->
    <script defer type="module" src="/scripts/dev-env.js"></script>
    <script defer type="module" src="/scripts/pe.js"></script>

    <!-- Theme Toggle Script -->
    <!-- Analytics click + conversion wiring (provider-agnostic) -->
    <script defer type="module" src="/scripts/analytics.js"></script>
</BaseLayout>
