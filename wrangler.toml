name = "website-forms"
main = "worker.ts"
tsconfig = "tsconfig.worker.json"
compatibility_date = "2025-08-21"
workers_dev = true

# ---------- Default (local/dev) ----------
[vars]
# Dev mode: worker.js treats ENV!="prod" as mock (no external API calls)
ENV = "dev"
GA_MEASUREMENT_ID = "" # Optional: set to enable GA4 locally

# Your local static server origin used in same-origin checks
SITE_URL = "http://127.0.0.1:8080"

# Card-specific anchors so error redirects open the right form card
CONTACT_FORM_URL = "http://127.0.0.1:8080/#contact-form"
CONTACT_THANKS_URL = "http://127.0.0.1:8080/contact-thanks.html"

NEWSLETTER_FORM_URL = "http://127.0.0.1:8080/#newsletter-form"
NEWSLETTER_THANKS_URL = "http://127.0.0.1:8080/newsletter-thanks.html"

# Email routing used by contact form
FROM_EMAIL = "Website <noreply@resend.dev>"
TO_EMAIL = "bluejf.llc@gmail.com"

# Anti-bot timing thresholds (milliseconds)
CONTACT_MIN_TIME = "3000"
NEWSLETTER_MIN_TIME = "1500"

# API endpoints for forms
CONTACT_API_URL = "http://127.0.0.1:8787/api/contact"
NEWSLETTER_API_URL = "http://127.0.0.1:8787/api/newsletter"

# (Optional for dev) RESEND_AUDIENCE_ID not required in dev

# ---------- Staging ----------
[env.staging]
name = "website-forms-staging"
workers_dev = true
routes = [{ pattern = "staging.0xjcf.com/api/*", zone_name = "0xjcf.com" }]

[env.staging.vars]
ENV = "dev"
SITE_URL = "https://staging.0xjcf.com"
GA_MEASUREMENT_ID = ""                                                                 # Optional for staging
CONTACT_FORM_URL = "https://staging.0xjcf.com/#contact-form"
CONTACT_THANKS_URL = "https://staging.0xjcf.com/contact-thanks.html"
NEWSLETTER_FORM_URL = "https://staging.0xjcf.com/#newsletter-form"
NEWSLETTER_THANKS_URL = "https://staging.0xjcf.com/newsletter-thanks.html"
FROM_EMAIL = "Website <noreply@resend.dev>"
TO_EMAIL = "bluejf.llc@gmail.com"

# Anti-bot timing thresholds (milliseconds)
CONTACT_MIN_TIME = "3000"
NEWSLETTER_MIN_TIME = "1500"

# API endpoints for forms (same-origin under staging domain)
CONTACT_API_URL = "https://staging.0xjcf.com/api/contact"
NEWSLETTER_API_URL = "https://staging.0xjcf.com/api/newsletter"

# ---------- Production ----------
[env.production]
name = "website-forms-production"
workers_dev = false
routes = [
  { pattern = "0xjcf.com/api/*", zone_name = "0xjcf.com" },
  { pattern = "www.0xjcf.com/api/*", zone_name = "0xjcf.com" }
]

# Vars used by your deployed site on Cloudflare Pages
[env.production.vars]
ENV = "prod"
SITE_URL = "https://0xjcf.com"
ALLOWED_ORIGINS = "https://0xjcf.com,https://www.0xjcf.com"
GA_MEASUREMENT_ID = "G-5TR1LWNXXY"                                                                 # Fill with your GA4 Measurement ID (e.g., G-XXXXXXX)
CONTACT_FORM_URL = "https://0xjcf.com/#contact-form"
CONTACT_THANKS_URL = "https://0xjcf.com/contact-thanks.html"
NEWSLETTER_FORM_URL = "https://0xjcf.com/#newsletter-form"
NEWSLETTER_THANKS_URL = "https://0xjcf.com/newsletter-thanks.html"
FROM_EMAIL = "Website <noreply@resend.dev>"
TO_EMAIL = "bluejf.llc@gmail.com"

# Anti-bot timing thresholds (milliseconds)
CONTACT_MIN_TIME = "3000"
NEWSLETTER_MIN_TIME = "1500"

# API endpoints for forms (same-origin under production domain)
CONTACT_API_URL = "https://0xjcf.com/api/contact"
NEWSLETTER_API_URL = "https://0xjcf.com/api/newsletter"

# RESEND_AUDIENCE_ID - Set via secret (see instructions below)

# ---------- Secrets Configuration ----------
# Required secrets (use wrangler secret put):
#   RESEND_API_KEY           - Required for both dev/prod live email sending
#   RESEND_AUDIENCE_ID       - Required for prod newsletter, optional for dev testing
#
# Set secrets per environment:
#   wrangler secret put RESEND_API_KEY --env production
#   wrangler secret put RESEND_AUDIENCE_ID --env production
#   wrangler secret put RESEND_API_KEY              (for dev environment)
#   wrangler secret put RESEND_AUDIENCE_ID          (optional, for dev testing)
#
# Inspect/update secrets:
#   wrangler secret list --env production
#   wrangler secret put <NAME> --env production
#
# ---------- Redirect Documentation ----------
# Redirect URLs are configured via vars above:
# - Dev:  http://127.0.0.1:8080/
# - Staging: https://staging.0xjcf.com/
# - Prod: https://0xjcf.com/
#
# Success pages:
#   contact-thanks.html
#   newsletter-thanks.html
# Error pages:
#   contact-error.html
#   newsletter-error.html

# Development
[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "a8084909de3348969002d684387b23fc"

# Staging
[[env.staging.kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "a8084909de3348969002d684387b23fc"

# Production
[[env.production.kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "e5f219d5db6d48eca60ddd8a5df06ae1"
